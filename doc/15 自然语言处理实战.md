# <center> ç¬¬ 15 ç«  è‡ªç„¶è¯­è¨€å¤„ç†å®æˆ˜ </center>


> æœ¬ç« å¯¼è¯»ï¼š
## 15.1 GitHubæ•°æ®æå–ä¸å¯è§†åŒ–åˆ†æ

GitHubä½œä¸ºå…¨çƒæœ€å¤§çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼Œæ¯å°æ—¶éƒ½æœ‰æˆåƒä¸Šä¸‡ä¸ªé¡¹ç›®äº§ç”Ÿï¼Œä»–ä¸ºå¼€æºä½œå‡ºäº†ä¸å¯ç£¨ç­çš„è´¡çŒ®ã€‚æœ¬æ–‡ä½¿ç”¨äº†NetworkXå¯¹GitHubçš„è¿›è¡Œå›¾å½¢åˆ†æï¼Œé€šè¿‡gitHubçš„ä¸°å¯Œæ•°æ®ï¼Œæ„å»ºå¯ä»¥åœ¨å„ç§ä¸åŒçš„æ–¹å¼ä½¿ç”¨æ•°æ®æ¨¡å‹ã€‚è¿™é‡Œå°†githubç”¨æˆ·ã€ä»£ç ã€ä»“åº“æ„å»ºæˆå…´è¶£å›¾ã€‚æœ¬æ–‡åŒ…å«ä¸‰æ–¹é¢:github å¼€å‘è€…å¹³å°å’Œå¯¹åº”çš„apiã€å¦‚ä½•ä½¿ç”¨NetworkXä½œå›¾ã€æ„å»ºgithubçš„å…´è¶£å›¾å’Œå›¾ç®—æ³•

### 15.1.1 äº†è§£githubçš„API
åŒTwitterå’ŒFacebookä¸€æ ·ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯è·å–Gitè‡ªå¸¦çš„APIã€‚åœ°å€ï¼šhttps://developer.github.com/v3/
å…¶ä¸­å¤§éƒ¨åˆ†æˆ‘ä»¬å¹¶ä¸éœ€è¦ï¼Œæˆ‘ä»¬ä»…ä»…å…³æ³¨çš„æ˜¯ç”¨æˆ·å’Œä»“åº“ã€‚æ‰€æœ‰çš„APIè®¿é—®é€šè¿‡HTTPSï¼Œå¹¶ä»https://api.github.comè®¿é—®ã€‚æ‰€æœ‰å‘é€å’Œæ¥æ”¶çš„æ•°æ®æ˜¯JSONã€‚
> åˆ›å»ºAPIè¿æ¥

githubå®ç°äº†OAuthæ¥å£ï¼Œåœ¨æ‹¥æœ‰githubè´¦æˆ·åè·å–APIé€šé“çš„æ–¹å¼æœ‰ä¸¤ç§ã€‚ä¸€ç§å«åšpersonal access token.ä½ å¯ä»¥ä¸ºä½ è‡ªå·±çš„ä½¿ç”¨æˆ–å®ç°çš„Webæµåˆ›å»ºä¸€ä¸ªä¸ªäººè®¿é—®ä»¤ç‰Œï¼Œä»¥å…è®¸å…¶ä»–ç”¨æˆ·æˆæƒä½ çš„åº”ç”¨ç¨‹åºã€‚ä¸€ç§æ˜¯OAuth applicationï¼Œæ‰€æœ‰çš„å¼€å‘äººå‘˜åœ¨å¼€å§‹ä¹‹å‰éƒ½éœ€è¦æ³¨å†Œä»–ä»¬çš„åº”ç”¨ç¨‹åºã€‚æ³¨å†ŒOAuthåº”ç”¨åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„å®¢æˆ·IDå’Œå®¢æˆ·çš„å¯†é’¥ã€‚è¿™é‡Œç®€å•èµ·è§ï¼Œé‡‡ç”¨personal access tokenã€‚ç‚¹å‡»æ–°å»ºå³å¯ç”Ÿæˆæœ‰å¯¹åº”æƒé™çš„tokenã€‚ç”Ÿæˆå¥½çš„tokenå¦‚ä¸‹æ‰€ç¤ºï¼š
![](https://i.imgur.com/kg5w8Ch.png)

å‘apiæ ¹ç›®å½•å‘é€è¯·æ±‚ï¼Œè¯•ä¸€è¯•è¿™ä¸ªtokenè¿æ¥æƒ…å†µï¼š

<pre>
curl https://api.github.com/?access_token=$TOKEN
{
  "current_user_url": "https://api.github.com/user",
  "current_user_authorizations_html_url": "https://github.com/settings/connections/applications{/client_id}",
  "authorizations_url": "https://api.github.com/authorizations",
  "code_search_url": "https://api.github.com/search/code?q={query}{&page,per_page,sort,order}",
  "emails_url": "https://api.github.com/user/emails",
  "emojis_url": "https://api.github.com/emojis",
  "events_url": "https://api.github.com/events",
  "feeds_url": "https://api.github.com/feeds",
  "followers_url": "https://api.github.com/user/followers",
  "following_url": "https://api.github.com/user/following{/target}",
  "gists_url": "https://api.github.com/gists{/gist_id}",
  "hub_url": "https://api.github.com/hub",
  "issue_search_url": "https://api.github.com/search/issues?q={query}{&page,per_page,sort,order}",
  "issues_url": "https://api.github.com/issues",
  "keys_url": "https://api.github.com/user/keys",
  "notifications_url": "https://api.github.com/notifications",
  "organization_repositories_url": "https://api.github.com/orgs/{org}/repos{?type,page,per_page,sort}",
  "organization_url": "https://api.github.com/orgs/{org}",
  "public_gists_url": "https://api.github.com/gists/public",
  "rate_limit_url": "https://api.github.com/rate_limit",
  "repository_url": "https://api.github.com/repos/{owner}/{repo}",
  "repository_search_url": "https://api.github.com/search/repositories?q={query}{&page,per_page,sort,order}",
  "current_user_repositories_url": "https://api.github.com/user/repos{?type,page,per_page,sort}",
  "starred_url": "https://api.github.com/user/starred{/owner}{/repo}",
  "starred_gists_url": "https://api.github.com/gists/starred",
  "team_url": "https://api.github.com/teams",
  "user_url": "https://api.github.com/users/{user}",
  "user_organizations_url": "https://api.github.com/user/orgs",
  "user_repositories_url": "https://api.github.com/users/{user}/repos{?type,page,per_page,sort}",
  "user_search_url": "https://api.github.com/search/users?q={query}{&page,per_page,sort,order}"
}
</pre>

github çš„APIç¬¦åˆHATEOASè®¾è®¡ï¼Œä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæƒ³è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåº”è¯¥å»è®¿é—®api.github.com/userï¼Œç„¶åå°±å¾—åˆ°äº†ä¸‹é¢ç»“æœã€‚

<pre>
{
"login": "luzhijun",
"id": 15256911,
"avatar_url": "https://avatars.githubusercontent.com/u/15256911?v=3",
"gravatar_id": "",
"url": "https://api.github.com/users/luzhijun",
"html_url": "https://github.com/luzhijun",
...
}
</pre>

> pygithub

okï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸ªæ–¹ä¾¿pythonä½¿ç”¨çš„åŒ…ï¼Œpygithub,ä½ å¯ä»¥é€šè¿‡å®ƒæ–¹ä¾¿åœ°ç”¨pythonè„šæœ¬ç®¡ç†githubã€‚å…¶APIä¸githubå¯¹åº”ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæ‹¿åˆ°æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰ä»“åº“:

<pre>
from github import Github
# Specify your own access token here
ACCESS_TOKEN = ''
USER = 'luzhijun'
client = Github(ACCESS_TOKEN)
user = client.get_user(USER)
REPOS=user.get_repos()
print(list(REPOS))
</pre>

> [Repository(full_name=â€luzhijun/huxblog-boilerplateâ€), Repository(full_name=â€luzhijun/leecodeâ€), Repository(full_name=â€luzhijun/luzhijun.github.ioâ€), Repository(full_name=â€luzhijun/Optimizationâ€), Repository(full_name=â€luzhijun/SVDRecommenderSystemâ€)]
###	15.1.2 å¦‚ä½•ä½¿ç”¨NetworkXä½œå›¾
> äº†è§£NetworkX

NetworkXæ˜¯ä¸€ä¸ªç”¨Pythonè¯­è¨€å¼€å‘çš„å›¾è®ºä¸å¤æ‚ç½‘ç»œå»ºæ¨¡å·¥å…·,å†…ç½®äº†å¸¸ç”¨çš„å›¾ä¸å¤æ‚ç½‘ç»œåˆ†æç®—æ³•,å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œå¤æ‚ç½‘ç»œæ•°æ®åˆ†æã€ä»¿çœŸå»ºæ¨¡ç­‰å·¥ä½œã€‚
ä¸‹é¢åˆ›å»ºä¸€ä¸ªæœ‰å‘å›¾x->y:
<pre>
import networkx as nx

# åˆ›å»ºæœ‰å‘å›¾
g = nx.DiGraph()
# åŠ æ¡è¾¹x->y
g.add_edge('X', 'Y')
# æ‰“å°å›¾çš„ç›¸å…³æ•°æ®ä¿¡æ¯
print (nx.info(g),'\n')

print ("Nodes:", g.nodes())
print ("Edges:", g.edges())
# èŠ‚ç‚¹å±æ€§
print ("X props:", g.node['X'])
print ("Y props:", g.node['Y'])
# è¾¹å±æ€§
print ("X=>Y props:", g['X']['Y'])
# æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯
g.node['X'].update({'prop1' : 'value1'})
print ("X props:", g.node['X'])
# æ›´æ–°è¾¹ä¿¡æ¯
g['X']['Y'].update({'label' : 'label1'})
print ("X=>Y props:", g['X']['Y'])
</pre>

	Name: 
	Type: DiGraph #æ— å‘å›¾è¡¨ç¤ºä¸ºGraph Number of nodes: 2
	Number of edges: 1
	Average in degree: 0.5000
	Average out degree: 0.5000
	
	Nodes: [â€˜Yâ€™, â€˜Xâ€™]
	Edges: [(â€˜Xâ€™, â€˜Yâ€™)]
	X props: {}
	Y props: {}
	X=>Y props: {}
	X props: {â€˜prop1â€™: â€˜value1â€™}
	X=>Y props: {â€˜labelâ€™: â€˜label1â€™}

æœ‰å‘å›¾å’Œæ— å‘å›¾éƒ½å¯ä»¥ç»™è¾¹èµ‹äºˆæƒé‡ï¼Œç”¨åˆ°çš„æ–¹æ³•æ˜¯add_weighted_edges_fromï¼Œå®ƒæ¥å—1ä¸ªæˆ–å¤šä¸ªä¸‰å…ƒç»„[u,v,w]ä½œä¸ºå‚æ•°ï¼Œå…¶ä¸­uæ˜¯èµ·ç‚¹ï¼Œvæ˜¯ç»ˆç‚¹ï¼Œwæ˜¯æƒé‡ã€‚ä¾‹å¦‚ï¼š
<pre>
g.add_weighted_edges_from([('X','Y',10.0)])
print (g.get_edge_data('X','Y'))
</pre>
	{â€˜weightâ€™: 10.0, â€˜labelâ€™: â€˜label1â€™}

NetworkXæä¾›äº†å¸¸ç”¨çš„å›¾è®ºç»å…¸ç®—æ³•ï¼Œä¾‹å¦‚DFSã€BFSã€æœ€çŸ­è·¯ã€æœ€å°ç”Ÿæˆæ ‘ã€æœ€å¤§æµç­‰ç­‰ï¼Œéå¸¸ä¸°å¯Œï¼Œå¦‚æœä¸åšå¤æ‚ç½‘ç»œï¼Œåªä½œå›¾è®ºæ–¹é¢çš„å·¥ä½œï¼Œä¹Ÿå¯ä»¥åº”ç”¨NetworkXä½œä¸ºåŸºæœ¬çš„å¼€å‘åŒ…ï¼Œæ›´å¤šç”¨æ³•å‚ç…§networkxã€‚

###	15.1.3 ä½¿ç”¨NetworkXæ„å»ºå…´è¶£å›¾

å…´è¶£å›¾å’Œç¤¾äº¤ç½‘ç»œå›¾æ˜¯æœ‰åŒºåˆ«çš„ï¼Œæœ€å¤§çš„ä¸åŒå°±æ˜¯å…´è¶£å›¾èŠ‚ç‚¹ä»£è¡¨çš„ä¸ä¸€å®šæ˜¯åŒä¸€ç±»çš„ä¸œè¥¿ã€‚æœ‰ä¸ªé¡¹ç›®æ˜¯æˆ‘åŠ æ˜Ÿçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå…´è¶£å›¾å°±æ˜¯ï¼š
æˆ‘â€“(gazes)â€“>é¡¹ç›®
é‚£ä¹ˆè¿˜æœ‰å…¶ä»–å¾ˆå¤šäººä¹Ÿå…³æ³¨äº†è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬æŠŠåŠ æ˜Ÿçš„äººéƒ½æ‰¾å‡ºæ¥ã€‚
<pre>
from github import Github
import networkx as nx

ACCESS_TOKEN = ''
USER='minrk'
REPO='findspark'
client = Github(ACCESS_TOKEN)
user = client.get_user(USER)
repo=user.get_repo(REPO)
stargazers=list(repo.get_stargazers())#åŠ æ˜Ÿçš„ç”¨æˆ·é›†åˆ

g = nx.DiGraph()
g.add_node(repo.name + '(repo)', type='repo', lang=repo.language, owner=user.login)

for sg in stargazers:
    g.add_node(sg.login + '(user)', type='user')
    g.add_edge(sg.login + '(user)', repo.name + '(repo)', type='gazes')
# æ‰“å°å›¾çš„åŸºæœ¬å±æ€§   
print (nx.info(g),'\n')
# æ‰“å°é¡¹ç›®å’Œç”¨æˆ·ç‚¹çš„åŸºæœ¬å±æ€§
print (g.node['findspark(repo)'])
print (g.node['luzhijun(user)'],'\n')
# æ‰“å°è¿™æ¡è¾¹å±æ€§
print (g['luzhijun(user)']['findspark(repo)'])
# æ‰“å°èµ·ç‚¹ä¸ºXXXçš„ä¿¡æ¯
print (g['luzhijun(user)'])
print (g['findspark(repo)'])
# æ‰“å°ç”¨æˆ·çš„å‡ºå…¥åº¦ä¿¡æ¯
print (g.in_edges(['luzhijun(user)']))
print (g.out_edges(['luzhijun(user)']))
# æ‰“å°é¡¹ç›®çš„å‡ºå…¥åº¦ä¿¡æ¯
print (g.in_edges(['findspark(repo)']))
print (g.out_edges(['findspark(repo)']))
</pre>

	Name: 
	Type: DiGraph
	Number of nodes: 81
	Number of edges: 80
	Average in degree: 0.9877 # 80/81 Average out degree: 0.9877 # 80/81
	
	{â€˜langâ€™: â€˜Pythonâ€™, â€˜typeâ€™: â€˜repoâ€™, â€˜ownerâ€™: â€˜minrkâ€™}
	{â€˜typeâ€™: â€˜userâ€™}
	
	{â€˜typeâ€™: â€˜gazesâ€™}
	{â€˜findspark(repo)â€™: {â€˜typeâ€™: â€˜gazesâ€™}}
	{}
	[]
	[(â€˜luzhijun(user)â€™, â€˜findspark(repo)â€™)]
	[(â€˜lendenmc(user)â€™, â€˜findspark(repo)â€™), (â€˜nehalecky(user)â€™, â€˜findspark(repo)â€™), (â€˜charsmith(user)â€™, â€˜findspark(repo)â€™), (â€˜cwharland(user)â€™, â€˜findspark(repo)â€™), (â€˜d3borah(user)â€™, â€˜findspark(repo)â€™), (â€˜cimox(user)â€™, â€˜findspark(repo)â€™), (â€˜dirmeier(user)â€™, â€˜findspark(repo)â€™), (â€˜paulochf(user)â€™, â€˜findspark(repo)â€™), (â€˜qingniufly(user)â€™, â€˜findspark(repo)â€™), (â€˜hmourit(user)â€™, â€˜findspark(repo)â€™), (â€˜ryan-williams(user)â€™, â€˜findspark(repo)â€™), (â€˜rholder(user)â€™, â€˜findspark(repo)â€™), (â€˜xysmas(user)â€™, â€˜findspark(repo)â€™), (â€˜linkTDP(user)â€™, â€˜findspark(repo)â€™), (â€˜minimaxir(user)â€™, â€˜findspark(repo)â€™), (â€˜KLXN(user)â€™, â€˜findspark(repo)â€™), (â€˜quadnix(user)â€™, â€˜findspark(repo)â€™), (â€˜luzhijun(user)â€™, â€˜findspark(repo)â€™), (â€˜chrinide(user)â€™, â€˜findspark(repo)â€™), (â€˜jaredmichaelsmith(user)â€™, â€˜findspark(repo)â€™), (â€˜rgbkrk(user)â€™, â€˜findspark(repo)â€™), (â€˜jiamo(user)â€™, â€˜findspark(repo)â€™), (â€˜drizham(user)â€™, â€˜findspark(repo)â€™), (â€˜assumednormal(user)â€™, â€˜findspark(repo)â€™), (â€˜cvincent00(user)â€™, â€˜findspark(repo)â€™), (â€˜xiaohan2012(user)â€™, â€˜findspark(repo)â€™), (â€˜dapurv5(user)â€™, â€˜findspark(repo)â€™), (â€˜pchalasani(user)â€™, â€˜findspark(repo)â€™), (â€˜benetka(user)â€™, â€˜findspark(repo)â€™), (â€˜rohithreddy(user)â€™, â€˜findspark(repo)â€™), (â€˜seanjensengrey(user)â€™, â€˜findspark(repo)â€™), (â€˜opikalo(user)â€™, â€˜findspark(repo)â€™), (â€˜amontalenti(user)â€™, â€˜findspark(repo)â€™), (â€˜Bekterra(user)â€™, â€˜findspark(repo)â€™), (â€˜Grillz(user)â€™, â€˜findspark(repo)â€™), (â€˜nchammas(user)â€™, â€˜findspark(repo)â€™), (â€˜markbarks(user)â€™, â€˜findspark(repo)â€™), (â€˜jesusjsc(user)â€™, â€˜findspark(repo)â€™), (â€˜d2207197(user)â€™, â€˜findspark(repo)â€™), (â€˜Erstwild(user)â€™, â€˜findspark(repo)â€™), (â€˜henridf(user)â€™, â€˜findspark(repo)â€™), (â€˜ranjankumar-gh(user)â€™, â€˜findspark(repo)â€™), (â€˜locojay(user)â€™, â€˜findspark(repo)â€™), (â€˜WilliamQLiu(user)â€™, â€˜findspark(repo)â€™), (â€˜szinya(user)â€™, â€˜findspark(repo)â€™), (â€˜seanjh(user)â€™, â€˜findspark(repo)â€™), (â€˜vherasme(user)â€™, â€˜findspark(repo)â€™), (â€˜stared(user)â€™, â€˜findspark(repo)â€™), (â€˜freeman-lab(user)â€™, â€˜findspark(repo)â€™), (â€˜wy36101299(user)â€™, â€˜findspark(repo)â€™), (â€˜esafak(user)â€™, â€˜findspark(repo)â€™), (â€˜napjon(user)â€™, â€˜findspark(repo)â€™), (â€˜richardskim111(user)â€™, â€˜findspark(repo)â€™), (â€˜SimonArnu(user)â€™, â€˜findspark(repo)â€™), (â€˜lmillefiori(user)â€™, â€˜findspark(repo)â€™), (â€˜binhe22(user)â€™, â€˜findspark(repo)â€™), (â€˜robcowie(user)â€™, â€˜findspark(repo)â€™), (â€˜jazzwang(user)â€™, â€˜findspark(repo)â€™), (â€˜Dumbris(user)â€™, â€˜findspark(repo)â€™), (â€˜giulioungaretti(user)â€™, â€˜findspark(repo)â€™), (â€˜cbouey(user)â€™, â€˜findspark(repo)â€™), (â€˜andrewiiird(user)â€™, â€˜findspark(repo)â€™), (â€˜DaniGate(user)â€™, â€˜findspark(repo)â€™), (â€˜rdhyee(user)â€™, â€˜findspark(repo)â€™), (â€˜lgautier(user)â€™, â€˜findspark(repo)â€™), (â€˜sandysnunes(user)â€™, â€˜findspark(repo)â€™), (â€˜willcline(user)â€™, â€˜findspark(repo)â€™), (â€˜aliciatb(user)â€™, â€˜findspark(repo)â€™), (â€˜d18s(user)â€™, â€˜findspark(repo)â€™), (â€˜he0x(user)â€™, â€˜findspark(repo)â€™), (â€˜liulixiang1988(user)â€™, â€˜findspark(repo)â€™), (â€˜alexandercbooth(user)â€™, â€˜findspark(repo)â€™), (â€˜branning(user)â€™, â€˜findspark(repo)â€™), (â€˜bguOIQ(user)â€™, â€˜findspark(repo)â€™), (â€˜coder-chenzhi(user)â€™, â€˜findspark(repo)â€™), (â€˜mdbishop(user)â€™, â€˜findspark(repo)â€™), (â€˜Hguimaraes(user)â€™, â€˜findspark(repo)â€™), (â€˜ocanbascil(user)â€™, â€˜findspark(repo)â€™), (â€˜fish2000(user)â€™, â€˜findspark(repo)â€™), (â€˜stzonis(user)â€™, â€˜findspark(repo)â€™)]
	[]


###	15.1.4 NetWorkXéƒ¨åˆ†ç»Ÿè®¡æŒ‡æ ‡

(1)åº¦ä¸­å¿ƒæ€§ï¼ˆDegree Centrality):æ˜¯åœ¨ç½‘ç»œåˆ†æä¸­åˆ»ç”»èŠ‚ç‚¹ä¸­å¿ƒæ€§ï¼ˆCentralityï¼‰çš„æœ€ç›´æ¥åº¦é‡æŒ‡æ ‡ã€‚ä¸€ä¸ªèŠ‚ç‚¹çš„èŠ‚ç‚¹åº¦è¶Šå¤§å°±æ„å‘³ç€è¿™ä¸ªèŠ‚ç‚¹çš„åº¦ä¸­å¿ƒæ€§è¶Šé«˜ï¼Œè¯¥èŠ‚ç‚¹åœ¨ç½‘ç»œä¸­å°±è¶Šé‡è¦ã€‚æŸç‚¹çš„åº¦ä¸­å¿ƒæ€§[Math Processing Error]Cd(i)=d(i)nâˆ’1ï¼ŒèŒƒå›´ä¸º[0,1]ã€‚

- degree_centrality(G) Compute the degree centrality for nodes.
- in_degree_centrality(G) Compute the in-degree centrality for nodes.
- out_degree_centrality(G) Compute the out-degree centrality for nodes.

(2)ä¸­ä»‹ä¸­å¿ƒæ€§/ä¸­é—´ä¸­å¿ƒæ€§(Between Centrality) ã€‚ä»¥ç»è¿‡æŸä¸ªèŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„æ•°ç›®æ¥åˆ»ç”»èŠ‚ç‚¹é‡è¦æ€§çš„æŒ‡æ ‡ã€‚å¦‚æœä¸¤ä¸ªä¸ç›¸é‚»çš„å‚ä¸è€…kå’Œjæƒ³è¦ä¸å¯¹æ–¹äº’åŠ¨è€Œå‚ä¸è€…iå¤„åœ¨å®ƒä»¬çš„è·¯å¾„ä¸Šï¼Œé‚£ä¹ˆiå¯èƒ½å¯¹å®ƒä»¬ä¹‹é—´çš„äº’åŠ¨æ‹¥æœ‰ä¸€å®šçš„æ§åˆ¶åŠ›ã€‚ä¸­ä»‹æ€§ç”¨æ¥åº¦é‡iå¯¹äºå…¶ä»–ç»“ç‚¹çš„æ§åˆ¶èƒ½åŠ›ã€‚å³å¦‚æœiå¤„åœ¨éå¸¸å¤šç»“ç‚¹çš„äº¤äº’è·¯å¾„ä¸Šï¼Œé‚£ä¹ˆiå°±æ˜¯ä¸€ä¸ªé‡è¦çš„å‚ä¸è€…ã€‚

- betweenness_centrality(G[, normalized, â€¦]) Compute betweenness centrality for nodes.
- edge_betweenness_centrality(G[, normalized, â€¦]) Compute betweenness centrality for edges.

(3)æ¥è¿‘ä¸­å¿ƒæ€§ï¼ˆCloseness Centralityï¼‰åæ˜ åœ¨ç½‘ç»œä¸­æŸä¸€èŠ‚ç‚¹ä¸å…¶ä»–èŠ‚ç‚¹ä¹‹é—´çš„æ¥è¿‘ç¨‹åº¦ã€‚è¿™ç§ä¸­å¿ƒæ€§çš„è§‚å¯Ÿè§†è§’ä¸»è¦åŸºäºæ¥è¿‘åº¦æˆ–è€…è·ç¦»ã€‚å®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯å¦‚æœä¸€ä¸ªå‚ä¸è€…èƒ½å¾ˆå®¹æ˜“çš„ä¸æ‰€æœ‰å…¶ä»–å‚ä¸è€…è¿›è¡Œäº’åŠ¨ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸­å¿ƒçš„ã€‚å³å®ƒåˆ°å…¶ä»–æ‰€ä»¥å‚ä¸è€…çš„è·ç¦»è¦è¶³å¤ŸçŸ­ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æœ€çŸ­è·ç¦»æ¥è®¡ç®—è¿™ä¸ªæ•°å€¼ã€‚å‡è®¾å‚ä¸è€…iå’Œå‚ä¸è€…jä¹‹é—´çš„æœ€çŸ­è·ç¦»è®°ä¸ºd(i,j)ï¼ˆç”±æœ€çŸ­è·¯å¾„ä¸Šçš„é“¾æ¥æ•°ç›®åº¦é‡ï¼‰ã€‚Cc(i)=nâˆ’1âˆ‘j=1nd(i,j)

- closeness_centrality(G[, v, weighted_edges]) Compute closeness centrality for nodes.

ä½œä¸ºå­¦ä¹ ï¼Œæˆ‘ä»¬ä½¿ç”¨Krackhardt kite graphæ¥ç ”ç©¶ï¼Œä¹‹æ‰€ä»¥ç§°ä¹‹ä¸ºé£ç­å›¾ï¼Œå› ä¸ºé•¿å¾—åƒé£ç­ã€‚ã€‚ã€‚(åºŸè¯)
![](https://i.imgur.com/lWxUV4Q.png)

<pre>
from operator import itemgetter
kkg = nx.generators.small.krackhardt_kite_graph()
print ("Degree Centrality")
print (sorted(nx.degree_centrality(kkg).items(), 
             key=itemgetter(1), reverse=True),'\n')
print ("Betweenness Centrality")
print (sorted(nx.betweenness_centrality(kkg).items(), 
             key=itemgetter(1), reverse=True),'\n')
print ("Closeness Centrality")
print (sorted(nx.closeness_centrality(kkg).items(), 
             key=itemgetter(1), reverse=True))
</pre>

	Degree Centrality [(3, 0.6666666666666666), (5, 0.5555555555555556), (6, 0.5555555555555556), (0, 0.4444444444444444), (1, 0.4444444444444444), (2, 0.3333333333333333), (4, 0.3333333333333333), (7, 0.3333333333333333), (8, 0.2222222222222222), (9, 0.1111111111111111)]
	
	Betweenness Centrality [(7, 0.38888888888888884), (5, 0.23148148148148148), (6, 0.23148148148148148), (8, 0.2222222222222222), (3, 0.10185185185185183), (0, 0.023148148148148143), (1, 0.023148148148148143), (2, 0.0), (4, 0.0), (9, 0.0)]
	
	Closeness Centrality [(5, 0.6428571428571429), (6, 0.6428571428571429), (3, 0.6), (7, 0.6), (0, 0.5294117647058824), (1, 0.5294117647058824), (2, 0.5), (4, 0.5), (8, 0.42857142857142855), (9, 0.3103448275862069)]
###	15.1.5 æ„å»ºgithubçš„å…´è¶£å›¾
> æ‰¾å‡ºå¤§ç¥

å¤§ç¥ä¸€èˆ¬éƒ½æ˜¯å…³æ³¨è€…å¾ˆé«˜ï¼Œåœ¨ç¤¾åŒºä¸­å¾ˆæ´»è·ƒï¼Œé™¤äº†å‰é¢åŠ æ˜Ÿï¼Œç±»ä¼¼å¾®åšã€facebookï¼Œgithubæˆ‘ä»¬è¿˜æœ‰â€œå…³æ³¨â€å…³ç³»å¯ä»¥ç”¨ï¼Œç°åœ¨å¯¹å‰é¢æ‰©å±•å…³æ³¨å…³ç³»ï¼Œå¯¹æ¯ä¸ªåŠ æ˜Ÿçš„ç”¨æˆ·æ‰©å±•ã€‚è¿™é‡Œç®€å•èµ·è§ï¼Œå…³æ³¨è€…éƒ½æ˜¯ç°æœ‰çš„ç»“ç‚¹ï¼Œä¸å†æ–°å¢ç»“ç‚¹ã€‚ 
ç”±äºAPIæ¯å°æ—¶é™åˆ¶ä½¿ç”¨5000ä¸ªè¯·æ±‚ï¼Œæ‰“å°ä¸‹å‰©ä½™è¯·æ±‚æ•°çœ‹æœ‰æ²¡æœ‰è€—å°½ï¼Œè€—å°½çš„è¯æŠ›å‡ºå¼‚å¸¸ã€‚

<pre>
import sys
for i, sg in enumerate(stargazers):   
    # å¢åŠ å…³æ³¨è”ç³»ï¼Œå¦‚æœæœ‰å…³æ³¨è€…çš„è¯
        try:
        for follower in sg.get_followers():
            if follower.login + '(user)' in g:
                g.add_edge(follower.login + '(user)', sg.login + '(user)', 
                           type='follows')
    except Exception: #ssl.SSLError
        sys.stderr.write( "Encountered an error fetching followers for", \
                             sg.login, "Skipping.")

    print ("Processed", i+1, " stargazers. Num nodes/edges in graph", \
          g.number_of_nodes(), "/", g.number_of_edges())
    print ("Rate limit remaining", client.rate_limiting)
</pre>

	rocessed 1 stargazers. Num nodes/edges in graph 81 / 80
	Rate limit remaining (4999, 5000)
	Processed 2 stargazers. Num nodes/edges in graph 81 / 83
	Rate limit remaining (4987, 5000)
	Processed 3 stargazers. Num nodes/edges in graph 81 / 84
	Rate limit remaining (4985, 5000)
	Processed 4 stargazers. Num nodes/edges in graph 81 / 85
	Rate limit remaining (4983, 5000)
	Processed 5 stargazers. Num nodes/edges in graph 81 / 86
	Rate limit remaining (4981, 5000)
	Processed 6 stargazers. Num nodes/edges in graph 81 / 90
	Rate limit remaining (4968, 5000)
	â€¦
	Rate limit remaining (4857, 5000)
	Processed 78 stargazers. Num nodes/edges in graph 81 / 95
	Rate limit remaining (4856, 5000)
	Processed 79 stargazers. Num nodes/edges in graph 81 / 95
	Rate limit remaining (4855, 5000)
	Processed 80 stargazers. Num nodes/edges in graph 81 / 95
	Rate limit remaining (4854, 5000)

æ¥ä¸‹æ¥ï¼Œå¯¹å…³è”å…³ç³»ç»Ÿè®¡ã€‚

<pre>
from operator import itemgetter
from collections import Counter

# çœ‹ä¸‹æ›´æ–°çš„å›¾ä¿¡æ¯
print (nx.info(g),'\n')

# æ¯ä¸ªæ‰“æ˜Ÿç”¨æˆ·çš„å…³æ³¨è€…æ•°é‡ä¸åŒ
print (len([e for e in g.edges_iter(data=True) if e[2]['type'] == 'follows']),'\n')

# æŸ¥çœ‹æŸä¸ªæ‰“æ˜Ÿç”¨æˆ·æœ‰å¤šå°‘å…³æ³¨è€…
print (len([e 
           for e in g.edges_iter(data=True) 
               if e[2]['type'] == 'follows' and e[1] == 'freeman-lab(user)']),'\n')


# æ‰“å°åº¦æœ€å¤šçš„å‰10ä¸ªç»“ç‚¹
print (list(sorted([n for n in g.degree_iter()], key=itemgetter(1), reverse=True)[:10]),'\n')


# å¯¹æ¯ä¸ªæ‰“æ˜Ÿç”¨æˆ·çš„å…³æ³¨è€…æ•°ç›®è®¡æ•°
c = Counter([e[1] for e in g.edges_iter(data=True) if e[2]['type'] == 'follows'])
popular_users = [ (u, f) for (u, f) in c.most_common() if f > 0 ]
print ("Number of popular users", len(popular_users))
print ("Top popular users:", popular_users[:10])
</pre>

	Name: Type: DiGraph Number of nodes: 81 Number of edges: 95 Average in degree: 1.1728 Average out degree: 1.1728
	
	15
	
	4
	
	[(â€˜findspark(repo)â€™, 80), (â€˜rgbkrk(user)â€™, 6), (â€˜freeman-lab(user)â€™, 5), (â€˜esafak(user)â€™, 4), (â€˜andrewiiird(user)â€™, 4), (â€˜minimaxir(user)â€™, 3), (â€˜nchammas(user)â€™, 3), (â€˜rholder(user)â€™, 2), (â€˜chrinide(user)â€™, 2), (â€˜dapurv5(user)â€™, 2)]
	
	Number of popular users 9 Top popular users: [(â€˜freeman-lab(user)â€™, 4), (â€˜rgbkrk(user)â€™, 3), (â€˜minimaxir(user)â€™, 2), (â€˜rholder(user)â€™, 1), (â€˜amontalenti(user)â€™, 1), (â€˜rdhyee(user)â€™, 1), (â€˜stared(user)â€™, 1), (â€˜esafak(user)â€™, 1), (â€˜nchammas(user)â€™, 1)]

(â€˜freeman-lab(user)â€™, 4)æŒ‡freeman-labåœ¨findsparké¡¹ç›®ä¸­çš„åŠ æ˜Ÿè€…ä¸­è¿˜æœ‰4ä¸ªå…³æ³¨è€…ï¼Œä¸ºäº†æ›´æ¸…æ¥šæŒ–æ˜å›¾ä¿¡æ¯ï¼Œç”¨ä¸Šé¢ä»‹ç»çš„å‡ ä¸ªå›¾ç®—æ³•æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå›¾ï¼Œç”±äºâ€™ä»“åº“â€™ç»“ç‚¹æœ‰å¤§é‡çš„åº¦ï¼Œå…¶ä»–ç»“ç‚¹ç›¸æ¯”æ¥è¯´åº¦éƒ½å¾ˆå°ï¼Œå› æ­¤å…ˆåˆ æ‰â€™ä»“åº“â€™ç»“ç‚¹å†è®¡ç®—ã€‚
<pre>
from operator import itemgetter
h = g.copy()
# ç§»é™¤ä¸­å¿ƒç»“ç‚¹
h.remove_node('findspark(repo)')

dc = sorted(nx.degree_centrality(h).items(), 
            key=itemgetter(1), reverse=True)

print ("Degree Centrality")
print (dc[:10],'\n')
bc = sorted(nx.betweenness_centrality(h).items(), 
            key=itemgetter(1), reverse=True)

print ("Betweenness Centrality")
print (bc[:10],'\n')

print ("Closeness Centrality")
cc = sorted(nx.closeness_centrality(h).items(), 
            key=itemgetter(1), reverse=True)
print (cc[:10])
</pre>

	Degree Centrality
	[(â€˜rgbkrk(user)â€™, 0.06329113924050633), 
	(â€˜freeman-lab(user)â€™, 0.05063291139240506),
	(â€˜esafak(user)â€™, 0.0379746835443038), 
	(â€˜andrewiiird(user)â€™, 0.0379746835443038), 
	(â€˜minimaxir(user)â€™, 0.02531645569620253), 
	(â€˜nchammas(user)â€™, 0.02531645569620253), 
	(â€˜rholder(user)â€™, 0.012658227848101266), 
	(â€˜chrinide(user)â€™, 0.012658227848101266), 
	(â€˜dapurv5(user)â€™, 0.012658227848101266), 
	(â€˜amontalenti(user)â€™, 0.012658227848101266)]
	
	Betweenness Centrality
	[(â€˜rgbkrk(user)â€™, 0.0009737098344693282), 
	(â€˜esafak(user)â€™, 0.0006491398896462187), 
	(â€˜nchammas(user)â€™, 0.0001622849724115547), 
	(â€˜linkTDP(user)â€™, 0.0), 
	(â€˜nehalecky(user)â€™, 0.0), 
	(â€˜charsmith(user)â€™, 0.0), 
	(â€˜cwharland(user)â€™, 0.0), 
	(â€˜d3borah(user)â€™, 0.0), 
	(â€˜cimox(user)â€™, 0.0), 
	(â€˜dirmeier(user)â€™, 0.0)]
	
	Closeness Centrality
	[(â€˜andrewiiird(user)â€™, 0.04050632911392405), 
	(â€˜esafak(user)â€™, 0.03375527426160337), 
	(â€˜chrinide(user)â€™, 0.028768699654775604), 
	(â€˜rgbkrk(user)â€™, 0.02531645569620253), 
	(â€˜alexandercbooth(user)â€™, 0.02278481012658228), 
	(â€˜dapurv5(user)â€™, 0.012658227848101266), 
	(â€˜Bekterra(user)â€™, 0.012658227848101266), 
	(â€˜nchammas(user)â€™, 0.012658227848101266), 
	(â€˜he0x(user)â€™, 0.012658227848101266), 
	(â€˜Hguimaraes(user)â€™, 0.012658227848101266)]

æ¥ï¼Œæˆ‘ä»¬æ¥è§è§ä¸¤ä½å¤§ç¥ï¼Œä¸€ä½æ˜¯æ•°æ®æ˜¾ç¤ºåº¦ä¸­å¿ƒæ€§å’Œä¸­ä»‹ä¸­å¿ƒæ€§æœ€å¤§çš„rgbkrkã€‚

![](https://i.imgur.com/hd5TVM6.png)

Kyle Kelleyæ¥è‡ªç¡…è°·ï¼Œæ˜¯jupyterã€ipythonã€cloudpipeç­‰å¤§é¡¹ç›®çš„å¼€å‘ç»„å‘˜ï¼Œå½±å“åŠ›å¾ˆå¤§ã€‚
å¦ä¸€ä½æ˜¯æ¥è¿‘ä¸­å¿ƒæ€§æœ€å¤§çš„andrewiiirdã€‚
![](https://i.imgur.com/gfRGk8Q.png)
andrewæ¥è‡ªé¦™æ¸¯ï¼Œå…³æ³¨ä¸è¢«å…³æ³¨æ¯”ç‡å‡ ä¹æœ‰ä¸¤ä¸ªæ•°é‡çº§çš„å·®åˆ«ï¼Œè€ŒKyle Kelleyè¿™ä¸ªæ¯”å€¼æ¥è¿‘ä¸€æ¯”ä¸€ï¼Œä¹Ÿæ­£è¯´æ˜äº†andrewçš„â€œäº’åŠ¨æ€§â€å¾ˆå¼ºçš„ã€‚(å¤§éƒ¨åˆ†æ—¶é—´å…³æ³¨åˆ«äººè€Œè‡ªå·±éšè—åœ¨æš—å¤„ï¼ŒğŸ˜œ)

> æ‰¾å‡ºæ´»è·ƒé¡¹ç›®

ç°åœ¨å›¾ä¸­åªæœ‰ä¸€ä¸ªé¡¹ç›®ï¼Œå…¶ä½™ç»“ç‚¹éƒ½æ˜¯ç”¨æˆ·ã€‚ä¸ºäº†æ‰¾å‡ºæ´»è·ƒé¡¹ç›®ï¼Œå¯¹æ¯ä¸ªç”¨æˆ·ï¼Œéå†æ‰¾å…¶åŠ æ˜Ÿçš„é¡¹ç›®æ·»åŠ åˆ°å›¾ä¸­ï¼Œæ‰©å……å›¾çš„é¡¹ç›®ç»“ç‚¹ã€‚
<pre>
MAX_REPOS = 500
for i, sg in enumerate(stargazers):
    print (sg.login)
    try:
        for starred in sg.get_starred()[:MAX_REPOS]: # Slice to avoid supernodes
            g.add_node(starred.name + '(repo)', type='repo', lang=starred.language, \
                       owner=starred.owner.login)
            g.add_edge(sg.login + '(user)', starred.name + '(repo)', type='gazes')
    except Exception: #ssl.SSLError:
        print ("Encountered an error fetching starred repos for", sg.login, "Skipping.")

    print ("Processed", i+1, "stargazers' starred repos")
    print ("Num nodes/edges in graph", g.number_of_nodes(), "/", g.number_of_edges())
    print ("Rate limit", client.rate_limiting)

</pre>

	pchalasani
	Processed 1 stargazersâ€™ starred repos
	Num nodes/edges in graph 176 / 190
	Rate limit (4996, 5000)
	rgbkrk
	Encountered an error fetching starred repos for rgbkrk Skipping.
	Processed 2 stargazersâ€™ starred repos
	Num nodes/edges in graph 266 / 280
	Rate limit (4993, 5000)
	napjon
	Processed 79 stargazersâ€™ starred repos
	Num nodes/edges in graph 12692 / 17579
	Rate limit (4369, 5000)
	luzhijun
	Processed 80 stargazersâ€™ starred repos
	Num nodes/edges in graph 12693 / 17581
	Rate limit (4368, 5000)

ä»¥ä¸Šæ“ä½œæŒºè´¹æ—¶é—´çš„ï¼Œç»“ç‚¹æ•°ç”±å‡ ç™¾ä¸ªä¸€ä¸‹å­æ‰©å……åˆ°ä¸Šä¸‡ä¸ªï¼Œå¯ä»¥æŠŠMAX_REPOSæ”¹å°ä¸€ç‚¹ï¼Œç„¶åå»æ³¡æ¯å’–å•¡å§ğŸ˜ã€‚
æ‹¿åˆ°æ‰€æœ‰é¡¹ç›®æ•°æ®ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦ç»Ÿè®¡å“ªä¸ªæ˜¯çƒ­ç‚¹é¡¹ç›®ï¼Œå¯ä»¥æŸ¥è¯¢å“ªä¸ªç”¨æˆ·markäº†å“ªäº›é¡¹ç›®ï¼Œä»–å–œæ¬¢ç”¨å•¥ç¨‹åºè¯­è¨€ï¼Œè¿˜æœ‰é‚£äº›åŠ æ˜ŸåŠ åˆ°æ‰‹è½¯çš„ç”¨æˆ·ä¹Ÿå¯ä»¥æŸ¥è¯¢å‡ºæ¥ã€‚
<pre>
print (nx.info(g),'\n')
# æ‹¿åˆ°å›¾é‡Œé¢çš„æ‰€æœ‰é¡¹ç›®æ„æˆåˆ—è¡¨
repos = [n for n in g.nodes_iter() if g.node[n]['type'] == 'repo']

# å…³æ³¨æœ€å¤šçš„å‰10ä¸ªé¡¹ç›®
print ("Popular repositories")
print (sorted([(n,d) 
              for (n,d) in g.in_degree_iter() 
                  if g.node[n]['type'] == 'repo'], \
             key=itemgetter(1), reverse=True)[:10])

print "Respositories that luzhijun has bookmarked"
print ([(n,g.node[n]['lang']) 
       for n in g['luzhijun(user)'] 
           if g['luzhijun(user)'][n]['type'] == 'gazes'])

# ç”¨æˆ·å–œçˆ±çš„ç¨‹åºè¯­è¨€

print ("Programming languages luzhijun is interested in")
print (list(set([g.node[n]['lang'] 
                for n in g['luzhijun(user)'] 
                    if g['luzhijun(user)'][n]['type'] == 'gazes'])))
#æŸ¥çœ‹å…³æ³¨é¡¹ç›®æœ€å¤šçš„ç”¨æˆ·(è¶…è¿‡MAX_REPOS)
print ("Supernode candidates")
print (sorted([(n, len(g.out_edges(n))) 
              for n in g.nodes_iter() 
                  if g.node[n]['type'] == 'user' and len(g.out_edges(n)) > MAX_REPOS], \
             key=itemgetter(1), reverse=True))
</pre>
	
	Name: 
	Type: DiGraph
	Number of nodes: 12693
	Number of edges: 17581
	Average in degree: 1.3851
	Average out degree: 1.3851
	
	Popular repositories
	[(â€˜findspark(repo)â€™, 80), (â€˜spark(repo)â€™, 27), (â€˜tensorflow(repo)â€™, 24), (â€˜luigi(repo)â€™, 21), (â€˜ipython(repo)â€™, 21), (â€˜data-science-ipython-notebooks(repo)â€™, 20), (â€˜awesome-public-datasets(repo)â€™, 20), (â€˜spark-notebook(repo)â€™, 19), (â€˜docker(repo)â€™, 18), (â€˜Probabilistic-Programming-and-Bayesian-Methods-for-Hackers(repo)â€™, 17)]
	
	Respositories that ocanbascil has bookmarked
	[(â€˜til(repo)â€™, â€˜VimLâ€™), (â€˜react-joyride(repo)â€™, â€˜JavaScriptâ€™), (â€˜django(repo)â€™, â€˜Pythonâ€™), (â€˜peewee(repo)â€™, â€˜Pythonâ€™), (â€˜select2(repo)â€™, â€˜JavaScriptâ€™), (â€˜requests(repo)â€™, â€˜Pythonâ€™), (â€˜benfords-law(repo)â€™, â€˜JavaScriptâ€™), (â€˜daterangepicker(repo)â€™, â€˜JavaScriptâ€™), (â€˜django-zappa(repo)â€™, â€˜Pythonâ€™), (â€˜layered(repo)â€™, â€˜Pythonâ€™), (â€˜coffeescript(repo)â€™, â€˜CoffeeScriptâ€™), (â€˜awesome-jekyll(repo)â€™, None), (â€˜lektor(repo)â€™, â€˜Pythonâ€™), (â€˜aetycoon(repo)â€™, â€˜Pythonâ€™), (â€˜computer-science(repo)â€™, None), (â€˜PerformanceEngine(repo)â€™, â€˜Pythonâ€™), (â€˜pattern_classification(repo)â€™, â€˜Jupyter Notebookâ€™), (â€˜node-v0.x-archive(repo)â€™, None), (â€˜django-crispy-forms(repo)â€™, â€˜Pythonâ€™), (â€˜hug(repo)â€™, â€˜Pythonâ€™), (â€˜euler-coffeescript(repo)â€™, â€˜CoffeeScriptâ€™), (â€˜pandas(repo)â€™, â€˜Pythonâ€™), (â€˜pachyderm(repo)â€™, â€˜Goâ€™), (â€˜eulerclash(repo)â€™, None), (â€˜Pipe(repo)â€™, â€˜Pythonâ€™), (â€˜data-science-ipython-notebooks(repo)â€™, â€˜Pythonâ€™), (â€˜TweetHit(repo)â€™, â€˜Pythonâ€™), (â€˜captionmash(repo)â€™, None), (â€˜django-tinymce(repo)â€™, â€˜Pythonâ€™), (â€˜dataset(repo)â€™, â€˜Pythonâ€™), (â€˜shepherd(repo)â€™, â€˜CSSâ€™), (â€˜data-science-from-scratch(repo)â€™, â€˜Pythonâ€™), (â€˜spark(repo)â€™, â€˜Scalaâ€™), (â€˜data-science-blogs(repo)â€™, â€˜Pythonâ€™), (â€˜specter(repo)â€™, â€˜Clojureâ€™), (â€˜tensorflow(repo)â€™, â€˜Râ€™), (â€˜findspark(repo)â€™, â€˜Pythonâ€™), (â€˜localtunnel(repo)â€™, â€˜JavaScriptâ€™)]
	
	Programming languages ocanbascil is interested in
	[â€˜CSSâ€™, â€˜VimLâ€™, â€˜Pythonâ€™, â€˜JavaScriptâ€™, â€˜Clojureâ€™, None, â€˜CoffeeScriptâ€™, â€˜Râ€™, â€˜Jupyter Notebookâ€™, â€˜Scalaâ€™, â€˜Goâ€™]
	
	Supernode candidates [(â€˜he0x(user)â€™, 501), (â€˜esafak(user)â€™, 501)]

ä»ç»“æœå¯çœ‹å‡ºï¼Œå…³æ³¨findsparké¡¹ç›®çš„äººå¤§çº¦ä¸‰åˆ†ä¹‹ä¸€ä¹Ÿå…³æ³¨äº†sparkå’Œtensorflowï¼ŒTensorFlowæ˜¯è°·æ­ŒåŸºäºDistBeliefè¿›è¡Œç ”å‘çš„ç¬¬äºŒä»£äººå·¥æ™ºèƒ½å­¦ä¹ ç³»ç»Ÿï¼Œæœºå™¨å­¦ä¹ æœçœŸè¿™ä¹ˆç«çƒ­ã€‚å¤§çº¦å››åˆ†ä¹‹ä¸€çš„äººå…³æ³¨äº†Luigiï¼ŒæŸ¥äº†ä¸‹å…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³éœ€è¦é•¿æœŸè¿è¡Œçš„æµå¼æ‰¹å¤„ç†ä»»åŠ¡çš„ç®¡ç†ï¼Œå¯ä»¥é“¾æ¥å¾ˆå¤šä¸ªä»»åŠ¡ï¼Œä½¿å®ƒä»¬è‡ªåŠ¨åŒ–ï¼Œå¹¶è¿›è¡Œæ•…éšœç®¡ç†ï¼Œè¿™ä¸ªåšsparkä»»åŠ¡çš„äººä¼°è®¡ä¹Ÿéœ€è¦ï¼Œï¼Œåé¢å‡ ä¸ªçœ‹åå­—éƒ½çŸ¥é“å’Œsparkå¯†ä¸å¯åˆ†çš„ã€‚
é™¤æ­¤ä¹‹å¤–ï¼Œè¿™ä¸ªå›¾è¿˜å¯ä»¥æŸ¥è¯¢åˆ°æŸä¸ªç”¨æˆ·æ‰€å…³æ³¨çš„é¡¹ç›®ä»¥åŠè¿™ä¸ªé¡¹ç›®ä¸­æœ€å¤šçš„è¯­è¨€ã€‚

> æ‰¾å‡ºçƒ­é—¨è¯­è¨€

ç°åœ¨é—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆæŸ¥è¯¢å½“å‰å›¾ä¸­æ‰€æœ‰é¡¹ç›®æœ€çƒ­é—¨çš„è¯­è¨€ï¼Ÿæˆ‘ä»¬å¯ä»¥æŸ¥æ‰¾æ¯ä¸ªé¡¹ç›®ç„¶åæŠ½å–è¯­è¨€æ”¾å…¥åˆ°counterè®¡æ•°å™¨é‡Œé¢ç»Ÿè®¡ï¼Œè¿™ä¸ªçœ‹èµ·æ¥ä¹Ÿä¸è´¹äº‹ï¼Œä½†å¦‚æœè¦æŸ¥è¯¢æœ‰å¤šå°‘ç”¨æˆ·ä»¥æŸç§è¯­è¨€ç¼–ç¨‹å‘¢ï¼Ÿè¿™å°±è¦æ‰«ææ¯ä¸ªé¡¹ç›®çš„å…¥åº¦ç”¨æˆ·ï¼Œæœ€åç»Ÿè®¡æ±‚å’Œï¼Œæ—¶é—´å¤æ‚åº¦æŒºå¤§çš„ã€‚è¿™ä¸ªæ—¶å€™ä¸€ç§å¥½çš„æ€è·¯å°±æ˜¯æ‰©å……å›¾ï¼Œå°†è¯­è¨€å•ç‹¬ä½œä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ€ç»ˆå›¾çš„é€»è¾‘å›¾å¦‚ä¸‹ï¼š 
![](https://i.imgur.com/tMVKGWU.png)
<pre>
repos = [n 
         for n in g.nodes_iter() 
             if g.node[n]['type'] == 'repo']

for repo in repos:
    # æ¶ˆé™¤None,æœ‰äº›ç©ºé¡¹ç›®è¯­è¨€ä¸ºNone
    lang = (g.node[repo]['lang'] or "") + "(lang)"
    # åŠ æ˜Ÿäºrepoçš„ç”¨æˆ·
    stargazers = [u 
                  for (u, r, d) in g.in_edges_iter(repo, data=True) 
                     if d['type'] == 'gazes'
                 ]
    for sg in stargazers:
        g.add_node(lang, type='lang')
        g.add_edge(sg, lang, type='programs')
        g.add_edge(lang, repo, type='implements')   
</pre>

æ¥ä¸‹æ¥çœ‹ä¸‹å¯¹è¯­è¨€çš„ç»Ÿè®¡ä¿¡æ¯
<pre>
print (nx.info(g),'\n')
# çœ‹ä¸‹å›¾é‡Œæœ‰ä»€ä¹ˆè¯­è¨€
print ([n 
       for n in g.nodes_iter() 
           if g.node[n]['type'] == 'lang'])
# æŸä¸ªç”¨æˆ·ä½¿ç”¨çš„è¯­è¨€
print ([n 
       for n in g['ocanbascil(user)'] 
           if g['ocanbascil(user)'][n]['type'] == 'programs'],'\n')
# æŸ¥è¯¢æœ€çƒ­é—¨çš„è¯­è¨€
print ("Most popular languages")
print (sorted([(n, g.in_degree(n))
 for n in g.nodes_iter() 
     if g.node[n]['type'] == 'lang'], key=itemgetter(1), reverse=True)[:10])
# æŸ¥è¯¢ç”¨æŸç§è¯­è¨€çš„æœ‰å¤šå°‘äºº
python_programmers = [u 
                      for (u, l) in g.in_edges_iter('Python(lang)') 
                          if g.node[u]['type'] == 'user']
print ("Number of Python programmers:", len(python_programmers))

javascript_programmers = [u for 
                          (u, l) in g.in_edges_iter('JavaScript(lang)') 
                              if g.node[u]['type'] == 'user']
print ("Number of JavaScript programmers:", len(javascript_programmers))

# ä¸¤ä¸ªè¯­è¨€éƒ½ç”¨çš„äºº
print ("Number of programmers who use JavaScript and Python")
print (len(set(python_programmers).intersection(set(javascript_programmers))))

# åªç”¨pythonä¸ç”¨jsçš„äºº
print ("Number of programmers who use JavaScript but not Python")
print (len(set(javascript_programmers).difference(set(python_programmers))))

# XXX: Can you determine who is the most polyglot programmer?
</pre>


	Name: Type: DiGraph Number of nodes: 12807 Number of edges: 31824 Average in degree: 2.4849 Average out degree: 2.4849
	
	[â€˜LiveScript(lang)â€™, â€˜APL(lang)â€™, â€˜Swift(lang)â€™, â€˜Java(lang)â€™, â€˜Nix(lang)â€™, â€˜Erlang(lang)â€™, â€˜Common Lisp(lang)â€™, â€˜Python(lang)â€™, â€˜GCC Machine Description(lang)â€™, â€˜Prolog(lang)â€™, â€˜PigLatin(lang)â€™, â€˜Vala(lang)â€™, â€˜SAS(lang)â€™, â€˜FORTRAN(lang)â€™, â€˜Cuda(lang)â€™, â€˜Matlab(lang)â€™, â€˜HCL(lang)â€™, â€˜F#(lang)â€™, â€˜Verilog(lang)â€™, â€˜Emacs Lisp(lang)â€™, â€˜Inno Setup(lang)â€™, â€˜Vue(lang)â€™, â€˜TeX(lang)â€™, â€˜DTrace(lang)â€™, â€˜Processing(lang)â€™, â€˜Hack(lang)â€™, â€˜Lua(lang)â€™, â€˜Assembly(lang)â€™, â€˜Parrot(lang)â€™, â€˜Shell(lang)â€™, â€˜Arduino(lang)â€™, â€˜R(lang)â€™, â€˜C#(lang)â€™, â€˜Rust(lang)â€™, â€˜Standard ML(lang)â€™, â€˜Puppet(lang)â€™, â€˜Gosu(lang)â€™, â€˜C(lang)â€™, â€˜PHP(lang)â€™, â€˜Scala(lang)â€™, â€˜Gnuplot(lang)â€™, â€˜Crystal(lang)â€™, â€˜Objective-J(lang)â€™, â€˜COBOL(lang)â€™, â€˜Cucumber(lang)â€™, â€˜ApacheConf(lang)â€™, â€˜Brainfuck(lang)â€™, â€˜Kotlin(lang)â€™, â€˜Pascal(lang)â€™, â€˜Pike(lang)â€™, â€˜RAML(lang)â€™, â€˜Lean(lang)â€™, â€˜Logos(lang)â€™, â€˜Elixir(lang)â€™, â€˜Dart(lang)â€™, â€˜C++(lang)â€™, â€˜CMake(lang)â€™, â€˜Clojure(lang)â€™, â€˜D(lang)â€™, â€˜Batchfile(lang)â€™, â€˜OpenSCAD(lang)â€™, â€˜Coq(lang)â€™, â€˜PowerShell(lang)â€™, â€˜Visual Basic(lang)â€™, â€˜VimL(lang)â€™, â€˜NetLogo(lang)â€™, â€˜OCaml(lang)â€™, â€˜VHDL(lang)â€™, â€˜Ruby(lang)â€™, â€˜Go(lang)â€™, â€˜Metal(lang)â€™, â€˜Jupyter Notebook(lang)â€™, â€˜KiCad(lang)â€™, â€˜Smarty(lang)â€™, â€˜Tcl(lang)â€™, â€˜CoffeeScript(lang)â€™, â€˜QML(lang)â€™, â€˜(lang)â€™, â€˜Scheme(lang)â€™, â€˜HTML(lang)â€™, â€˜Makefile(lang)â€™, â€˜CartoCSS(lang)â€™, â€˜DIGITAL Command Language(lang)â€™, â€˜AppleScript(lang)â€™, â€˜Perl6(lang)â€™, â€˜Protocol Buffer(lang)â€™, â€˜Julia(lang)â€™, â€˜Awk(lang)â€™, â€˜Elm(lang)â€™, â€˜Haskell(lang)â€™, â€˜TLA(lang)â€™, â€˜Nimrod(lang)â€™, â€˜JavaScript(lang)â€™, â€˜Max(lang)â€™, â€˜TypeScript(lang)â€™, â€˜GAP(lang)â€™, â€˜Scilab(lang)â€™, â€˜Web Ontology Language(lang)â€™, â€˜XSLT(lang)â€™, â€˜Objective-C++(lang)â€™, â€˜Perl(lang)â€™, â€˜PLSQL(lang)â€™, â€˜PureScript(lang)â€™, â€˜PLpgSQL(lang)â€™, â€˜Eagle(lang)â€™, â€˜Objective-C(lang)â€™, â€˜Racket(lang)â€™, â€˜OpenEdge ABL(lang)â€™, â€˜Groovy(lang)â€™, â€˜Groff(lang)â€™, â€˜Frege(lang)â€™, â€˜NSIS(lang)â€™, â€˜Mathematica(lang)â€™, â€˜CSS(lang)â€™]
	
	[â€˜JavaScript(lang)â€™, â€˜R(lang)â€™, â€˜Python(lang)â€™, â€˜Jupyter Notebook(lang)â€™, â€˜VimL(lang)â€™, â€˜Scala(lang)â€™, â€˜Clojure(lang)â€™, â€˜CoffeeScript(lang)â€™, â€˜Go(lang)â€™, â€˜(lang)â€™, â€˜CSS(lang)â€™]
	
	Most popular languages
	[(â€˜Python(lang)â€™, 80), (â€˜(lang)â€™, 74), (â€˜JavaScript(lang)â€™, 74), (â€˜Jupyter Notebook(lang)â€™, 69), (â€˜Java(lang)â€™, 67), (â€˜HTML(lang)â€™, 67), (â€˜C++(lang)â€™, 66), (â€˜Scala(lang)â€™, 65), (â€˜Shell(lang)â€™, 62), (â€˜C(lang)â€™, 62)]
	
	Number of Python programmers: 80
	Number of JavaScript programmers: 74
	Number of programmers who use JavaScript and Python
	74
	Number of programmers who use JavaScript but not Python
	0

ä»ç»“æœçœ‹å‡ºï¼Œgithubä¸Šå–œæ¬¢çš„è¯­è¨€æ’è¡Œæ¦œä¸­jsã€rã€pythonç­‰è„šæœ¬è¯­è¨€å æ®ä¸»æµï¼Œè™½ç„¶å‚ä¸ç»Ÿè®¡çš„é¡¹ç›®åªæœ‰ä¸€ä¸‡å¤šæ¡ï¼Œä½†è¿™ä¹Ÿåº”ç€äº†ä¸€å¥è€è¯â€œgithubæ˜¯å‰ç«¯çš„å¤©ä¸‹â€ğŸ˜ã€‚è¿™é‡ŒScalaçš„å…³æ³¨åº¦ä¹Ÿå¾ˆé å‰ï¼Œä¸»è¦å› ä¸ºâ€œé¡¹ç›®ä¹‹æºâ€æ˜¯findsparkï¼Œgoè¿™é‡Œä¹Ÿå¾ˆç«ï¼Œjavaæ­»å“ªå»äº†ã€‚ã€‚ã€‚ï¼Œä¼°è®¡æŒ–ä¸ªhadoopçš„ç›¸å…³é¡¹ç›®å°±æœ‰ä»–äº†ã€‚ã€‚ã€‚
å¦ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡æ˜¯ï¼Œç©pythonçš„ç¨‹åºå‘˜å¿…ä¼šç©jsï¼Œç©jsçš„äººä¸ä¸€å®šä¼šç©pythonï¼ˆ80-74=6ä¸ªäººä¸ä¼šç©python)ï¼Œæ­£ç¬¦åˆç°åœ¨ITç•Œçš„ç°çŠ¶å•Šï¼Œè¿™ä¸ªå·®åˆ«ä¸æ˜æ˜¾ï¼Œæ¢ä¸ªå›½å†…çš„é¡¹ç›®ä¼°è®¡å°±æ˜æ˜¾äº†ã€‚ã€‚ã€‚ï¼Œä¼°è®¡è¿˜æœ‰å¤šå°‘äººä¸çŸ¥é“githubï¼Œè¿™é‡Œå°±ç»Ÿè®¡ä¸äº†ã€‚

ä»¥ä¸Šæ•°æ®è§„æ¨¡å¹¶ä¸ç®—å¤§ï¼Œå¦‚æœæœ‰å…´è¶£å¯ä»¥è®¿é—®GitHub Archive,GitHub Archive æä¾›æµ·é‡å…¨å±€å±‚é¢çš„æ•°æ®ï¼Œè°ƒå¯ä»¥ä½¿ç”¨ä¸€äº›æ¨èçš„â€œå¤§æ•°æ®â€å·¥å…·æ¥æ¢ç´¢å®ƒã€‚



###	15.1.6 å¯è§†åŒ–

ä¾é Networkxçš„å¯¼å‡ºèƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡JSONçš„JavaScriptå·¥å…·åŒ…D3ä½¿ç”¨ï¼Œä½†ä¹Ÿæœ‰è®¸å¤šå…¶ä»–çš„å·¥å…·åŒ…ï¼Œä½ å¯ä»¥è€ƒè™‘å½“å¯è§†åŒ–å›¾ã€‚Graphvizæ˜¯é«˜åº¦å¯é…ç½®çš„ç»å…¸å·¥å…·ï¼Œå¯ä»¥è®¾è®¡å‡ºéå¸¸å¤æ‚çš„å›¾å½¢å’Œä½å›¾å›¾åƒã€‚ä¼ ç»Ÿä¸Šåœ¨ç»ˆç«¯ä¸Šè¿è¡Œï¼Œä½†ç°åœ¨ä¹Ÿæœ‰æ”¯æŒå¤§å¤šæ•°å¹³å°çš„ç”¨æˆ·ç•Œé¢ã€‚å¦ä¸€ä¸ªæµè¡Œçš„å¼€æºé¡¹ç›®æ˜¯Gephiï¼Œå…¶åœ¨äº¤äº’ä¸Šåšçš„å¾ˆå¥½ï¼Œåœ¨è¿‡å»çš„å‡ å¹´ä¸­Gephiå·²ç»è¿…é€Ÿæµè¡Œï¼Œéå¸¸å€¼å¾—æ¨èã€‚ è¿™é‡Œç”±äºæœ‰ä¸Šä¸‡ä¸ªé¡¹ç›®ç»“ç‚¹ï¼Œä¸€å¼ å›¾ä¹Œæ¼†å˜›é»‘éƒ½çœ‹ä¸åˆ°ï¼Œå¹¶ä¸”å¾ˆå¡ã€‚æ‰€ä»¥ä¸‹é¢åªæˆªå–ç”¨æˆ·ç‚¹å’Œè¯­è¨€ç‚¹çš„å¯è§†åŒ–ã€‚

<pre>
import os
import json
from IPython.display import IFrame
from IPython.core.display import display 
from networkx.readwrite import json_graph
print ("Stats on the full graph" )
print (nx.info(g))
# åªæå–ç”¨æˆ·å’Œè¯­è¨€ç»“ç‚¹
mtsw_users = [n for n in g if g.node[n]['type'] == 'user'] +[n for n in g if g.node[n]['type'] == 'lang'] 
h = g.subgraph(mtsw_users)
print ("Stats on the extracted subgraph" )
print (nx.info(h))
# jsonå¯¼å‡º
d = json_graph.node_link_data(h)
json.dump(d, open('force.json', 'w'))
viz_file = 'files/force.html'
# D3å¯è§†åŒ–
display(IFrame(viz_file, '100%', '900px'))
</pre>

ä¸‹é¢çš„åŠ¨æ€é¡µé¢åŠ è½½ä¸å‡ºè¯·ç‚¹å‡»åŠ¨æ€å›¾
![](https://i.imgur.com/VjCO3JV.png)

å¦‚æœè¦åˆ†æè¯­è¨€ä¹‹é—´çš„å…³è”ï¼Œå…¶å®ä¹Ÿå¯ä»¥ä»ä¸€ä¸ªé¡¹ç›®ä¸­æ‹¿åˆ°å¤šä¸ªè¯­è¨€ï¼Œæ¯”å¦‚æ˜¯a,b,c,ç„¶ååšæ— å‘å›¾ï¼Œæ ‡è®°a-b-c æƒé‡ä¸º1ï¼Œå½“åœ¨å…¶ä»–é¡¹ç›®ä¸­è¿˜æœ‰a,båŒæ—¶å‡ºç°æ—¶,a-b æƒé‡ä¸º2ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€åç›´æ¥æ”¾mjwillsonçš„æˆå“:
![](https://i.imgur.com/gkmbmIl.png)




## 15.2 å¾®åšè¯é¢˜çˆ¬å–ä¸å­˜å‚¨åˆ†æ
å¤§æ•°æ®ç¤¾ä¼šä¸‹æ•°æ®å°±æ˜¯é»„é‡‘ï¼Œæ–°æµªå¾®åšä½œä¸ºä¸€ä¸ªå›½å†…ç½‘ç»œç¤¾äº¤æ—©å°±æ„è¯†åˆ°è¿™ä¸€ç‚¹ï¼Œæœ¬ç€èµ„æœ¬å®¶å’Œå•†äººçš„å¿ƒæ€ç»™ä½ æä¾›çš„å¼€æ”¾APIæ¥å£åªå¯ä»¥è·å¾—å°‘é‡æ— å…³ç´§è¦çš„æ•°æ®ï¼ˆæƒ³è¦æ•°æ®ï¼Œmoneyæ¥æ¢ï¼‰ï¼Œå¯¹æ¯”å›½å¤–Twitteç­‰ç¤¾äº¤å¹³å°ä¼šæä¾›ä¸€äº›æ•°æ®æ¥å£ä¾›ç ”ç©¶äººå‘˜è·å–å¤§é‡ç ”ç©¶æ•°æ®ã€‚é‚£æˆ‘ä»¬GEEKçš„å£å·æ˜¯ï¼Œå‡¡æ˜¯ç½‘ä¸Šèƒ½æ˜¾ç¤ºæ•°æ®çš„æœ•å…¼â€œå¯å–â€(v_vâ€¦ä¸ºä»€ä¹ˆåŠ ä¸ªå¼•å·å‘¢ï¼Œå› ä¸ºè™½ç„¶å‡ºäºæŠ€æœ¯è§’åº¦æ˜¯éƒ½å¯å–å¾—ï¼Œä½†å‡ºäºé“å¾·æ–¹é¢è€ƒè™‘ä¹Ÿè¦å°Šé‡æ•°æ®ä½œè€…çš„è§„çº¦ï¼‰ã€‚

æœ¬æ–‡åŸºäºpythonä»¥æ–°æµªå¾®åšä¸ºæ•°æ®å¹³å°ï¼Œä»æ•°æ®é‡‡é›†ã€å…³é”®å­—æå–ã€æ•°æ®å­˜å‚¨ä¸‰ä¸ªè§’åº¦ï¼Œç”¨æœ€ç®€å•çš„ç­–ç•¥æ¥æŒ–æ˜æˆ‘ä»¬çš„â€œé»„é‡‘â€ã€‚

æœ‰çˆ¬è™«åŸºç¡€çš„äººå¯ä»¥ç›´æ¥è·³è¿‡æ•°æ®é‡‡é›†éƒ¨åˆ†çœ‹â€œä¸Šæµ·ç§Ÿæˆ¿â€è¯é¢˜æŒ–æ˜å®æˆ˜é¡¹ç›®ï¼Œé¡¹ç›®åœ°å€https://github.com/luzhijun/weiboSAï¼ˆç›®å‰å·²æ›´æ–°è±†ç“£å°ç»„çˆ¬å–ï¼‰ã€‚
### 15.2.1 æ•°æ®é‡‡é›†
ä½¿ç”¨pythonæ˜¯å› ä¸ºä»£ç ç®€æ´ï¼Œè™½ç„¶è®¡ç®—æ¯”javaå’Œcæ…¢å¾ˆå¤šï¼Œä½†æ•°æ®é‡‡é›†æ—¶é—´å¼€é”€å¤§éƒ¨åˆ†æ˜¯IOéƒ¨åˆ†çš„ï¼Œä½ æ„¿æ„æ¯æ¬¡ç”¨javaæˆ–è€…cå†™æ•ˆç‡ä¹Ÿæé«˜ä¸åˆ°å“ªå»ã€‚

æ•°æ®é‡‡é›†åŸºæœ¬ç”¨çˆ¬è™«æœºå™¨äººï¼ŒåŸç†è°éƒ½ä¼šï¼Œgoogleå°±æ˜¯é ä»–å‘å®¶è‡´å¯Œèµ°ä¸Šäººç”Ÿå·…å³°çš„ã€‚ä¸‹é¢ä»‹ç»å¸¸ç”¨æ¥åšçˆ¬è™«çš„å‡ ä¸ªåº“ã€‚
> Urllib

æ€æ ·æŠ“ç½‘é¡µå‘¢ï¼Ÿå…¶å®å°±æ˜¯æ ¹æ®URLæ¥è·å–å®ƒçš„ç½‘é¡µä¿¡æ¯ï¼Œè™½ç„¶æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°çš„æ˜¯ä¸€å¹…å¹…ä¼˜ç¾çš„ç”»é¢ï¼Œä½†æ˜¯å…¶å®æ˜¯ç”±æµè§ˆå™¨è§£é‡Šæ‰å‘ˆç°å‡ºæ¥çš„ï¼Œå®è´¨å®ƒæ˜¯ä¸€æ®µHTMLä»£ç ï¼ŒåŠ  JSã€CSSï¼Œå¦‚æœæŠŠç½‘é¡µæ¯”ä½œä¸€ä¸ªäººï¼Œé‚£ä¹ˆHTMLä¾¿æ˜¯ä»–çš„éª¨æ¶ï¼ŒJSä¾¿æ˜¯ä»–çš„è‚Œè‚‰ï¼ŒCSSä¾¿æ˜¯å®ƒçš„è¡£æœã€‚æ‰€ä»¥æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯å­˜åœ¨äºHTMLä¸­çš„ï¼Œä¸‹é¢æˆ‘ä»¬å°±å†™ä¸ªä¾‹å­æ¥æ‰’ä¸€ä¸ªç½‘é¡µä¸‹æ¥ã€‚

<pre>
import urllib2
response = urllib2.urlopen("http://www.baidu.com")
print response.read()
</pre>

ç»“æœå°±å’Œåœ¨Chromeç­‰æµè§ˆå™¨ä¸­å³é”®æŸ¥çœ‹æºç ä¸€æ ·çš„å†…å®¹ï¼Œurllib2æ˜¯pythonå†…ç½®åº“ï¼Œç®€åŒ–äº†httplibçš„ç”¨æ³•(urllib2.urlopenç›¸å½“äºJavaä¸­çš„HttpURLConnection)ã€‚æœ‰2é‚£è‚¯å®šæœ‰urllibå•Šï¼Œurllib2å¯ä»¥æ¥å—ä¸€ä¸ªRequestç±»çš„å®ä¾‹æ¥è®¾ç½®URLè¯·æ±‚çš„headersï¼Œä½†urllibä»…å¯ä»¥æ¥å—URLã€‚è¿™æ„å‘³ç€ï¼Œä½ ä¸å¯ä»¥ä¼ªè£…ä½ çš„User Agentå­—ç¬¦ä¸²ç­‰ã€‚urllib2åœ¨python3.xä¸­è¢«æ”¹ä¸ºurllib.requestã€‚ æ¥ä¸‹æ¥ç”¨urllib2ä¼ªè£…iphone 6æµè§ˆï¼Œæ¨¡æ‹Ÿæµè§ˆå™¨å‘é€GETè¯·æ±‚ã€‚

<pre>
req = request.Request('http://www.douban.com/')
req.add_header('User-Agent', 'Mozilla/6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/8.0 Mobile/10A5376e Safari/8536.25')
with request.urlopen(req) as f:
    print('Status:', f.status, f.reason)
    print('Data:', f.read().decode('utf-8'))
</pre>

ç»“æœä¼šè¿”å›ç§»åŠ¨ç‰ˆçš„æºç ä¿¡æ¯

<pre>
...
<link rel="apple-touch-icon-precomposed" href="https://gss0.bdstatic.com/5bd1bjqh_Q23odCf/static/wiseindex/img/screen_icon.png"/>  
<meta name="format-detection" content="telephone=no"/>
...
</pre>
å¦‚æœæƒ³è¦ä»¥postæ–¹å¼æäº¤ï¼Œåªè¦åœ¨Requestä¸­é™„åŠ dataå­—æ®µå°±å¯ä»¥ï¼Œä¸‹é¢é™„åŠ ç”¨æˆ·åå¯†ç ç™»å½•æ–°æµªåšå®¢ã€‚
<pre>
#æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªå¾®åšç™»å½•ï¼Œå…ˆè¯»å–ç™»å½•çš„é‚®ç®±å’Œå£ä»¤ï¼Œç„¶åæŒ‰ç…§weibo.cnçš„ç™»å½•é¡µçš„æ ¼å¼ä»¥username=xxx&password=xxxçš„ç¼–ç ä¼ å…¥ï¼š
from urllib import parse
print('Login to weibo.cn...')
email = input('Email: ')
passwd = input('Password: ')
login_data = parse.urlencode([
    ('username', email),
    ('password', passwd),
    ('entry', 'weibo'),
    ('client_id', ''),
    ('savestate', '1'),
    ('ec', ''),
    ('pagerefer', 'https://passport.weibo.cn/signin/welcome?entry=mweibo&r=http%3A%2F%2Fm.weibo.cn%2F')
])

req = request.Request('https://passport.weibo.cn/sso/login')
req.add_header('Origin', 'https://passport.weibo.cn')
req.add_header('User-Agent', 'Mozilla/6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/8.0 Mobile/10A5376e Safari/8536.25')
req.add_header('Referer', 'https://passport.weibo.cn/signin/login?entry=mweibo&res=wel&wm=3349&r=http%3A%2F%2Fm.weibo.cn%2F')

with request.urlopen(req, data=login_data.encode('utf-8')) as f:
    print('Status:', f.status, f.reason)
    for k, v in f.getheaders():
        print('%s: %s' % (k, v))
    print('Data:', f.read().decode('utf-8'))
</pre>
å…¶ä¸­Originå’Œrefererå­—æ®µæ˜¯åâ€œåç›—é“¾â€ï¼Œå°±æ˜¯æ£€æŸ¥ä½ å‘é€è¯·æ±‚çš„headeré‡Œé¢ï¼Œrefererç«™ç‚¹æ˜¯ä¸æ˜¯ä»–è‡ªå·±ã€‚

> Cookielib

çˆ¬è™«è¢«å°çš„ä¸€ä¸ªä¾æ®å°±æ˜¯é‡å¤IPï¼Œå› æ­¤å¯ä»¥ä¸ºçˆ¬è™«è®¾ç½®ä¸åŒä»£ç†IPã€‚æ­¤å¤–æœ‰äº›ç½‘ç«™éœ€è¦cookieæ‰èƒ½æŸ¥çœ‹ï¼Œæ‰€è°“Cookieï¼ŒæŒ‡æŸäº›ç½‘ç«™ä¸ºäº†è¾¨åˆ«ç”¨æˆ·èº«ä»½ã€è¿›è¡Œsessionè·Ÿè¸ªè€Œå‚¨å­˜åœ¨ç”¨æˆ·æœ¬åœ°ç»ˆç«¯ä¸Šçš„æ•°æ®ï¼ˆé€šå¸¸ç»è¿‡åŠ å¯†ï¼‰ã€‚æ¯”å¦‚è¯´æœ‰äº›ç½‘ç«™éœ€è¦ç™»å½•åæ‰èƒ½è®¿é—®æŸä¸ªé¡µé¢ï¼Œåœ¨ç™»å½•ä¹‹å‰ï¼Œä½ æƒ³æŠ“å–æŸä¸ªé¡µé¢å†…å®¹æ˜¯ä¸å…è®¸çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Urllib2åº“ä¿å­˜æˆ‘ä»¬ç™»å½•çš„Cookieï¼Œç„¶åå†æŠ“å–å…¶ä»–é¡µé¢å°±è¾¾åˆ°ç›®çš„äº†ã€‚

cookielibæ¨¡å—çš„ä¸»è¦ä½œç”¨æ˜¯æä¾›å¯å­˜å‚¨cookieçš„å¯¹è±¡ï¼Œä»¥ä¾¿äºä¸urllib2æ¨¡å—é…åˆä½¿ç”¨æ¥è®¿é—®Internetèµ„æºã€‚Cookielibæ¨¡å—éå¸¸å¼ºå¤§ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœ¬æ¨¡å—çš„CookieJarç±»çš„å¯¹è±¡æ¥æ•è·cookieå¹¶åœ¨åç»­è¿æ¥è¯·æ±‚æ—¶é‡æ–°å‘é€ï¼Œæ¯”å¦‚å¯ä»¥å®ç°æ¨¡æ‹Ÿç™»å½•åŠŸèƒ½ã€‚è¯¥æ¨¡å—ä¸»è¦çš„å¯¹è±¡æœ‰CookieJarã€FileCookieJarã€MozillaCookieJarã€LWPCookieJarã€‚

å®ƒä»¬çš„å…³ç³»ï¼šCookieJarâ€“æ´¾ç”Ÿ->FileCookieJar â€“æ´¾ç”Ÿâ€“>MozillaCookieJarå’ŒLWPCookieJar

<pre>
from urllib import request
from http.cookiejar import CookieJar

cookie=CookieJar()
cookie_support= request.HTTPCookieProcessor(cookie)#cookieå¤„ç†å™¨
opener = request.build_opener(cookie_support)
opener.open('http://www.baidu.com')
for item in cookie:
    print(item.name,':',item.value)
</pre>
ç»“æœï¼š

	BAIDUID : E4DECD4AF63915B9AFF5AC28951A3DAA:FG=1
	BIDUPSID : E4DECD4AF63915B9AFF5AC28951A3DAA
	H_PS_PSSID : 1437_18241_17944_21079_18559_21454_21406_21377_21191_21321
	PSTM : 1477631558
	BDSVRTM : 0
	BD_HOME : 0
è¿™é‡Œä½¿ç”¨é»˜è®¤çš„CookieJar å¯¹è±¡ï¼Œå¦‚æœè¦å°†Cookieä¿å­˜èµ·æ¥ï¼Œå¯ä»¥ä½¿ç”¨FileCookieJarç±»å’Œå…¶å­ç±»ä¸­çš„saveæ–¹æ³•ï¼ŒåŠ è½½å°±ç”¨loadæ–¹æ³•ã€‚

å†™è„šæœ¬ä»æŒ‡å®šç½‘ç«™æŠ“å–æ•°æ®çš„æ—¶å€™ï¼Œå…ä¸äº†ä¼šè¢«ç½‘ç«™å±è”½IPã€‚æ‰€ä»¥å‘¢ï¼Œå°±éœ€è¦æœ‰ä¸€äº›IPä»£ç†ã€‚éšä¾¿åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€ä¸ªæä¾›å…è´¹IPçš„ç½‘ç«™è¥¿åˆºåšIPæŠ“å–ã€‚è§‚å¯Ÿå¯ä»¥å‘ç°æœ‰æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯çš„é¡µé¢urlæœ‰ä¸‹é¢çš„è§„å¾‹ï¼šwww.xicidaili.com/nn/+é¡µç ã€‚å¯æ˜¯ä½ å¦‚æœç›´æ¥é€šè¿‡getæ–¹æ³•è®¿é—®çš„è¯ä½ ä¼šå‘ç°ä¼šå‡ºç°500é”™è¯¯ã€‚åŸå› å…¶å®å‡ºåœ¨è¿™ä¸ªè§„å¾‹ä¸‹çš„urlè™½ç„¶éƒ½æ˜¯getæ–¹æ³•è·å¾—æ•°æ®ï¼Œä½†éƒ½æœ‰cookieè®¤è¯ï¼Œå¦å¤–è¿˜æœ‰åå¤–é“¾ç­‰ï¼Œä¸‹é¢ä¾‹å­ç”¨æ¥è·å¾—è¥¿åˆºçš„cookieã€‚

<pre>
headers=[('User-Agent','Mozilla/6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/8.0 Mobile/10A5376e Safari/8536.25'),
    ('Host','www.xicidaili.com'),
    ('Referer','http://www.xicidaili.com/n')]
def getCookie()
    cookie=CookieJar()
    cookie_support= request.HTTPCookieProcessor(cookie)#cookieå¤„ç†å™¨
    opener = request.build_opener(cookie_support)
    opener.addheaders=headers
    opener.open('http://www.xicidaili.com/')
    return cookie
</pre>

æœ‰äº†cookieå°±å¯ä»¥çˆ¬äº†ï¼Œçˆ¬çš„å†…å®¹æ€ä¹ˆå¤„ç†å‘¢ï¼Œä»‹ç»ä¸ªSBå·¥å…·â€”â€” BeautifulSoupã€‚

> BeautifulSoup

BeautifulSoupç¿»è¯‘å«é¸¡æ±¤ï¼Œç°åœ¨ç‰ˆæœ¬æ˜¯4.5.1ï¼Œç®€ç§°BS4ï¼Œå€’è¿‡æ¥å«4SBï¼Œä¸è¿‡æŠ“æ•°æ®ä¸€ç‚¹éƒ½ä¸SBã€‚æä¾›ä¸€äº›ç®€å•çš„ã€pythonå¼çš„å‡½æ•°ç”¨æ¥å¤„ç†å¯¼èˆªã€æœç´¢ã€ä¿®æ”¹åˆ†ææ ‘ç­‰åŠŸèƒ½ã€‚å®ƒæ˜¯ä¸€ä¸ªå·¥å…·ç®±ï¼Œé€šè¿‡è§£ææ–‡æ¡£ä¸ºç”¨æˆ·æä¾›éœ€è¦æŠ“å–çš„æ•°æ®ï¼Œå› ä¸ºç®€å•ï¼Œæ‰€ä»¥ä¸éœ€è¦å¤šå°‘ä»£ç å°±å¯ä»¥å†™å‡ºä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ç¨‹åºã€‚Beautiful Soupè‡ªåŠ¨å°†è¾“å…¥æ–‡æ¡£è½¬æ¢ä¸ºUnicodeç¼–ç ï¼Œè¾“å‡ºæ–‡æ¡£è½¬æ¢ä¸ºutf-8ç¼–ç ã€‚ä½ ä¸éœ€è¦è€ƒè™‘ç¼–ç æ–¹å¼ï¼Œé™¤éæ–‡æ¡£æ²¡æœ‰æŒ‡å®šä¸€ä¸ªç¼–ç æ–¹å¼ï¼Œè¿™æ—¶ï¼ŒBeautiful Soupå°±ä¸èƒ½è‡ªåŠ¨è¯†åˆ«ç¼–ç æ–¹å¼äº†ã€‚ç„¶åï¼Œä½ ä»…ä»…éœ€è¦è¯´æ˜ä¸€ä¸‹åŸå§‹ç¼–ç æ–¹å¼å°±å¯ä»¥äº†ã€‚ å…³äºBSçš„ä»‹ç»å’Œç”¨æ³•å®˜æ–¹æ–‡æ¡£å¾ˆè¯¦ç»†ï¼Œä¸‹é¢ç»™å‡ ä¸ªâ€Web scraping with pythonâ€1ä¸­çš„ä¾‹å­çœ‹ä¸‹BSæ˜¯å¦å¥½å–ï¼Œå¯ä»¥å’Œæ–‡æ¡£å¯¹ç…§çœ‹ã€‚ é¦–å…ˆä½ å¾—å®‰è£…äº†BSï¼Œç„¶åçˆ¬å–http://www.pythonscraping.com/pages/page3.htmlä¸­çš„å›¾ç‰‡æ¥å°è¯•ç‰›åˆ€ã€‚

<pre>
import re
from urllib import request
from bs4 import BeautifulSoup

html=request.urlopen("http://www.pythonscraping.com/pages/page3.html")
bs=BeautifulSoup(html,"lxml")
#æ‰“å°æ‰€æœ‰å›¾ç‰‡åœ°å€
for pic in bs.find_all('img',{'src':re.compile(".*\.jpg$")}):
    print(pic['src'])
</pre>
ç»“æœ:
	
	../img/gifts/logo.jpg
	../img/gifts/img1.jpg
	../img/gifts/img2.jpg
	../img/gifts/img3.jpg
	../img/gifts/img4.jpg
	../img/gifts/img6.jpg
æ¥ä¸Šæ–‡ï¼Œæˆ‘ä»¬æŠŠè¥¿åˆºçš„é«˜åŒ¿ä»£ç†ipçˆ¬å‡ºæ¥æ”¾åˆ°æœ¬åœ°proxy.txtã€‚

<pre>
cookie=getCookie()
# get the proxy
with open('proxy.txt', 'w') as f:
    for page in range(1,101):
        if page%50==0:#æ¯50é¡µæ›´æ–°ä¸‹cookie
            cookie=getCookie()

        url = 'http://www.xicidaili.com/nn/%s' %page
        cookie_support= request.HTTPCookieProcessor(cookie)
        opener = request.build_opener(cookie_support)
        request.install_opener(opener)

        req = request.Request(url,headers=dict(headers))
        content = request.urlopen(req)
        soup = BeautifulSoup(content,"lxml")
        trs = soup.find('table',id="ip_list").findAll('tr')
        for tr in trs[1:]:
            tds = tr.findAll('td')
            ip = tds[1].text.strip()
            port = tds[2].text.strip()
            protocol = tds[5].text.strip().
            f.write('%s://%s:%s\n' % (protocol, ip, port))
</pre>

ç»“æœåäº”ç§’çˆ¬äº†1ä¸‡æ¡æ•°æ®ï¼ˆä¸ç”µè„‘ç¯å¢ƒæœ‰å…³ï¼‰ï¼Œè¯´æ˜1é¡µæ­£å¥½100æ¡ï¼Œè€Œæ€»é¡µæ•°è¶…è¿‡1000é¡µï¼Œä¹Ÿå°±æ˜¯è®°å½•æ•°è¶…è¿‡10wæ¡ï¼Œå¦‚æœå›ºå®šç”¨åŒä¸€ä¸ªcookieè‚¯å®šä¸å®‰å…¨ï¼ˆè°ä¼šæœ‰ç©ºç¿»çœ‹1000é¡µæ•°æ®ã€‚ã€‚ã€‚ï¼‰ï¼Œå› æ­¤è®¾ç½®æ¯çˆ¬50é¡µæ›´æ–°ä¸‹cookieã€‚ æœ‰äº†ä»£ç†åœ°å€ï¼Œä¸ä¸€å®šèƒ½ä¿è¯æœ‰æ•ˆï¼Œå¯èƒ½å°±è¢«å°æ€äº†ï¼Œå› æ­¤ä½¿ç”¨æ€è·¯æ˜¯æŠŠä»£ç†åœ°å€å­˜å…¥å“ˆå¸Œè¡¨ï¼ŒéªŒè¯æ— æ•ˆçš„åˆ é™¤ï¼ˆçœ‹çŠ¶æ€ç ï¼‰ï¼Œé‡æ–°åœ¨è¡¨ä¸­å–æ–°çš„è®°å½•ã€‚ ä»£ç†åœ°å€ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
<pre>
...
proxy_handler = request.ProxyHandler({'http': '123.165.121.126:81'}) #http://www.xicidaili.com/nn/2 éšä¾¿æ‰¾ä¸ª
opener = request.build_opener(proxy_handler,cookie_handler ...å„ç§å…¶ä»–handle)
...
</pre>
å¦å¤–æ¨èä¸ªç¥å™¨ï¼Œcrawlera ï¼ŒåŸºæœ¬æ»¡è¶³å„ç§éœ€è¦ã€‚

å‡å¦‚çœŸè¦çˆ¬1000é¡µï¼Œéœ€è¦èŠ±150ç§’ï¼Ÿå¥½å§ï¼Œå¥½åƒä¹Ÿä¸å¤šï¼Œä½†æˆ‘è¦è¯´çš„æ˜¯å¯ä»¥å¤šè¿›ç¨‹æˆ–è€…å¼‚æ­¥å¤„ç†ã€‚å¤šè¿›ç¨‹å¾ˆå¥½åšï¼Œæ³¨æ„ä»¥æ‰‹åŠ¨ç»´æŠ¤ä¸€ä¸ªHttpConnectionçš„æ± ï¼Œç„¶åæ¯æ¬¡æŠ“å–æ—¶ä»è¿æ¥æ± é‡Œé¢é€‰è¿æ¥è¿›è¡Œè¿æ¥å³å¯ï¼ˆæ¯ç§’å‡ ç™¾ä¸ªè¿æ¥æ­£å¸¸çš„æœ‰ç†æ™ºçš„æœåŠ¡å™¨ä¸€å®šä¼šå°ç¦ä½ çš„ï¼‰ã€‚pythonçš„å¼‚æ­¥å¤„ç†ç”¨åˆ°äº†Twistedåº“ï¼Œå´è¿œæ²¡æœ‰åŒæ˜¯å¼‚æ­¥æ¨¡å¼çš„nodejsç«ï¼Œç®—æ˜¯pythonä¸­çš„å·¨å‹æ¡†æ¶äº†ï¼Œæƒ³æƒ³pythonçš„å·¨å‹æ¡†æ¶æ´»çš„ä¸ä¹…ï¼Œæ„Ÿå…´è¶£çš„æ¨èçœ‹ä¸‹ã€ŠTwistedç½‘ç»œç¼–ç¨‹å¿…å¤‡ã€‹2ã€‚å…³äºå•çº¿ç¨‹ã€å¤šçº¿ç¨‹ã€å¼‚æ­¥æœ‰å¼ å›¾æ¨èçœ‹ä¸‹ã€‚
![](https://i.imgur.com/HWO629J.png)

å†™çˆ¬è™«è¿˜è¦è€ƒè™‘å…¶ä»–å¾ˆå¤šé—®é¢˜ï¼ŒæˆæƒéªŒè¯ã€è¿æ¥æ± ã€æ•°æ®å¤„ç†ã€jså¤„ç†ç­‰ï¼Œè¿™é‡Œæœ‰ä¸ªç»å…¸çˆ¬è™«æ¡†æ¶ï¼šScrapyï¼Œç›®å‰æ”¯æŒpython3ï¼Œæ”¯æŒåˆ†å¸ƒå¼ï¼Œ ä½¿ç”¨ Twistedæ¥å¤„ç†ç½‘ç»œé€šè®¯ï¼Œæ¶æ„æ¸…æ™°ï¼Œå¹¶ä¸”åŒ…å«äº†å„ç§ä¸­é—´ä»¶æ¥å£ï¼Œå¯ä»¥çµæ´»çš„å®Œæˆå„ç§éœ€æ±‚ã€‚

> Scrapyä¸Pyspider

Scrapyçš„å…¥é—¨å­¦ä¹ å‚è§å­¦ä¹ Scrapyå…¥é—¨ï¼Œå¯¹åº”ä¸­æ–‡æ–‡æ¡£å‡ å°æ—¶å†…å¯ä»¥å¿«é€ŸæŒæ¡ã€‚å¦å¤–å›½å†…æŸå¤§ç¥å¼€å‘äº†ä¸ªWebUIçš„Pyspiderï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

1. python è„šæœ¬æ§åˆ¶ï¼Œå¯ä»¥ç”¨ä»»ä½•ä½ å–œæ¬¢çš„htmlè§£æåŒ…ï¼ˆå†…ç½® pyqueryï¼‰
1. WEB ç•Œé¢ç¼–å†™è°ƒè¯•è„šæœ¬ï¼Œèµ·åœè„šæœ¬ï¼Œç›‘æ§æ‰§è¡ŒçŠ¶æ€ï¼ŒæŸ¥çœ‹æ´»åŠ¨å†å²ï¼Œè·å–ç»“æœäº§å‡º
1. æ”¯æŒ MySQL, MongoDB, SQLite
1. æ”¯æŒæŠ“å– JavaScript çš„é¡µé¢
1. ç»„ä»¶å¯æ›¿æ¢ï¼Œæ”¯æŒå•æœº/åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œæ”¯æŒ Docker éƒ¨ç½²
1. å¼ºå¤§çš„è°ƒåº¦æ§åˆ¶


ä»å†…å®¹ä¸Šè®²ï¼Œä¸¤è€…å…·æœ‰åŠŸèƒ½å·®ä¸å¤šï¼ŒåŒ…æ‹¬ä»¥ä¸Š3ï¼Œ5ï¼Œ6ã€‚ä¸åŒæ˜¯ScrapyåŸç”Ÿä¸æ”¯æŒjsæ¸²æŸ“ï¼Œéœ€è¦å•ç‹¬ä¸‹è½½scrapy-splash,è€ŒPyScrapyå†…ç½®æ”¯æŒscrapyjsï¼›PySpiderå†…ç½® pyqueryé€‰æ‹©å™¨ï¼ŒScrapyæœ‰XPathå’ŒCSSé€‰æ‹©å™¨ï¼Œè¿™ä¸¤ä¸ªå¤§å®¶å¯èƒ½æ›´ç†Ÿä¸€ç‚¹ï¼›æ­¤å¤–ï¼ŒScrapyå…¨éƒ¨å‘½ä»¤è¡Œæ“ä½œï¼ŒPyscrapyæœ‰è¾ƒå¥½çš„WebUIï¼›è¿˜æœ‰ï¼Œscrapyå¯¹åƒä¸‡çº§URLå»é‡æ”¯æŒå¾ˆå¥½ï¼Œé‡‡ç”¨å¸ƒéš†è¿‡æ»¤æ¥åšï¼Œè€ŒSpiderç”¨çš„æ˜¯æ•°æ®åº“æ¥å»é‡ï¼Ÿæœ€åï¼ŒPySpideræ›´åŠ å®¹æ˜“è°ƒè¯•ï¼Œscrapyé»˜è®¤çš„debugæ¨¡å¼ä¿¡æ¯é‡å¤ªå¤§ï¼Œwarnæ¨¡å¼ä¿¡æ¯é‡å¤ªå°‘ï¼Œç”±äºå¼‚æ­¥æ¡†æ¶å‡ºé”™åæ˜¯ä¸ä¼šåœæ‰å…¶ä»–ä»»åŠ¡çš„ï¼Œä¹Ÿå°±æ˜¯å‡ºé”™äº†è¿˜ä¼šæ¥ç€è·‘ã€‚ã€‚ã€‚ä»æ•´ä½“ä¸Šæ¥è¯´ï¼Œpyspideræ¯”scrapyç®€å•ï¼Œå¹¶ä¸”pyspiderå¯ä»¥åœ¨çº¿æä¾›çˆ¬è™«æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯æ‰€è¯´çš„SaaSï¼Œæƒ³è¦åšä¸ªç®€å•çš„çˆ¬è™«æ¨èä½¿ç”¨å®ƒï¼Œä½†è‡ªå®šä¹‰ç¨‹åº¦ç›¸å¯¹scrapyä½ï¼Œç¤¾åŒºäººæ•°å’Œæ–‡æ¡£éƒ½æ²¡æœ‰scrapyå¼ºï¼Œä½†scrapyè¦å­¦ä¹ çš„ç›¸å…³çŸ¥è¯†ä¹Ÿè¾ƒå¤šï¼Œæ•…è€Œå®Œæˆä¸€ä¸ªçˆ¬è™«çš„æ—¶é—´è¾ƒé•¿ã€‚

å› ä¸ºæ¯”è¾ƒå–œæ¬¢æœ‰å®Œæ•´æ–‡æ¡£çš„æ”¯æŒï¼Œæ‰€ä»¥åé¢ä¸»è¦ç”¨Scrapyï¼Œç®€è¦è¯´ä¸‹Scrapyè¿è¡Œæµç¨‹ã€‚

- é¦–å…ˆï¼Œå¼•æ“ä»è°ƒåº¦å™¨ä¸­å–å‡ºä¸€ä¸ªé“¾æ¥(URL)ç”¨äºæ¥ä¸‹æ¥çš„æŠ“å–
- å¼•æ“æŠŠURLå°è£…æˆä¸€ä¸ªè¯·æ±‚(Request)ä¼ ç»™ä¸‹è½½å™¨ï¼Œä¸‹è½½å™¨æŠŠèµ„æºä¸‹è½½ä¸‹æ¥ï¼Œå¹¶å°è£…æˆåº”ç­”åŒ…(Response)
- ç„¶åï¼Œçˆ¬è™«è§£æResponse
- è‹¥æ˜¯è§£æå‡ºå®ä½“ï¼ˆItemï¼‰,åˆ™äº¤ç»™å®ä½“ç®¡é“è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚
- è‹¥æ˜¯è§£æå‡ºçš„æ˜¯é“¾æ¥ï¼ˆURLï¼‰,åˆ™æŠŠURLäº¤ç»™Schedulerç­‰å¾…æŠ“å–

æ ¹æ®scrapyæ–‡æ¡£æè¿°,è¦é˜²æ­¢scrapyè¢«ç¦ç”¨ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç­–ç•¥ã€‚

1. åŠ¨æ€è®¾ç½®user agent
1. ç¦ç”¨cookies
1. è®¾ç½®å»¶è¿Ÿä¸‹è½½
1. ä½¿ç”¨ Google cache
1. ä½¿ç”¨IPåœ°å€æ± ï¼ˆ Tor project ã€VPNå’Œä»£ç†IPï¼‰
1. ä½¿ç”¨ Crawlera

ç”±äºGoogle cacheåŸºäºä½ æ‡‚çš„åŸå› ä¸å¯ç”¨ï¼Œå…¶ä½™éƒ½å¯ä»¥åˆ©ç”¨ï¼ŒCrawleraçš„åˆ†å¸ƒå¼ä¸‹è½½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸‹æ¬¡ç”¨ä¸€ç¯‡ä¸“é—¨çš„æ–‡ç« è¿›è¡Œè®²è§£ã€‚ä¸‹é¢ä¸»è¦ä»åŠ¨æ€éšæœºè®¾ç½®user agentã€ç¦ç”¨cookiesã€è®¾ç½®å»¶è¿Ÿä¸‹è½½å’Œä½¿ç”¨ä»£ç†IPè¿™å‡ ä¸ªæ–¹å¼å…¥æ‰‹ã€‚

> è‡ªå®šä¹‰ä¸­é—´ä»¶


Scrapyä¸‹è½½å™¨é€šè¿‡ä¸­é—´ä»¶æ§åˆ¶çš„ï¼Œè¦å®ç°ä»£ç†IPã€user agentåˆ‡æ¢å¯ä»¥è‡ªå®šä¹‰ä¸ªä¸­é—´ä»¶ã€‚ åœ¨é¡¹ç›®ä¸‹åˆ›å»ºï¼ˆå¦‚ä½•åˆ›å»ºé¡¹ç›®ï¼Œä½¿ç”¨scrapy start yourProjectå‘½ä»¤ï¼Œå‚è€ƒæ–‡æ¡£ï¼‰å¥½é¡¹ç›®åï¼Œåœ¨é‡Œé¢æ‰¾åˆ°setting.pyæ–‡ä»¶ï¼Œå…ˆæŠŠagentså’Œä»£ç†ipæ”¾åˆ°setting.pyä¸­ï¼ˆä»£ç†ipè¾ƒå°‘æƒ…å†µä¸‹è¿™æ ·åšï¼Œè¾ƒå¤šçš„è¯è¿˜æ˜¯æ”¾åˆ°æ•°æ®åº“ä¸­å»ï¼Œæ–¹ä¾¿ç®¡ç†ï¼‰,è®¾ç½®ä¸­é—´ä»¶åå­—MyCustomSpiderMiddlewareå’Œä¼˜å…ˆçº§ã€‚

<pre>
USER_AGENTS = [
	"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; AcooBrowser; .NET CLR 1.1.4322; .NET CLR 2.0.50727)",
	"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Acoo Browser; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506)",
	"Mozilla/4.0 (compatible; MSIE 7.0; AOL 9.5; AOLBuild 4337.35; Windows NT 5.1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)",
	"Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US)",
	"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0)",
	"Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.0.3705; .NET CLR 1.1.4322)",
	"Mozilla/4.0 (compatible; MSIE 7.0b; Windows NT 5.2; .NET CLR 1.1.4322; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 3.0.04506.30)",
	"Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN) AppleWebKit/523.15 (KHTML, like Gecko, Safari/419.3) Arora/0.3 (Change: 287 c9dfb30)",
	"Mozilla/5.0 (X11; U; Linux; en-US) AppleWebKit/527+ (KHTML, like Gecko, Safari/419.3) Arora/0.6",
	"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.2pre) Gecko/20070215 K-Ninja/2.1.1",
	"Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9) Gecko/20080705 Firefox/3.0 Kapiko/3.0",
	"Mozilla/5.0 (X11; Linux i686; U;) Gecko/20070322 Kazehakase/0.4.5",
	"Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.8) Gecko Fedora/1.9.0.8-1.fc10 Kazehakase/0.5.6",
	"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11",
	"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/535.20 (KHTML, like Gecko) Chrome/19.0.1036.7 Safari/535.20",
	"Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto/2.9.168 Version/11.52",
]
PROXIES = [
	{'ip_port': '111.11.228.75:80', 'user_pass': ''},
	{'ip_port': '120.198.243.22:80', 'user_pass': ''},
	{'ip_port': '111.8.60.9:8123', 'user_pass': ''},
	{'ip_port': '101.71.27.120:80', 'user_pass': ''},
	{'ip_port': '122.96.59.104:80', 'user_pass': ''},
	{'ip_port': '122.224.249.122:8088', 'user_pass': ''},
]
# ç¦ç”¨cookoe (enabled by default)
COOKIES_ENABLED = False

#è®¾ç½®ä¸‹è½½å»¶è¿Ÿ
DOWNLOAD_DELAY = 1

# ä¸‹è½½ä¸­é—´ä»¶
# See http://scrapy.readthedocs.org/en/latest/topics/downloader-middleware.html
DOWNLOADER_MIDDLEWARES = {
    'weiboZ.middlewares.MyCustomDownloaderMiddleware': 543,
}
</pre>

middlewares/MyCustomDownloaderMiddleware.py
<pre>

import random
import base64
from settings import PROXIES
class RandomUserAgent(object):
	"""Randomly rotate user agents based on a list of predefined ones"""
	def __init__(self, agents):
		self.agents = agents
	@classmethod
	def from_crawler(cls, crawler):
		return cls(crawler.settings.getlist('USER_AGENTS'))
	def process_request(self, request, spider):
		#éšæœºé€‰ä¸ªagent
		request.headers.setdefault('User-Agent', random.choice(self.agents))
class ProxyMiddleware(object):
	def process_request(self, request, spider):
		proxy = random.choice(PROXIES)
		if proxy['user_pass'] is not None:
			request.meta['proxy'] = "http://%s" % proxy['ip_port']
			encoded_user_pass = base64.encodestring(proxy['user_pass'])
			request.headers['Proxy-Authorization'] = 'Basic ' + encoded_user_pass
		else:
			request.meta['proxy'] = "http://%s" % proxy['ip_port']
</pre>

###	15.2.2 äº’è”ç½‘é“å¾·å’Œè§„çº¦
å½“ä½ å‡†å¤‡çˆ¬æŸä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œé¦–å…ˆåº”è¯¥å…ˆçœ‹ä¸‹è¯¥ç½‘ç«™æœ‰æ²¡æœ‰robots.txtã€‚robots.txtæ˜¯1994å¹´å‡ºç°çš„ï¼Œä¹Ÿç§°ä¸ºæœºå™¨äººæ’é™¤æ ‡å‡†(Robots Exclusion Standard)ï¼Œç½‘ç«™ç®¡ç†å‘˜ä¸æƒ³æŸäº›å†…å®¹è¢«çˆ¬åˆ°çš„æ—¶å€™å¯ä»¥å†è¯¥æ–‡ä»¶ä¸­æ³¨æ˜ã€‚robots.txtè™½ç„¶æœ‰ä¸»æµçš„è¯­æ³•æ ¼å¼ï¼Œä½†æ˜¯å„å¤§ä¼ä¸šæ ‡å‡†ä¸ä¸€ï¼Œæ²¡æœ‰åˆ«äººå¯ä»¥é˜»æ­¢ä½ åˆ›å»ºè‡ªå·±ç‰ˆæœ¬çš„robots.txtï¼Œä½†è¿™äº›robots.txtä¸åº”è¯¥å› ä¸ºä¸ç¬¦åˆä¸»æµè€Œä¸è¢«éµå®ˆã€‚ä¸€èˆ¬æ–‡ä»¶å­—æ®µåŒ…å«ï¼šUser-agentï¼ŒAllowï¼ŒDisallowåˆ†åˆ«ä»£è¡¨æœç´¢æœºå™¨äººå…è®¸çœ‹å’Œä¸è®¸çœ‹çš„å†…å®¹ã€‚

ä¹‹å‰çœ‹æ–°é—»è¯´ä»Šå¹´4æœˆå¤§ä¼—ç‚¹è¯„æŠŠç™¾åº¦ç»™å‘Šäº†ï¼Œè¯·æ±‚æ³•é™¢åˆ¤ä»¤ä¸¤è¢«å‘Šåœæ­¢ä¸æ­£å½“ç«äº‰è¡Œä¸ºï¼Œå…±åŒèµ”å¿æ±‰æ¶›å…¬å¸ç»æµæŸå¤±9000ä¸‡å…ƒå’Œä¸ºåˆ¶æ­¢ä¾µæƒè¡Œä¸ºæ”¯å‡ºçš„45ä¸‡ä½™å…ƒï¼Œå¹¶åˆŠç™»å…¬å‘Šã€æ¾„æ¸…äº‹å®æ¶ˆé™¤ä¸è‰¯å½±å“ã€‚æœ‰ç”¨ç™¾åº¦åœ°å›¾çš„åº”è¯¥çŸ¥é“è¿™ä¸ªï¼ˆæœ€è¿‘ç™¾åº¦é«˜å¾·å¼€æ’•ï¼Œåˆåœ¨é»‘ç™¾åº¦äº†~~~ï¼‰ï¼Œå®šä½å®Œæ¯•ä¼šæ˜¾ç¤ºé™„è¿‘å•†å®¶å’Œç‚¹è¯„ä¿¡æ¯ï¼Œæ¥çœ‹ä¸‹å¤§ä¼—ç‚¹è¯„ç½‘çš„robots.txt. å…‰çœ‹

	User-agent: *
	â€¦
	Disallow: /shop//rank_p
	â€¦

å°±çŸ¥é“ä¸å…è®¸ä»»ä½•ä¼ä¸šå’Œä¸ªäººçˆ¬ä»–å®¶çš„å•†åº—è¯„åˆ†æ•°æ®ï¼Œæ›´ä½•å†µå…¶ä»–æ›´å…·æœ‰ä»·å€¼çš„æ•°æ®å‘¢ï¼Œæ•°æ®æ˜¯é»„é‡‘ï¼Œè¦æ±‚èµ”å¿9000ä¸‡å…ƒå¯¹ç™¾åº¦æ¥è¯´ä¸ç®—å¤šï¼Œä½†ç™¾åº¦å›åº”å†…å®¹å¤§ä¼—ç‚¹è¯„ç½‘çš„robotsåè®®é¢å‘ç™¾åº¦ç­‰æœç´¢å¼•æ“å¼€æ”¾ï¼Œç™¾åº¦åœ°å›¾æŠ“å–å¤§ä¼—ç‚¹è¯„ç½‘çš„å†…å®¹æ­£æ˜¯åœ¨robots.txtå…è®¸çš„æƒ…å†µä¸‹ã€‚é€šå¸¸ä¸šå†…ä¹ æƒ¯ä¸Šæ²¡æœ‰è¢«ä¸å…è®¸çš„å°±æ˜¯å…è®¸çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç½‘ç«™çš„å…³é”®ä¿¡æ¯å¯ä»¥å¸®åŠ©SEOä¼˜åŒ–çš„è¿™ä¸ªä¸èƒ½è¢«ç¦æ­¢å“Ÿï¼Œä¸ç„¶ä½ å°±æ²¡å¤´æ¡äº†ï¼Œçœ‹äººå®¶ç«äº‰å¯¹æ‰‹çˆ±å¸®ç½‘å€’æ˜¯å•ç‹¬è¢«åˆ—å‡ºæ¥å…¨é¢å°æ€äº†ï¼Œå› ä¸ºå…¶å®åŠ›å¤ªå¼±ï¼Œæ²¡æœ‰å•†ä¸šåˆä½œä»·å€¼ã€‚å°±ç®—è¿™æ ·æˆ‘ä¹Ÿæ²¡çœ‹å‡ºå…è®¸ç™¾åº¦æŠ“ç‚¹è¯„çš„ç”¨æˆ·è¯„è®ºæ•°æ®ï¼Œéš¾é“è¯´ç‚¹è¯„ç½‘ä¹‹å‰æ²¡robots.txtï¼Ÿäººå®¶ä¸å‚»ï¼ç™¾åº¦æŒ–äº†äººå®¶æ•°æ®è¿˜å«åš£ç€éµå®ˆRobotsåè®®ï¼Œï¼ˆå…¶å®ä»–å®Œå…¨å¯ä»¥å·å·æ‘¸æ‘¸æŠ“äº†æ•°æ®è‡ªå·±ç§ä¸‹ç ”ç©¶ï¼Œå´è¦ç›´æ¥åœ¨ç™¾åº¦åœ°å›¾ä¸Šæ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™æ˜¯è¦æŠŠæ•°æ®ä»·å€¼æ¦¨å¹²å•Šï¼Œå¤Ÿéœ¸é“ï¼‰å¥½æ¯”æŠŠäººæ‰“äº†é¡¿ç†ç›´æ°”å£®åœ°è¯´ä½ ç…å•¥ä¸€æ ·ï¼Œå¤ªé‡è›®äº†ã€‚ã€‚ã€‚

è¯´å¤šäº†ï¼Œæ¥çœ‹ä¸‹æ–°æµªå¾®åšçš„Robotsåè®®ã€‚æ˜ç¡®è§„å®šäº†Sitemap: http://weibo.com/sitemap.xml ä¸­åˆ—å‡ºçš„å†…å®¹ä¸å…è®¸è¢«ç™¾åº¦ã€360ã€è°·æ­Œã€æœç‹—ã€å¾®è½¯å¿…åº”ã€å¥½æœã€ç¥é©¬æŸ¥çœ‹ï¼Œåé¢è¿˜æ³¨æ˜äº†Disallow: User-agent: * Disallow: /ï¼Œä¹Ÿå°±æ˜¯è¯´å‰é¢æ˜¯å•ç‹¬åˆ—å‡ºçš„ï¼Œç†è®ºä¸Šè¿™äº›æ•°æ®ä¸å…è®¸ä»»ä½•æœºæ„å’Œä¸ªäººçˆ¬å–ã€‚è¿™äº›æ˜¯å•¥æ•°æ®å‘¢ï¼Œmovieå’Œmusicæ•°æ®ï¼Œé‚£ä½ æ”¾å¿ƒå¥½äº†ï¼Œå¾®åšæ–‡æœ¬æ•°æ®å¯ä»¥çˆ¬äº†ï¼Œä½†äººå®¶ä¹Ÿä¸å‚»ï¼Œå¯ä»¥æ˜¾ç¤ºçš„å¾®åšä¿¡æ¯æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸å¯èƒ½æ‰€æœ‰æ•°æ®åº“çš„æ•°æ®éƒ½æ˜¾ç¤ºå‡ºæ¥ã€‚
> å®æˆ˜

åœ¨58ã€èµ¶é›†ã€é“¾å®¶ä¸Šæ‰¾è¿‡æˆ¿å­çš„äººéƒ½ä¸ºä¸­ä»‹è‹¦æ¼ï¼Œæ‰€è°“çš„è¡Œä¸šè§„çŸ©ä»¤äººåšå‘•ï¼Œè¿™äº›äººä¸ç”Ÿäº§ç¤¾ä¼šä»·å€¼å´æ‹…å½“äº†æ–°ä¸–çºªçš„ä¹°åŠè§’è‰²ï¼Œå¥½åœ¨é€šè¿‡å¾®åšä¹Ÿå¯ä»¥æ‰¾æˆ¿ï¼Œè€Œä¸”ç»å¤§éƒ¨åˆ†æ˜¯ä¸ªäººæˆ¿æºã€‚

ä»¥ä¸Šæµ·æ‰¾æˆ¿å­ä¸ºä¾‹ï¼Œå¾®åšæœç´¢æ¡†è¾“å…¥@ä¸Šæµ·ç§Ÿæˆ¿ å°±å¯ä»¥çš„åˆ°å¦‚ä¸‹é¡µé¢

	http://s.weibo.com/weibo/%2540%25E4%25B8%258A%25E6%25B5%25B7%25E7%25A7%259F%25E6%2588%25BF?topnav=1&wvr=6&b=1
è¿˜æ˜¯ä¸é”™çš„ï¼Œç„¶åçœ‹ä¸‹æºç å‘ç°å¹¶æ²¡æœ‰htmlæ•°æ®ï¼Œæ˜¾ç„¶æ˜¯AJAXå¼‚æ­¥äº†ï¼ŒScrapyè¦çˆ¬çš„è¯è¿˜å¾—å®‰è£…scrapy-splashæ”¹ä¸‹é…ç½®ç”¨splashè§£æjså†…å®¹ï¼Œè€Œä¸”è¦çœ‹ä¸‹ä¸€é¡µå¿…é¡»ç™»å½•çŠ¶æ€æ‰å¯ä»¥ï¼Œé‚£è¦åœ¨headeré‡Œé¢æ·»åŠ cookieï¼Œå¯ä»¥ç™»å½•åchrome F12 å¼€å‘å·¥å…·æŸ¥çœ‹ï¼Œä½†ä½ æ•¢ä¿è¯æ‹¿åŒ…å«è‡ªå·±çš„è´¦å·çš„cookieå»åšçˆ¬è™«å‘ç°äº†ä¸è¢«å°ï¼Ÿå…¶å®è¿™é‡Œå¯ä»¥æ˜¾ç¤ºçš„æ•°æ®æœ€å¤š1000æ¡ï¼ŒæŒ‰æœ€æ–°çš„1000æ¡æ˜¾ç¤ºï¼Œä½•å¿…å¤§è´¹å‘¨ç« å»æé‚£ä¹ˆå¤æ‚å‘¢ï¼Œå¯ä»¥ç”¨ç§»åŠ¨ç‰ˆçš„å¾®åšæœä¸‹å˜›,ç‚¹å‡»ã€‚

ç”¨å¼€å‘è€…å·¥å…·çœ‹ä¸‹ç½‘ç»œè¯·æ±‚æ•°æ®çŠ¶å†µï¼Œæœç´¢åŒ…å«åå­—â€˜pageâ€™ è¯·æ±‚æ¶ˆæ¯å¤´ï¼Œå¯ä»¥å‘ç°è§„å¾‹ï¼š
![](https://i.imgur.com/Rn6Hjya.png)
å·¦è¾¹Nameåˆ—å‡¡æ˜¯å†…å®¹é¡µä¸‹æ‹‰å¼•èµ·ajaxåŠ è½½æ–°é¡µï¼Œæ–°é¡µå†…å®¹ä»¥jsonæ ¼å¼è¿”å›ï¼›å³è¾¹å­—æ®µæœ«å°¾page=ï¼Ÿéƒ¨åˆ†ï¼Œä»£è¡¨ä¼ é€’ç¬¬å‡ é¡µçš„å†…å®¹ï¼Œ?æœ€å¤§åˆ°100ï¼Œå’Œç”µè„‘ç‰ˆæœ€å¤šçœ‹50é¡µä¸€æ ·æœ‰æ•°æ®é™åˆ¶ã€‚
jsonå†…å®¹å¦‚ä¸‹ï¼š
![](https://i.imgur.com/GBWluq0.png)
okï¼Œèƒ½æ˜¾ç¤ºçš„æ•°æ®éƒ½åœ¨é‡Œé¢ï¼Œè€Œä¸”è¿˜æ˜¯jsonæ ¼å¼ï¼Œéƒ½ä¸ç”¨é€‰æ‹©å™¨äº†ï¼Œè¿™ä¸ªè¦æ¯”ç”µè„‘ç‰ˆç®€å•å¤šäº†ã€‚
###	15.2.3 æ•°æ®æå–
> é€‰æ‹©éœ€è¦çš„æ•°æ®

å¹¶ä¸æ˜¯æ‰€æœ‰jsonå­—æ®µçš„æ•°æ®éƒ½æœ‰ç”¨ï¼Œè¿™é‡Œåªé€‰å–æœ‰ç”¨çš„å­—æ®µï¼Œæ€»çš„åŸåˆ™æ˜¯æŒ‰éœ€æŠ½å–ã€‚å¯ä»¥çœ‹ä¸‹é¡¹ç›®ä¸­å®šä¹‰çš„Items.pyã€‚

å¾®åšå†…å®¹id å¯¹åº”å­—æ®µæ”¾æ•°æ®åº“ä¸­å°†æœ‰å”¯ä¸€çº¦æŸï¼Œé˜²æ­¢é‡å¤å¾®åšã€‚é€‰æ‹©mblogidä½œä¸ºå”¯ä¸€idï¼Œè€Œåƒä¸‡ä¸æ˜¯itemidï¼Œç»æµ‹è¯•å‘ç°itemidåªä»£è¡¨å½“å¤©å¾®åšçš„æ§½ä½ï¼Œæ¯”å¦‚é™åˆ¶æµè§ˆ10æ¡æ•°æ®ï¼Œå°±æœ‰1~10ä¸ªæ§½ä½ï¼Œè€Œitemidå°±ä»£è¡¨è¿™10ä¸ªæ§½ä½æ ‡ç­¾ï¼Œå¹¶ä¸ä»£è¡¨å¾®åšå†…å®¹idã€‚å¦å¤–mblogå­—æ®µä¸‹è¿˜æœ‰ä¸ªidå±æ€§ï¼Œä¼°è®¡å’Œmblogidä¸€æ ·çš„æ•ˆæœï¼Œæœ‰å…´è¶£å¯ä»¥è¯•è¯•ã€‚
å‘å¸ƒæ—¶é—´ä»£è¡¨ä¿¡æ¯çš„å®æ•ˆï¼Œjsoné‡Œé¢æœ‰ä¸¤ä¸ªå­—æ®µè¡¨ç¤ºï¼Œä¸€ä¸ªæ˜¯æ—¶é—´æˆ³created_timestampï¼Œå¦ä¸€ä¸ªæ˜¯æ˜¾ç¤ºå‡ºæ¥çš„çœŸå®æ—¶é—´æ•°æ®ï¼Œè¿™é‡Œå–çœŸå®æ•°æ®æ–¹ä¾¿ç›´æ¥æå–æ˜¾ç¤ºï¼Œä½†åæœŸå­˜å‚¨çš„æ—¶å€™éœ€è¦ç»Ÿä¸€è½¬æ¢ä¸ºæ ‡å‡†æ—¶é—´æ ¼å¼ã€‚ 
è¯„è®ºæ•°ã€è½¬å‘æ•°ã€ç‚¹èµæ•°å’Œæ—¶æ•ˆç»“åˆå¯ä»¥ç”¨æ¥ç»¼åˆè¯„ä¼°å¾®åšä¿¡æ¯ä»·å€¼(æ—¶é—´è¶Šé åè¿™ä¸‰ä¸ªæ•°å­—è¶Šèƒ½è¯„ä»·ä¿¡æ¯ä»·å€¼)ã€‚
ç”¨æˆ·åã€ç²‰ä¸æ•°ã€è¯´è¯´æ•°å¯ä»¥ç”¨æ¥æ£€éªŒç”¨æˆ·æ˜¯å¦æœ‰ä»·å€¼ç”¨æˆ·ï¼Œæˆ–è€…æ˜¯æœºå™¨äººã€‚
åæœŸå¤„ç†éœ€è¦æå–æ±‚/ç§Ÿä¿¡æ¯çš„å…³é”®è¯ï¼ŒåŒ…å«ä»·æ ¼ã€å‡ å·çº¿ã€è¡Œæ”¿åŒºåˆ’ã€ä¿¡æ¯æ˜¯æ±‚ç§Ÿè¿˜æ˜¯å‡ºç§Ÿã€‚

é¡¹ç›®ä¸­å®šä¹‰çš„pipelines.pyæ–‡ä»¶æ˜¯scrapyç®¡é“å¤„ç†ç±»ï¼Œä¹Ÿå°±æ˜¯ä¸»è¦çš„åæœŸæ•°æ®å¤„ç†ç±»ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯JsonPipelineç±»ï¼Œç›´æ¥å°†æ•°æ®æ‰“å°åˆ°jsonæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªå‰æœŸå¯ä»¥ç”¨æ¥è°ƒè¯•çˆ¬è™«æ•ˆæœã€‚å¦ä¸€ä¸ªæ˜¯MongoPipelineç±»ï¼Œç”¨æ¥ä¿å­˜åæœŸå¤„ç†åçš„æ•°æ®ã€‚åœ¨settingæ–‡ä»¶ä¸­ITEM_PIPELINESå±æ€§å¯ä»¥è®¾ç½®å…·ä½“é‡‡ç”¨å“ªä¸ªç®¡é“å¤„ç†ç±»ã€‚

åæœŸå¤„ç†ä¸»è¦ä»»åŠ¡æ˜¯æå–å…³é”®å­—ï¼Œå¦‚ä½•ä»å¾®åšä¿¡æ¯ä¸­çˆ¬å–åœ°ç†ä½ç½®ã€ä»·æ ¼ï¼Ÿè¿™é‡Œé‡‡ç”¨åŒæ•°ç»„Trieæ ‘

> DAT

Trieæ ‘æ˜¯æœç´¢æ ‘çš„ä¸€ç§ï¼Œæ¥è‡ªè‹±æ–‡å•è¯â€Retrievalâ€çš„ç®€å†™ï¼Œå¯ä»¥å»ºç«‹æœ‰æ•ˆçš„æ•°æ®æ£€ç´¢ç»„ç»‡ç»“æ„ï¼Œæ˜¯ä¸­æ–‡åŒ¹é…åˆ†è¯ç®—æ³•ä¸­è¯å…¸çš„ä¸€ç§å¸¸è§å®ç°ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç¡®å®šçš„æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼ˆDFAï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨è‡ªåŠ¨æœºçš„ä¸€ä¸ªçŠ¶æ€ã€‚åœ¨è¯å…¸ä¸­è¿™æ­¤çŠ¶æ€åŒ…æ‹¬â€œè¯å‰ç¼€â€ï¼Œâ€œå·²æˆè¯â€ç­‰ã€‚å‰é¢æ–‡ç« è®²äº†ä¸‹å…¶åŸç†ï¼Œå¯ä»¥æŸ¥çœ‹ã€‚

é‡‡ç”¨Trieæ ‘æœç´¢æœ€å¤šç»è¿‡næ¬¡åŒ¹é…å³å¯å®Œæˆä¸€æ¬¡æŸ¥æ‰¾(å³æœ€åæ˜¯0(n))ï¼Œè€Œä¸è¯åº“ä¸­è¯æ¡çš„æ•°ç›®æ— å…³ï¼Œç¼ºç‚¹æ˜¯ç©ºé—´ç©ºé—²ç‡é«˜ï¼Œå®ƒæ˜¯ä¸­æ–‡åŒ¹é…åˆ†è¯ç®—æ³•ä¸­è¯å…¸çš„ä¸€ç§å¸¸è§å®ç°ã€‚

åŒæ•°ç»„Trieï¼ˆdoublearrayTrie,DATï¼‰æ˜¯trieæ ‘çš„ä¸€ä¸ªç®€å•è€Œæœ‰æ•ˆçš„å®ç°ï¼ˆæ—¥æœ¬äººå‘æ˜çš„ï¼‰ï¼Œç”±ä¸¤ä¸ªæ•´æ•°æ•°ç»„æ„æˆï¼Œä¸€ä¸ªæ˜¯base[]ï¼Œå¦ä¸€ä¸ªæ˜¯check[]ã€‚åŒæ•°ç»„Trieæ ‘æ˜¯Trieæ ‘çš„ä¸€ç§å˜å½¢ï¼Œæ˜¯åœ¨ä¿è¯Trieæ ‘æ£€ç´¢é€Ÿåº¦çš„å‰æä¸‹ï¼Œæé«˜ç©ºé—´åˆ©ç”¨ç‡è€Œæå‡ºçš„ä¸€ç§æ•°æ®ç»“æ„.å…¶æœ¬è´¨æ˜¯ä¸€ä¸ªç¡®å®šæœ‰é™çŠ¶æ€è‡ªåŠ¨æœº(DeterministicFiniteAutomatonï¼ŒDFA)ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨è‡ªåŠ¨æœºçš„ä¸€ä¸ªçŠ¶æ€ï¼Œæ ¹æ®å˜é‡çš„ä¸åŒï¼Œè¿›è¡ŒçŠ¶æ€è½¬ç§»ï¼Œå½“åˆ°è¾¾ç»“æŸçŠ¶æ€æˆ–è€…æ— æ³•è½¬ç§»æ—¶å®ŒæˆæŸ¥è¯¢.DATé‡‡ç”¨ä¸¤ä¸ªçº¿æ€§æ•°ç»„(baseå’Œcheck)å¯¹Trieæ ‘ä¿å­˜ï¼Œbaseå’Œcheckæ•°ç»„æ‹¥æœ‰ä¸€è‡´çš„ä¸‹æ ‡ï¼Œå³DFAä¸­çš„æ¯ä¸€ä¸ªçŠ¶æ€ï¼Œä¹Ÿå³Trieæ ‘ä¸­æ‰€è¯´çš„èŠ‚ç‚¹ï¼Œbaseæ•°ç»„ç”¨äºç¡®å®šçŠ¶æ€çš„è½¬ç§»ï¼Œcheckæ•°ç»„ç”¨äºæ£€éªŒè½¬ç§»çš„æ­£ç¡®æ€§ï¼Œæ£€éªŒè¯¥çŠ¶æ€æ˜¯å¦å­˜åœ¨34ã€‚

åœ¨æ¯”è¾ƒç”¨äºæ­£å‘æœ€å¤§åŒ¹é…åˆ†è¯çš„é€Ÿåº¦æ–¹é¢ï¼ŒDATåˆ†è¯å¹³å‡é€Ÿåº¦ä¸º936kB/s5ï¼ˆ2006å¹´ï¼‰ï¼Œé¡¹ç›®ç”¨åˆ°githubä¸Šä¸€æ—¥æœ¬äººçš„pythonç‰ˆçš„DATï¼Œå…¶æŸ¥è¯¢é€Ÿåº¦å¯ä»¥è¾¾åˆ° 2.755M/sï¼ŒæŸ¥è¯¢é€Ÿåº¦å’Œåˆ†è¯é€Ÿåº¦åŸºæœ¬æ˜¯å·®ä¸å¤šçš„ï¼Œè¿™ä¸‰å€çš„å·®è·åº”è¯¥æ˜¯åšäº†ä¼˜åŒ–çš„ã€‚

è¯å…¸çš„æ”¶é›†æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œæ²¡æœ‰ç°æˆçš„ï¼Œé¡¹ç›®ä¸­æœé›†äº†ä¸Šæµ·åœ°é“ã€è¡—é“ã€è¡Œæ”¿åŒºã€ä¹¡é•‡ç­‰ä¿¡æ¯ï¼Œå…¶ä¸­ä»·æ ¼ä¿¡æ¯èŒƒå›´æ˜¯ä»600~9000ï¼Œå¯è¯†åˆ«äºŒåƒã€äºŒåƒäºŒã€ä¸¤åƒä¸€ç­‰ä¸­æ–‡ä»·æ ¼ï¼Œåé¢å¾®åšä¸Šçœ‹åˆ°æœ‰äººç”¨1.2kåšä»·æ ¼çš„ï¼Œæš‚æ—¶æ²¡åŠ å…¥ï¼Œè‡ªå·±å¯ä»¥åŠ å…¥è¯æ¡åé‡æ–°è¿è¡Œä¸‹makeData.pyæ–‡ä»¶å³å¯æ”¶å½•ã€‚

åˆ¤æ–­ä¿¡æ¯æ˜¯ç§Ÿæˆ¿è¿˜æ˜¯æ±‚æˆ¿ä¹Ÿæ˜¯æ ¹æ®å…³é”®å­—ï¼Œå½“ä¿¡æ¯ä¸­å‡ºç°[â€œæ±‚ç§Ÿâ€, â€œæƒ³ç§Ÿâ€,â€æ±‚åˆ°â€,â€æ±‚ä»â€, â€œè¦ç§Ÿâ€, â€œå¯»ç§Ÿâ€,â€å¯»æ‰¾â€, â€œæ‰¾æ–°æˆ¿å­â€, â€œæ‰¾æˆ¿å­â€, â€œæ‰¾æˆ¿â€, â€œå¯»æˆ¿â€, â€œæ±‚æˆ¿â€, â€œæƒ³æ‰¾â€, â€œå¸Œæœ›æˆ¿â€]ä¿¡æ¯å°±æ ‡æ³¨ä¸ºæ±‚æˆ¿ï¼Œå¦åˆ™æ ‡æ³¨ä¸ºç§Ÿæˆ¿ã€‚

æ­¤å¤–é¡¹ç›®è¿˜æ”¶é›†äº†ä¸‰åƒå¤šä¸ªæ¥¼ç›˜ä¿¡æ¯ï¼Œç”±äºæœ‰äº›æ¥¼ç›˜ä¿¡æ¯å®¹æ˜“æ··æ·†çœŸå®è¯­å¢ƒï¼Œæ¯”å¦‚â€˜å³°ä¼šâ€™ï¼ˆçœŸä¸æ‡‚æ€ä¹ˆä¼šæœ‰è¿™æ¥¼ç›˜åï¼‰ã€â€˜è‰ºå“â€™ä¸ä¿¡æ¯â€˜æ–‡è‰ºå“å‘³â€™ã€â€˜é»„å…´â€™ã€â€˜é‡‘é“­â€™ä¸äººåå†²çªç­‰ç­‰ã€‚æœ‰æƒ³æ ¹æ®æ¥¼ç›˜æŸ¥è¯¢ä¿¡æ¯çš„åŒå­¦å¯ä»¥æŠŠmakeData.pyä¸­ç¬¬5ã€51è¡Œæ³¨é‡Šå–æ¶ˆè¿è¡Œä¸‹è¿™ä¸ªæ–‡ä»¶ã€‚

å…³äºæ—¶é—´å¤„ç†ï¼Œå¾®åšæŒ–åˆ°çš„æ—¶é—´æœ‰å‡ ç§ç±»å‹ï¼š

- 2016å¹´01æœˆ01æ—¥ 00ç‚¹00åˆ†
- 1æœˆ1æ—¥ 00ï¼š00
- ä»Šå¤© 00ï¼š00
- 1åˆ†é’Ÿå‰/11åˆ†é’Ÿå‰
- 10ç§’å‰

éœ€è¦ç»Ÿä¸€è½¬åŒ–ï¼Œä½¿ç”¨DataUtilç±»å¤„ç†ã€‚å…¶ä¸­mongodbä½¿ç”¨çš„æ˜¯ISOæ—¶é—´ï¼Œæ¯”åŒ—äº¬æ—¶é—´æ—©8å°æ—¶ï¼Œè€Œpymongoä¸­çš„datetime.datetime æ•°æ®å¹¶ä¸ä¼šæŒ‰æ—¶åŒºå¤„ç†ï¼Œå› æ­¤æ‰‹åŠ¨å‡å°‘8å°æ—¶åå­˜å‚¨ã€‚åŒæ ·ä»mongoDBä¸­å–å‡ºçš„æ—¶é—´è¦è½¬åŒ–ä¸ºå½“åœ°æ—¶é—´ã€‚

<pre>
> d=new Date()
> d
ISODate("2016-10-29T06:59:49.461Z")
> d.toLocaleDateString()
10/29/2016
</pre>

###	15.2.4 æ•°æ®å­˜å‚¨
å…¶å®å°±è¿™ç‚¹æ•°æ®æ”¾å“ªä¸ªæ•°æ®åº“éƒ½æ— æ‰€è°“ï¼Œä½†å‡å¦‚è¿™ä¸ªæ•°æ®é‡å¾ˆå¤§ï¼Œå°±è¦å¥½å¥½è€ƒè™‘æ•°æ®å­˜å‚¨äº†ã€‚
> é€‰æ‹©oracleã€mysql è¿˜æ˜¯ nosql

æ•°æ®åº“çš„æ¯”è¾ƒå°±å¥½æ¯”javaã€c#ã€pythonã€Goç­‰çš„éª‚æˆ˜ä¸€æ ·ï¼Œæ²¡æœ‰æœ€å¥½çš„ï¼Œåªæœ‰æœ€é€‚åˆåœºæ™¯çš„ã€‚oracleã€mysqléƒ½å­¦è¿‡ï¼Œnosqlä¸­å­¦è¿‡hbaseå’Œmongodbï¼Œå°±æˆ‘è€Œè¨€å•ä»7ä¸ªè§’åº¦æ¯”è¾ƒï¼š

1. åŠŸèƒ½ï¼šoracle>mysql> nosql
1. å†™æ€§èƒ½ï¼šnoSql>oracleâ‰ˆâ‰ˆmysql
1. ç®€å•æŸ¥è¯¢: oracle>mysql>nosql
1. å¤æ‚æŸ¥è¯¢(å«join): oracle>mysql>nosql
1. æ¶æ„æ‰©å±•: noSql>mysql>oracle
1. å¯ç»´æŠ¤æ€§: oracle>mysql>nosql
1. æˆæœ¬: oracle>mysqlâ‰ˆâ‰ˆnosql

å¯¹äºç°åœ¨è¿™ä¸ªåœºæ™¯ï¼Œçˆ¬è™«åœ¨å‰ç«¯çˆ¬æ•°æ®ï¼Œç®¡é“å±‚åœ¨é‚£è¾¹å¤„ç†æ•°æ®åå†™æ•°æ®ï¼Œè€Œè¿™äº›æ•°æ®å…·æœ‰æ—¶æ•ˆæ€§ï¼Œä¹Ÿå°±æ˜¯è¯´åªä¼šå»è¯»ä¸€éƒ¨åˆ†æ•°æ®ï¼Œç›¸å¯¹æ¥è¯´ï¼Œè¿™å°±å¯¹å†™çš„è¦æ±‚è¾ƒé«˜ã€‚æ­¤å¤–ï¼Œè¿™ä¸ªåœºæ™¯å°±ä¸€ä¸ªè¡¨ï¼Œä¸æ¶‰åŠå¤šè¡¨å…³è”ã€çº¦æŸç­‰ï¼Œå¤æ‚æŸ¥è¯¢å¯ä»¥è¯´æ²¡æœ‰ï¼Œéœ€è¦åŠŸèƒ½è¾ƒå°‘ã€‚å¦å¤–ç½‘ç»œæ•°æ®ä¸èƒ½ä¿è¯ä¸€è‡´æ€§å’Œå¯é æ€§ï¼Œåªè¦é«˜å¯ç”¨æ€§(HA)å³å¯ï¼ŒNosqlå¯ä»¥è®¾ç½®å‰¯æœ¬æœºåˆ¶è¾¾åˆ°é«˜å¯ç”¨æ€§ï¼Œmysqlè™½ç„¶ä¹Ÿå¯ä»¥åšåˆ°æˆæœ¬ç¨é«˜ï¼Œå°†æ¥å¯æ‰©å±•è§’åº¦ä¹Ÿä¸é€‚åˆã€‚å› æ­¤è¿™ä¸ªåœºæ™¯æœ€é€‚åˆçš„æ˜¯Nosqlã€‚

> Hbase è¿˜æ˜¯Mongodb

Cassandra HBaseå’ŒMongoDbæ€§èƒ½æ¯”è¾ƒæ­¤æ–‡è¯¦ç»†æ¯”è¾ƒäº†ä¸‰ç§ä¸»æµNosqlæ•°æ®åº“ï¼Œæœ€ç»ˆé¡¹ç›®é€‰æ‹©Mongodbï¼Œå°±åœ¨äºMongoDBé€‚åˆåšè¯»å†™åˆ†ç¦»åœºæ™¯ä¸­çš„è¯»å–åœºæ™¯ï¼Œå¹¶ä¸”å…¶ç”¨jså¼€å‘çš„ï¼Œå¯¹jsonæ’å…¥æ”¯æŒç‰¹åˆ«å¥½ã€‚ä»€ä¹ˆæ—¶å€™mongodbæ˜¯è¾ƒåçš„é€‰æ‹©å‘¢ï¼Œå‚è€ƒWHY MONGODB IS A BAD CHOICE FOR STORING OUR SCRAPED DATA

pythonçš„mongodbSDKåŒ…å«pymongoï¼Œååˆ†é’Ÿçœ‹ä¸ªæ•™ç¨‹å°±ä¼šäº†ï¼Œè¿™ä¸ªä¸šåŠ¡åœºæ™¯ä¸ºäº†åŠ å¿«æŸ¥è¯¢ï¼Œéœ€è¦å¯¹ä»·æ ¼ã€è¡Œæ”¿åŒºã€å‘å¸ƒæ—¶é—´åˆ›å»ºç´¢å¼•ï¼Œå…¶ä¸­ä»·æ ¼ã€è¡Œæ”¿åŒºç”±äºæ˜¯æ•°ç»„å½¢å¼æ‰€ä»¥æ˜¯å¤šé”®ç´¢å¼•ï¼Œç´¢å¼•å±æ€§æ˜¯ç¨€ç–çš„ï¼Œå³ä¸å…è®¸ç©ºå€¼ã€‚æ­¤å¤–å¯¹è¿™æ¡å¾®åšçš„mblog_idåŠ ä¸ªå”¯ä¸€ç´¢å¼•ã€‚ç´¢å¼•åœ¨åˆå§‹è¿è¡Œæ—¶åˆ›å»ºï¼Œä¹‹åé™¤éæ‰‹åŠ¨åˆ é™¤æ•°æ®åº“åè¿è¡Œï¼Œå¦åˆ™ä¸ä¼šå†åˆ›å»ºã€‚

ä¸ºä¿è¯æ¯æ¬¡æ’å…¥çš„æ•°æ®éƒ½æ˜¯æœ€æ–°çš„ï¼Œæ’å…¥å‰åº”æ¯”è¾ƒæ•°æ®çš„å‘å¸ƒæ—¶é—´ä¸æ•°æ®åº“ä¸­çš„æœ€æ–°æ—¶é—´ï¼Œå¦‚æœæ˜¯æ—©çš„è¯´æ˜å·²ç»çˆ¬è¿‡çš„ï¼Œä¸éœ€è¦æ’å…¥ã€‚

å…³äºmongodbçš„ä½¿ç”¨æ–‡æ¡£ï¼Œç‚¹è¿™é‡Œã€‚

###	15.2.5 é¡¹ç›®è¿è¡Œä¸åˆ†æ
> è¿è¡Œé¡¹ç›®

å°†é¡¹ç›®gitåˆ°æœ¬åœ°åï¼Œè¯·å…ˆç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå·²ç»å®‰è£…ï¼š

- scrapy: [https://scrapy.org/](https://scrapy.org/)
- datrie: [https://github.com/pytries/datrie](https://github.com/pytries/datrie)
- pymongo: [https://github.com/mongodb/mongo-python-driver](https://github.com/mongodb/mongo-python-driver)
- mongoDB: [https://www.mongodb.com/](https://www.mongodb.com/)

æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š

	mongod
	cd weiboSA
	scrapy crawl mblogSpider

å¯é€‰å‚æ•°ï¼š

	scrapy crawl mblogSpider -a num= -a new_url=

- num ä»£è¡¨çˆ¬å–é¡µé¢æ•°ï¼Œé»˜è®¤ä¸º100é¡µï¼Œç›®å‰åªæ”¯æŒ100é¡µã€‚

- newurl é»˜è®¤ä¸ºæœç´¢ç§»åŠ¨ç«¯â€˜ä¸Šæµ·ç§Ÿæˆ¿â€™è¿”å›çš„jsonæ–‡ä»¶urlï¼Œå¦‚æœè¦æ·»åŠ å…¶ä»–ä¸Šæµ·ç§Ÿæˆ¿ä¿¡æ¯ï¼Œæ¯”å¦‚æµ¦ä¸œç§Ÿæˆ¿ï¼Œè¯·è‡ªè¡Œåœ¨Chromeä¸­æ‰¾åˆ°è¯·æ±‚çš„jsonåœ°å€ï¼Œä¾‹å¦‚ï¼š
	http://m.weibo.cn/page/pageJson? 
	containerid=&containerid=100103type%3D1%26q%3Dæµ¦ä¸œç§Ÿæˆ¿
	&type=all 
	&queryVal=æµ¦ä¸œç§Ÿæˆ¿ 
	&luicode=10000011 
	&lfid=100103type%3D%26q%3Dä¸Šæµ·æ— ä¸­ä»‹ç§Ÿæˆ¿ 
	&title=æµ¦ä¸œç§Ÿæˆ¿ 
	&v_p=11 
	&ext=
	&fid=100103type%3D1%26q%3Dæµ¦ä¸œç§Ÿæˆ¿
	&uicode=10000011
	&next_cursor=
	&page=
	å¦‚æœè¦æ•°æ®åº“æ”¶å½•â€˜æµ¦ä¸œç§Ÿæˆ¿â€™å†å²è®°å½•ä¿¡æ¯ï¼Œè¯·å°†pipelines.pyç¬¬87ã€88è¡Œæ³¨é‡Šæ‰ã€‚ä¸€èˆ¬å¦‚æœæœ‰â€˜ä¸Šæµ·ç§Ÿæˆ¿â€™äº†å°±ä¸è¦å»æœç´¢â€˜æµ¦ä¸œç§Ÿæˆ¿â€™ï¼Œå› ä¸ºåŸºæœ¬ä¸Šæœ‰â€˜æµ¦ä¸œç§Ÿæˆ¿â€™çš„å¾®åšéƒ½ä¼šæœ‰@â€˜ä¸Šæµ·ç§Ÿæˆ¿â€™ï¼Œæ‰€ä»¥ä¸‹é¢ä¼šå‡ºç°æ’å…¥é‡å¤è®°å½•é”™è¯¯ã€‚

<pre>
âœ  weiboZ git:(master) âœ— scrapy crawl mblogSpider -a num=10 -a new_url="http://m.weibo.cn/page/pageJson\?containerid\=\&containerid\=100103type%3D1%26q%3D%E6%B5%A6%E4%B8%9C%E7%A7%9F%E6%88%BF\&type\=all\&queryVal\=%E6%B5%A6%E4%B8%9C%E7%A7%9F%E6%88%BF\&luicode\=10000011\&lfid\=100103type%3D%26q%3D%E4%B8%8A%E6%B5%B7%E6%97%A0%E4%B8%AD%E4%BB%8B%E7%A7%9F%E6%88%BF\&title\=%E6%B5%A6%E4%B8%9C%E7%A7%9F%E6%88%BF\&v_p\=11\&ext\=\&fid\=100103type%3D1%26q%3D%E6%B5%A6%E4%B8%9C%E7%A7%9F%E6%88%BF\&uicode\=10000011\&next_cursor\=\&page\="
2016-10-29 14:41:11 [root] WARNING: ç”ŸæˆMongoPipelineå¯¹è±¡
2016-10-29 14:41:11 [root] WARNING: å¼€å§‹spider
2016-10-29 14:41:11 [root] WARNING: å…è®¸æ’å…¥æ•°æ®çš„æ—¶é—´å¤§äº2016-10-29 14:15:05.875000
2016-10-29 14:41:13 [root] WARNING: do page1.
2016-10-29 14:41:13 [root] WARNING: do other pages.
2016-10-29 14:41:13 [root] ERROR: ç¼–å·ä¸º:E91f233Dsçš„æ•°æ®æ’å…¥å¼‚å¸¸
2016-10-29 14:41:13 [root] ERROR: ç¼–å·ä¸º:Ef4ri5bC6çš„æ•°æ®æ’å…¥å¼‚å¸¸
2016-10-29 14:41:13 [root] ERROR: ç¼–å·ä¸º:Ef3UNqMmVçš„æ•°æ®æ’å…¥å¼‚å¸¸
2016-10-29 14:41:13 [root] ERROR: ç¼–å·ä¸º:Ef3stkA8açš„æ•°æ®æ’å…¥å¼‚å¸¸
2016-10-29 14:41:13 [root] ERROR: ç¼–å·ä¸º:Ef3pzmJ6içš„æ•°æ®æ’å…¥å¼‚å¸¸
2016-10-29 14:41:13 [root] ERROR: ç¼–å·ä¸º:Ef1OBtvQrçš„æ•°æ®æ’å…¥å¼‚å¸¸
2016-10-29 14:41:13 [root] ERROR: ç¼–å·ä¸º:Ef03Lj54zçš„æ•°æ®æ’å…¥å¼‚å¸¸
2016-10-29 14:41:13 [root] ERROR: ç¼–å·ä¸º:EeYLU2GQdçš„æ•°æ®æ’å…¥å¼‚å¸¸
2016-10-29 14:41:13 [root] ERROR: ç¼–å·ä¸º:EeYlBv7bnçš„æ•°æ®æ’å…¥å¼‚å¸¸
2016-10-29 14:41:13 [root] ERROR: ç¼–å·ä¸º:EeXkop2vuçš„æ•°æ®æ’å…¥å¼‚å¸¸
2016-10-29 14:41:15 [root] WARNING: ç»“æŸspider
</pre>
æ›´æ”¹æ—¥å¿—æ˜¾ç¤ºçº§åˆ«è¯·åœ¨setting.pyä¸­ä¿®æ”¹LOG_LEVELï¼Œä»‹æ„é‡‡ç”¨é¡¹ç›®é»˜è®¤çš„WARNNINGï¼Œå¦åˆ™ä¿¡æ¯ä¼šå¾ˆå¤šã€‚

> æŸ¥è¯¢ç¤ºä¾‹

æŸ¥è¯¢å½“å‰æ—¶åŒºçš„2016-10-20è‡³ä»Šæœ‰åœ¨9å·çº¿é™„è¿‘ç§Ÿæˆ¿æˆ¿ç§Ÿä¸é«˜äº2000çš„ä¿¡æ¯ã€‚

<pre>
db.house.find(
{
	created_at:{$gt:new Date('2016-10-20T00:00:00')},
	$or:
		[
			{price:{$lte:2000}},
			{price:[]}
		],
	admin:'9å·çº¿',
	tag:true
},
{	
	_id:0,
	text:1,
	created_at:1,
	scheme:1
}
).hint('created_at_-1').pretty()

{
	"text" : "æˆ¿å­åœ¨å¤§ä¸Šæµ·å›½é™…èŠ±å›­ï¼Œæ¼•å®è·¯1555å¼„ï¼Œè·9å·çº¿åˆå·è·¯åœ°é“ç«™æ­¥è¡Œ5åˆ†é’Ÿï¼Œè·å¾å®¶æ±‡ç«™åªæœ‰4ç«™ï¼Œç°åœ¨è½¬ç§Ÿå¤§åºŠï¼Œæœ‰ç‹¬ç«‹å«ç”Ÿé—´ï¼Œå…¬å…±å¨æˆ¿ï¼Œæˆ¿ç§Ÿ2400ï¼Œå¹³æ‘Šä¸‹æ¥1200ï¼Œæœ‰ä¸€å¥³å®¤å‹ï¼Œå®¤å‹å®œå®¶ä¸Šç­ï¼Œé™å¥³ç”Ÿï¼Œæ²¡æœ‰ç‰©ä¸šè´¹ï¼ŒåŒ…ç½‘ç»œï¼Œæ°´ç”µè‡ªç†@ä¸Šæµ·ç§Ÿæˆ¿æ— ä¸­ä»‹ @ä¸Šæµ·ç§Ÿæˆ¿æ— ä¸­ä»‹ @ä¸Šæµ·ç§Ÿæˆ¿ @ä¸Šæµ·ç§Ÿæˆ¿æ— ä¸­ä»‹è”ç›Ÿ",
	"scheme" : "http://m.weibo.cn/1641537045/EetVm3WBV?",
	"created_at" : ISODate("2016-10-25T09:18:00Z")
}
{
	"text" : "#ä¸Šæµ·ç§Ÿæˆ¿##ä¸Šæµ·å‡ºç§Ÿ#9å·çº¿æ¾æ±Ÿæ³—æ³¾åœ°é“ç«™é‡‘åœ°è‡ªåœ¨åŸï¼Œ12å±‚ï¼Œæ­¥è¡Œã€å…¬äº¤æˆ–å°åŒºç­è½¦ç›´è¾¾åœ°é“ç«™ã€‚ç²¾è£…ï¼Œå“ç‰Œå®¶å…·å®¶ç”µï¼Œä¸»å§1800RMB/æœˆï¼›å…¬å¯“é—¨ç¦å‡ºå…¥ï¼Œæˆ¿ä¸œç›´ç§Ÿï¼Œç”µè¯ï¼š13816835869ï¼Œæˆ–QQï¼š36804408ã€‚@ä¸Šæµ·ç§Ÿæˆ¿ @äº’åŠ©ç§Ÿæˆ¿ @æˆ¿å¤©ä¸‹ä¸Šæµ·ç§Ÿæˆ¿ @ä¸Šæµ·ç§Ÿæˆ¿æ— ä¸­ä»‹   @åº”å±Šæ¯•ä¸šç”Ÿä¸Šæµ·ç§Ÿæˆ¿",
	"scheme" : "http://m.weibo.cn/1641537045/Een8cAoy8?",
	"created_at" : ISODate("2016-10-24T16:00:00Z")
}
{
	"text" : "#ä¸Šæµ·ç§Ÿæˆ¿# ä¸ªäººç¦»å¼€ä¸Šæµ·ï¼šè½¬ç§Ÿåœ°é“9å·çº¿æœå—ä¸»å§å¸¦å¤§é˜³å°ï¼Œç¦»åœ°é“ç«™ä¸¤åˆ†é’Ÿï¼è®¾å¤‡é½å…¨ï¼Œäº¤é€šæ–¹ä¾¿ï¼Œéšæ—¶å…¥ä½ã€‚å…·ä½“ä¿¡æ¯çœ‹å›¾ç‰‡ï½@ä¸Šæµ·ç§Ÿæˆ¿ @ä¸Šæµ·ç§Ÿæˆ¿æ— ä¸­ä»‹è”ç›Ÿ @é­”éƒ½ç§Ÿæˆ¿ å¸®è½¬è°¢è°¢ï¼",
	"scheme" : "http://m.weibo.cn/1641537045/EdRpfuKuH?",
	"created_at" : ISODate("2016-10-21T07:14:00Z")
}
{
	"text" : "9å·çº¿æ¡‚æ—è·¯ ç¦»åœ°é“ç«™8åˆ†é’Ÿ æ‹›å¥³ç”Ÿå®¤å‹å“¦ @ä¸Šæµ·ç§Ÿæˆ¿ @ä¸Šæµ·ç§Ÿæˆ¿æ— ä¸­ä»‹è”ç›Ÿ ä¸Šæµ·Â·å—äº¬è¥¿è·¯",
	"scheme" : "http://m.weibo.cn/1641537045/EdJ2U8Kv3?",
	"created_at" : ISODate("2016-10-20T09:57:00Z")
}
</pre>

> Note


python çš„ç¬¬ä¸‰æ–¹requestsåº“ä½¿ç”¨èµ·æ¥æ¯”è‡ªå¸¦çš„urllibæ›´å®¹æ˜“ï¼Œæ˜¯å¯¹urlibçš„è¿›ä¸€æ­¥å°è£…ï¼Œè¯»è€…å¯ä»¥è‡ªå·±å°è¯•ï¼Œè¿™é‡Œä¸å†ä¸¾ä¾‹ã€‚
åœ¨spideræ–‡ä»¶å¤¹ç›®å½•ä¸‹å¯è‡ªå»ºçˆ¬è™«ï¼Œçˆ¬å–åƒè±†ç“£ç§Ÿæˆ¿å°ç»„ç±»ä¼¼ä¿¡æ¯åŠ å…¥æ•°æ®åº“ã€‚
æ•°æ®åˆ†æéƒ¨åˆ†æ¯”å¦‚å¦‚ä½•è¯†åˆ«å¾®åšæœºå™¨äººï¼Œå¦‚ä½•æ„å»ºä¿¡æ¯è¯„ä»·æŒ‡æ ‡ç­‰ï¼Œæ¯ä¸ªäººå®ç°æ–¹æ¡ˆä¸ä¸€æ ·ï¼ŒæŒ–æ˜ä¿¡æ¯çš„ç¨‹åº¦ä¸åŒè€Œå·²ï¼Œæœ¬æ–‡ä¸äºˆç»™å‡ºã€‚
å¯è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œæ¯”å¦‚ä¸€èˆ¬ä¸Šæµ·ç§Ÿæˆ¿æ¯å¤©æ›´æ–°ä¸¤é¡µï¼Œå°±å®šæ—¶è¿è¡Œå‘½ä»¤å¹¶ä¸”num=2ã€‚
æŠ€æœ¯åˆ†äº«ï¼Œå…¨ç¯‡äº”åƒå¤šå­—æ¬¢è¿è½¬è½½ï¼Œä½†è¯·æ³¨æ˜å‡ºå¤„ï¼Œå¦åˆ™ï¼Œå¦åˆ™æˆ‘å“­ç»™ä½ çœ‹ğŸ˜¢ã€‚ã€‚ã€‚






## 15.3 Google Plus æ–‡æœ¬æå–ä¸åˆ†æ
æœ¬æ–‡æ‰€æœ‰æ•°æ®æºè‡ªgoogle+,å…¨ç¯‡å›´ç»•äº”ä¸ªæ–¹é¢æ¥è¿›è¡Œæ–‡æœ¬æå–å’Œåˆ†æï¼š

1. æ•°æ®è·å–
1. ä¸­æ–‡åˆ†è¯
1. NLTK
1. ç‰¹å¾è¯æå–
1. æ–‡æœ¬ç›¸ä¼¼åº¦

é™¤æ­¤ä¹‹å¤–æœ¬æ–‡è¿˜è®¾è®¡åˆ°æƒ…æ„Ÿè¯åˆ†æï¼Œé½æ™®å¤«å®šå¾‹ç­‰ã€‚å…¶ä»–æ–¹æ³•åƒæ‘˜è¦è‡ªåŠ¨æå–ã€æ„è§æŒ–æ˜ã€æ–‡æœ¬èšç±»ã€æ–°é—»åˆ†ç±»ç­‰å¸¸è§„æ–‡æœ¬åˆ†æå†…å®¹å¹¶ä¸é€‚åˆgoogle+çš„æ•°æ®é›†ï¼Œå› æ­¤æœ¬æ–‡æ²¡æœ‰æ¶‰åŠã€‚

### 15.3.1 è·å–æ•°æ®

> å‡†å¤‡

google+ api è·å–æˆæƒï¼š
![](https://i.imgur.com/HUdxxZ7.png)

å·¦ä¾§æ ç¬¬ä¸‰ä¸ªï¼Œç‚¹â€œå‡­æ®â€ï¼Œåˆ›å»ºapiå¯†é’¥ã€‚è¿™é‡Œç”¨apiå¯†é’¥å°±å¯ä»¥ï¼Œæ¯•ç«Ÿåªé‡‡é›†å…¬å…±æ•°æ®ä¿¡æ¯ï¼Œä¸æ˜¯ç”¨æˆ·éšç§æ•°æ®ï¼ˆéœ€è¦ç”¨æˆ·è®¤è¯ï¼‰ã€‚
![](https://i.imgur.com/4H2Jf3H.png)

Google+ APIæ–‡æ¡£ä¸­å…·ä½“åˆ—å‡ºäº†ä½¿ç”¨æ–¹æ³•ã€‚æ­¤å¤–ï¼Œæœ‰ä¸“é—¨çš„APIæµè§ˆå™¨å¯ä»¥æ ¹æ®æŸ¥è¯¢æ¡ä»¶å¿«é€Ÿç”ŸæˆRESTfulå¯¹åº”çš„urlåœ°å€ï¼Œå¾—åˆ°æŸ¥è¯¢ç»“æœã€‚(ä½¿ç”¨ä¹‹å‰å…ˆè®¾ç½®å³ä¸Šè§’çš„API id)

> RESTful API

ä»¥æŸ¥è¯¢æŸä¸ªç”¨æˆ·ä¸ºä¾‹ã€‚

- ä½¿ç”¨APIæµè§ˆå™¨
![](https://i.imgur.com/QS7eT0G.png)

![](https://i.imgur.com/WitGNSD.png)

- ç›´æ¥æµè§ˆå™¨æŠ“å–

<pre>
curl "https://www.googleapis.com/plus/v1/people?query=Trucy+Luce&key=$api_key"
</pre>

	{
	â€œkindâ€: â€œplus#peopleFeedâ€,
	â€œetagâ€: â€œ"xw0en60W6-NurXn4VBU-CMjSPEw/ycgzanUve1bCMxC0NXlP6C4MSTM"â€,
	â€œselfLinkâ€: â€œhttps://www.googleapis.com/plus/v1/people?query=Trucy+Luce&key=AIzaSyB2_mjqVwT5IpqGO8wfASMdnHUuvxwQqlIâ€,
	â€œtitleâ€: â€œGoogle+ People Search Resultsâ€,
	â€œnextPageTokenâ€: â€œCAESFTExMjAzMzk2OTk4NDI0NTc3MzQ3NQâ€,
	â€œitemsâ€: [
	{
	â€œkindâ€: â€œplus#personâ€,
	â€œetagâ€: â€œ"xw0en60W6-NurXn4VBU-CMjSPEw/xLkYpT8h4zlkDrhCUQcTzEZDl1U"â€,
	â€œobjectTypeâ€: â€œpersonâ€,
	â€œidâ€: â€œ112033969984245773475â€,
	â€œdisplayNameâ€: â€œTrucy Luceâ€,
	â€œurlâ€: â€œhttps://plus.google.com/112033969984245773475â€,
	â€œimageâ€: {
	â€œurlâ€: â€œhttps://lh3.googleusercontent.com/-L0oIZ63NyHk/AAAAAAAAAAI/AAAAAAAAABg/xr0lpRdSDLM/photo.jpg?sz=50â€
	}
	}
	]
	}

å…³äºjsonä¸­keyçš„è§£é‡Šï¼Œå¯ä»¥åœ¨APIæ–‡æ¡£ä¸­æ‰¾åˆ°ã€‚

> åˆ©ç”¨python SDK

google api for python æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯oauth2æˆæƒçš„ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ç®€å•çš„api_keyæˆæƒçš„ã€‚æˆ‘ä»¬ä½¿ç”¨ç¬¬äºŒä¸ªï¼Œè¿™æ˜¯å…¶APIæ–‡æ¡£ã€‚è¯¥å®¢æˆ·ç«¯å·²ç»æ”¯æŒpython3ç‰ˆæœ¬ï¼Œè¿™é‡Œæœ¬æ–‡ä»£ç éƒ½ä»¥python3ä¸ºåŸºç¡€ã€‚

<pre>
import httplib2
import json
import apiclient.discovery # pip install google-api-python-client

Q = "Trucy Luce"
API_KEY = 'è‡ªå·±è¾“å…¥' 
service = apiclient.discovery.build('plus', 'v1', http=httplib2.Http(), developerKey=API_KEY)
people_feed = service.people().search(query=Q).execute()
print (json.dumps(people_feed['items'], indent=2))
</pre>

buildæ–¹æ³•è¯¦ç»†æŸ¥çœ‹ä»£ç ä¸­çš„apiè¯´æ˜ï¼Œè¿”å›ä¸€ä¸ªä¸æœåŠ¡äº¤äº’çš„èµ„æºå¯¹è±¡ï¼ˆâ€ A Resource object with methods for interacting with the service. â€œ ï¼‰ã€‚è€Œè¿™ä¸ªå¯¹è±¡å®é™…ä¸Šæ˜¯è°ƒåŠ¨äº† build_from_documenè¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯googleapiclient.discovery.Resourceèµ„æºå¯¹è±¡ï¼Œå®šä½åˆ°è¿™ä¸ªResourceèµ„æºå¯¹è±¡ï¼Œä½†ä»”ç»†æŸ¥æ‰¾å‘ç°å…¶æ–¹æ³•ä¸‹é¢æ²¡æœ‰people()æ–¹æ³•ï¼Œä½†æœ‰ä¸‰ä¸ªç”Ÿæˆæ–¹æ³•çš„æ–¹æ³•ï¼š

	_add_basic_methods
	_add_nested_resources
	_add_next_methods

å®é™…ä¸Šè¿™ä¸‰ä¸ªæ–¹æ³•æ˜¯æ ¹æ®responseçš„schemå±‚æ¬¡ç»“æ„æ¥ç”Ÿæˆçš„ï¼Œè¿™é‡Œçš„ä»£ç å€¼å¾—å­¦ä¹ ã€‚ æœ€ååªæ‰“å°itemséƒ¨åˆ†ï¼Œç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹:

	[
	{
	â€œetagâ€: â€œ"xw0en60W6-NurXn4VBU-CMjSPEw/xLkYpT8h4zlkDrhCUQcTzEZDl1U"â€,
	â€œdisplayNameâ€: â€œTrucy Luceâ€,
	â€œobjectTypeâ€: â€œpersonâ€,
	â€œimageâ€: {
	â€œurlâ€: â€œhttps://lh3.googleusercontent.com/-L0oIZ63NyHk/AAAAAAAAAAI/AAAAAAAAABg/ xr0lpRdSDLM/photo.jpg?sz=50â€
	},
	â€œidâ€: â€œ112033969984245773475â€,
	â€œkindâ€: â€œplus#personâ€,
	â€œurlâ€: â€œhttps://plus.google.com/112033969984245773475â€
	}
	]
æ¥ä¸‹æ¥æŒ–æ˜ä¸‹æŸä¸ªç”¨æˆ·çš„è¿‘æœŸæ´»åŠ¨ï¼Œå®é™…ä¸Šå°±åƒæ¨ç‰¹æˆ–è€…ä¸€æ¡è¯´è¯´ã€‚è¿™æ¬¡æŒ‘ä¸ªè¯´ä¸­æ–‡çš„â€œMulin Hongâ€ã€‚

<pre>
USER_ID = '102121409478764742904' # Mulin Hong
service = apiclient.discovery.build('plus', 'v1', http=httplib2.Http(), developerKey=API_KEY)
activity_feed = service.activities().list(
  userId=USER_ID,
  collection='public',
  maxResults='100' # æœ€å¤§å…è®¸è®°å½•æ¡æ•°
).execute()
print (json.dumps(activity_feed, ensure_ascii=False,indent=2))
</pre>
service.activities().listæ–¹æ³•æœ‰å‡ ä¸ªå¿…è¦å‚æ•°ï¼ŒuserId:æ´»åŠ¨å‘èµ·è€…Idã€‚å¯é€‰å‚æ•°ï¼šcollection:æ´»åŠ¨å½’å±çš„é›†,é»˜è®¤ä¸ºpublicï¼Œè¿˜æ˜¯çœ‹ä¸‹é¢å›¾ç‰‡å§ï¼š

![](https://i.imgur.com/gcHi9iM.png)

å…¶ä»–å‚æ•°å¯ä»¥é€šè¿‡å‘½ä»¤help(service.activities().list)æ¥æŸ¥çœ‹ã€‚ ç”±äºå…±7000å¤šè¡Œï¼Œä¸æ–¹ä¾¿ç›´æ¥æ”¾å…¥æ–‡ç« ï¼Œå¯ä»¥ç‚¹å‡»æŸ¥çœ‹å†…å®¹ã€‚

å¦‚æœä»”ç»†è§‚å¯Ÿå†…å®¹ï¼Œä½ ä¼šå‘ç°contentä¸­æœ‰è®¸å¤šhtmlæ ‡ç­¾ï¼Œåƒ<br>ä¹‹ç±»çš„åœ¨æ–‡æœ¬ä¸­åº”è¯¥å»é™¤ï¼Œè¿™é‡Œç”¨åˆ°python Beautifulsoup4åŒ…1,(Beautiful Soup)å·²æˆä¸ºå’Œlxmlã€html6libä¸€æ ·å‡ºè‰²çš„pythonè§£é‡Šå™¨ï¼Œä¸ºç”¨æˆ·çµæ´»åœ°æä¾›ä¸åŒçš„è§£æç­–ç•¥æˆ–å¼ºåŠ²çš„é€Ÿåº¦ï¼Œæä¾›ä¸€äº›ç®€å•çš„ã€pythonå¼çš„å‡½æ•°ç”¨æ¥å¤„ç†å¯¼èˆªã€æœç´¢ã€ä¿®æ”¹åˆ†ææ ‘ç­‰åŠŸèƒ½ã€‚å®ƒæ˜¯ä¸€ä¸ªå·¥å…·ç®±ï¼Œé€šè¿‡è§£ææ–‡æ¡£ä¸ºç”¨æˆ·æä¾›éœ€è¦æŠ“å–çš„æ•°æ®ï¼Œå› ä¸ºç®€å•ï¼Œæ‰€ä»¥ä¸éœ€è¦å¤šå°‘ä»£ç å°±å¯ä»¥å†™å‡ºä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ç¨‹åºã€‚ç®€å•æ¥è¯´ï¼ŒBeautiful Soupæ˜¯pythonçš„ä¸€ä¸ªåº“ï¼Œæœ€ä¸»è¦çš„åŠŸèƒ½æ˜¯ä»ç½‘é¡µæŠ“å–æ•°æ®ã€‚æ›´å¤šå…³äºBeautiful Soupçš„å†…å®¹å¯ä»¥å‚è§å­¦ä¹ æ•™ç¨‹2ã€‚

éšä¾¿æ‹¿æ¡å†…å®¹:
![](https://i.imgur.com/nvPBGEb.png)

å¯ä»¥å‘ç°é‡Œé¢é™¤äº†å«æœ‰htmlæ ‡ç­¾è¿˜æœ‰BOMå­—ç¬¦(\ufeff)ï¼Œä½¿ç”¨bs4å»é™¤ï¼š
![](https://i.imgur.com/RSV83Wg.png)

æˆ‘ä»¬ä¸Šé¢åªæ‹¿äº†100æ¡è®°å½•ï¼Œèƒ½ä¸èƒ½æ‹¿å…¨éƒ¨è®°å½•å‘¢ï¼Ÿæˆ‘ä»¬åœ¨çœ‹ä¸€ä¸‹çˆ¬ä¸‹çš„jsonæ–‡ä»¶ï¼Œå‘ç°ç¬¬ä¸€è¡Œæ˜¾ç¤ºnextPageTokenï¼Œä¹Ÿå°±æ˜¯è¯´è¿˜æœ‰ä¸‹ä¸€é¡µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡service.activities().list_nextæ–¹æ³•æ‹¿åˆ°ä¸‹ä¸€é¡µçš„resopnseã€‚æœ€åæˆ‘ä»¬æ‹¿åˆ°æ‰€æœ‰jsonå¹¶ç”¨ä¸Šé¢æ–¹æ³•æ¸…æ´—æ•´ç†ã€‚

<pre>
import os
import httplib2
import json
import apiclient.discovery
from bs4 import BeautifulSoup

USER_ID = '102121409478764742904' # Mulin Hong
MAX_RESULTS = 400 # æœ€å¤§çºªå½•æ•°ï¼Œæ¯é¡µ100æ¡ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤š5é¡µï¼ˆ0~4é¡µï¼‰
API_KEY = 'ä½ è‡ªå·±çš„api_key' 

def cleanHtml(html):
  if html == "": return ""
  return BeautifulSoup(html,'lxml').get_text()[:-1]

service = apiclient.discovery.build('plus', 'v1', http=httplib2.Http(), 
                                    developerKey=API_KEY)
activity_feed = service.activities().list(userId=USER_ID,
  collection='public',
  maxResults='100' 
)

activity_results = []

while activity_feed != None and len(activity_results) < MAX_RESULTS:
  activities = activity_feed.execute()
  if 'items' in activities:
    for activity in activities['items']:
      if activity['object']['objectType'] == 'note' and activity['object']['content'] != '':        
        activity['title'] = cleanHtml(activity['title'])
        activity['object']['content'] = cleanHtml(activity['object']['content'])
        activity_results += [activity]
#æŸ¥çœ‹ä¸‹ä¸€é¡µ
  activity_feed = service.activities().list_next(activity_feed, activities)
# å†™åˆ°ä¸€ä¸ªjsonæ–‡ä»¶ä¸­å»
f = open(os.path.join('resources', USER_ID + '.json'), 'w')
f.write(json.dumps(activity_results,ensure_ascii=False, indent=2))
f.close()
print (str(len(activity_results)), "activities written to", f.name)
</pre>
æœ€åè¾“å‡ºç»“æœâ€422 activities written to resources/102121409478764742904.jsonâ€ï¼Œå…±422æ¡è¢«è¾“å‡ºã€‚æŸ¥çœ‹
### 15.3.2 ä¸­æ–‡åˆ†è¯

ä¸ºäº†è¿›ä¸€æ­¥å¯¹æ¯æ¡è®°å½•åˆ†æï¼Œæœ‰å¿…è¦è¿›è¡Œä¸­æ–‡åˆ†è¯ã€‚æ–‡ç« 3ä¸­æåˆ°11æ¬¾å¼€æ”¾ä¸­æ–‡åˆ†è¯å¼•æ“ï¼Œä»åˆ†è¯æ•ˆæœå’Œè°ƒç”¨éš¾åº¦è§’åº¦è€ƒè™‘ï¼Œè¿™é‡Œé‡‡ç”¨å•†ä¸šåŒ–çš„BosonNLPå·¥å…·ï¼ˆå…³é”®è¢«ä»–ä¸€å¥å¹¿å‘Šå¸å¼•â€œç°åœ¨åŠ å…¥BosonNLPï¼Œå¯è·å¾—åˆ†è¯ä¸è¯æ€§æ ‡æ³¨å¼•æ“ä¸é™é‡è°ƒç”¨é¢åº¦ï¼â€ï¼‰ã€‚ æ³¨å†Œæ³¢æ£®åä¼šç»™ä½ ä¸€ä¸ªapi_keyï¼Œå’Œgoogle+ä¸€ä¸ªåŸç†ã€‚å®‰è£…pythonç‰ˆSDKï¼š pip install -U bosonnlp ã€‚apiæ–‡æ¡£å¾ˆç®€å•ï¼Œçœ‹ä¸€éå°±ç›´æ¥ç”¨äº†ã€‚

å¼•ç”¨æ–¹æ³•ï¼š

<pre>
In [1]: from bosonnlp import BosonNLP

In [2]: nlp = BosonNLP('ä½ è‡ªå·±çš„api_key')

In [3]: s='å½“å¹´åŒ—äº¬å¸‚é•¿å¤¸ä¸‹æµ·å£ï¼š 2017å¹´æ²»ä¸äº†é›¾éœ¾å°±æå¤´æ¥è§      2016å¹´10æœˆ16æ—¥ï¼ŒåŒ—äº¬å¸‚ç©ºæ°”æ±¡æŸ“æŒ‡æ•°è¯»æ•°    å—¯ï¼Œ
   ...: åŒ—äº¬å¸‚é•¿åŒå¿—ï¼Œä½ åªæœ‰ä¸¤ä¸ªå¤šæœˆçš„æ—¶é—´äº†â€¦â€¦'

In [4]: nlp.tag(s)[0]['word']
Out[6]:
['å½“å¹´',
 'åŒ—äº¬',
 'å¸‚é•¿',
 'å¤¸',
 'ä¸‹',
 'æµ·å£',
 'ï¼š',
 '2017å¹´',
 'æ²»',
 'ä¸',
 'äº†',
 'é›¾éœ¾',
 ...
</pre>
ç›´æ¥ä½¿ç”¨é‡Œé¢çš„apiè¿›è¡Œæƒ…æ„Ÿåˆ†æï¼š

<pre>
from bosonnlp import BosonNLP
nlp = BosonNLP('ä½ çš„api_key')
all_content = [a['object']['content'] for a in activity_results ]
emos=nlp.sentiment(all_content[:100], model='weibo')#å•è¯æœ€å¤šåªèƒ½åˆ†æ100ä¸ªï¼Œæ¯æ—¥æœ€å¤š500ä¸ª
drawdata=list(zip(*emos))[0]
</pre>

ç»˜åˆ¶ç®±çº¿å›¾å’Œç»Ÿè®¡ç›´æ–¹å›¾ï¼š
![](https://i.imgur.com/J5P2HTo.png)
![](https://i.imgur.com/fOPo8eW.png)

ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ•´ä½“æƒ…æ„Ÿåä¸Šï¼Œè¿™é‡Œåªè®¡ç®—äº†100æ¡ï¼Œæœ‰å…´è¶£æŠŠä¸€å¤©çš„å…è´¹è®°å½•æ•°500æ¡å…¨è®¡ç®—å®Œäº†çœ‹çœ‹ç»“æœã€‚å½“ç„¶æƒ…æ„Ÿç®—æ³•ç”¨çš„å¾ˆæ™®éäº†ï¼Œè‡ªå·±å®ç°ä¸ªä¹Ÿééš¾äº‹ã€‚ hrKOofx5.10057.yUUmemEd43Dm

### 15.3.3 NLTK

æ–¯å¦ç¦å¤§å­¦è‡ªç„¶è¯­è¨€å¤„ç†ç»„æ˜¯ä¸–ç•ŒçŸ¥åçš„NLPç ”ç©¶å°ç»„ï¼Œä»–ä»¬æä¾›äº†ä¸€ç³»åˆ—å¼€æºçš„Javaæ–‡æœ¬åˆ†æå·¥å…·ï¼ŒåŒ…æ‹¬åˆ†è¯å™¨(Word Segmenter)ï¼Œè¯æ€§æ ‡æ³¨å·¥å…·ï¼ˆPart-Of-Speech Taggerï¼‰ï¼Œå‘½åå®ä½“è¯†åˆ«å·¥å…·ï¼ˆNamed Entity Recognizerï¼‰ï¼Œå¥æ³•åˆ†æå™¨ï¼ˆParserï¼‰ç­‰ï¼Œå¯å–œçš„äº‹ï¼Œä»–ä»¬è¿˜ä¸ºè¿™äº›å·¥å…·è®­ç»ƒäº†ç›¸åº”çš„ä¸­æ–‡æ¨¡å‹ï¼Œæ”¯æŒä¸­æ–‡æ–‡æœ¬å¤„ç†ã€‚NLTK4æ˜¯é’ˆå¯¹pythonçš„ä¸€ä¸ªè‡ªç„¶è¯­è¨€å¤„ç†å¹³å°,åœ¨windowsã€macã€linuxå¹³å°ä¸Šé€šç”¨ï¼Œå¹¶ä¸”æ˜¯å¼€æºå…è´¹çš„ï¼Œå›½å†…å¥½å¤šé¡¹ç›®éƒ½æ˜¯åœ¨å®ƒåŸºç¡€ä¸Šåšçš„ã€‚ ä¸‹é¢ç”¨nltkåˆ†æä¸‹æŠ“åˆ°çš„æ•°æ®ã€‚

<pre>

import nltk
from bosonnlp import BosonNLP

nlp = BosonNLP('ä½ è‡ªå·±çš„api_key')

#å°†æ‰€æœ‰è®°å½•è½¬åŒ–ä¸ºä¸€ä¸ªè¯è¯­æ•°ç»„tokens
contents='ã€‚'.join(all_content)
tokens=nlp.tag(contents)[0]['word']
text = nltk.Text(tokens)

text.concordance("ä¸‰æ˜Ÿ")#æŸ¥çœ‹å‡ºç°â€˜ä¸‰æ˜Ÿâ€™çš„è¯­å¥,å¯é€‰å‚æ•°åŒ…æ‹¬è¯­å¥æ•°ç›®å’Œè¯­å¥é•¿åº¦
'''
Displaying 4 of 4 matches:
 åŒ—äº¬ å¸‚é•¿ å‡†å¤‡ å¦‚ä½• æ”¶åœº ï¼Ÿ ã€‚ # çœ‹ å›¾ ä¸ è¯´è¯ 1016 ï¼š ä¸‰æ˜Ÿ æ‰‹æœº åä¸è™šä¼  ã€‚ How to mess up # StarWars a
å‡ è®ºæ–‡ ï¼Œ é‚£ å°± æ˜¯ ä¸¢è„¸ äº† ã€‚ # çœ‹ å›¾ ä¸ è¯´è¯ 0923 ï¼š ä¸‰æ˜Ÿ ä¸€ç”Ÿ é»‘ http://cinacn.blogspot.com/2016/
 ï¼š å¿ƒé‡Œ æƒ³ è¯´ æ²¡äº‹ äº† ã€‚ # çœ‹ å›¾ ä¸ è¯´è¯ 0917 ï¼š ä½¿ç”¨ ä¸‰æ˜Ÿ æ‰‹æœº çš„ åæœ ã€‚ è¿™ä¸ª é”™è¯¯ æœ‰ç‚¹ å¤§ äº† ã€‚ çœ‹çœ‹ æœé²œ æˆ˜äº‰ å¤§äº‹è®°
 ä½ ä»¬ å¼€å­¦ ä¸€æ¬¡æ€§ äº¤ å¤šå°‘ é’± ã€‚ # çœ‹ å›¾ ä¸ è¯´è¯ 0906 ï¼š ä¸‰æ˜Ÿ æ‰‹æœº çš„ ä¸­ä¸œ ç‰ˆ ã€‚ èˆ†æƒ… ç›‘æ§ ï¼Œ å·²ç» æ˜¯ å¤§é™† åª’ç•Œ ä¸ç”¨ å…¬å¼€ 
'''
text.collocations()#æœ€æ­é…çš„ç”¨è¯
'''
Displaying 4 of 4 matches:
 åŒ—äº¬ å¸‚é•¿ å‡†å¤‡ å¦‚ä½• æ”¶åœº ï¼Ÿ ã€‚ # çœ‹ å›¾ ä¸ è¯´è¯ 1016 ï¼š ä¸‰æ˜Ÿ æ‰‹æœº åä¸è™šä¼  ã€‚ How to mess up # StarWars a
å‡ è®ºæ–‡ ï¼Œ é‚£ å°± æ˜¯ ä¸¢è„¸ äº† ã€‚ # çœ‹ å›¾ ä¸ è¯´è¯ 0923 ï¼š ä¸‰æ˜Ÿ ä¸€ç”Ÿ é»‘ http://cinacn.blogspot.com/2016/
 ï¼š å¿ƒé‡Œ æƒ³ è¯´ æ²¡äº‹ äº† ã€‚ # çœ‹ å›¾ ä¸ è¯´è¯ 0917 ï¼š ä½¿ç”¨ ä¸‰æ˜Ÿ æ‰‹æœº çš„ åæœ ã€‚ è¿™ä¸ª é”™è¯¯ æœ‰ç‚¹ å¤§ äº† ã€‚ çœ‹çœ‹ æœé²œ æˆ˜äº‰ å¤§äº‹è®°
 ä½ ä»¬ å¼€å­¦ ä¸€æ¬¡æ€§ äº¤ å¤šå°‘ é’± ã€‚ # çœ‹ å›¾ ä¸ è¯´è¯ 0906 ï¼š ä¸‰æ˜Ÿ æ‰‹æœº çš„ ä¸­ä¸œ ç‰ˆ ã€‚ èˆ†æƒ… ç›‘æ§ ï¼Œ å·²ç» æ˜¯ å¤§é™† åª’ç•Œ ä¸ç”¨ å…¬å¼€ 
'''
text.collocations()#æœ€æ­é…çš„ç”¨è¯
'''
@Homebaby Wen; little pink; sounds cute; æ ¸åºŸæ–™ å¤„ç†å‚; è¯ºè´å°” æ–‡å­¦å¥–; è¿äº‘æ¸¯ æ ¸åºŸæ–™;
åˆ›ä¸šè€… è¶Šæ¥è¶Š
'''
fdist = text.vocab()#{è¯1ï¼šè¯1å‡ºç°çš„ä¸ªæ•°ï¼Œè¯2ï¼šè¯2å‡ºç°çš„ä¸ªæ•°ï¼Œ...}
print(fdist["å¤§é™†"])
print(fdist["è€ç™¾å§“"])
print(fdist["çš„"])
print(fdist["ä¸"])
'''
25
27
1250
351
'''
print(len(tokens)) #æ€»å…±çš„è¯æ•°
print(len(fdist.keys())) #ä¸é‡å¤è¯
print(fdist.freq('çš„'))#1250/27232
print(fdist.most_common(20))# å‡ºç°æ¬¡æ•°æœ€å¤§çš„å‰20ä¸ª
'''
27232
6465
0.04590188014101058
[('ï¼Œ', 1651), ('çš„', 1250), ('ã€‚', 959), ('ï¼š', 568), ('æ˜¯', 495), ('äº†', 380), ('ä¸', 351), ('â€', 257), ('â€œ', 255), ('#', 242), ('ä¸€', 222), ('å°±', 207), ('åœ¨', 200), ('æœ‰', 162), ('ï¼Ÿ', 150), ('ä½ ', 130), ('æˆ‘', 129), ('è¿™', 129), ('äºº', 127), ('éƒ½', 124)]
'''
nltk.download('stopwords')
'''
[nltk_data] Downloading package stopwords to /Users/Trucy/nltk_data...
[nltk_data]   Unzipping corpora/stopwords.zip.
ç„¶ååœ¨è§£å‹çš„åœè¯ç›®å½•ä¸­æ·»åŠ chinaæ–‡ä»¶ï¼Œé‡Œé¢æ·»åŠ åœè¯ï¼Œè¿™é‡Œç”¨çš„å“ˆå·¥å¤§åœè¯åº“
'''
comm=list(zip(*fdist.most_common(100)))[0]#100ä¸ªçƒ­è¯ä¸­éåœè¯
print([w for w in comm if w not in nltk.corpus.stopwords.words('china')])
'''
['ä¸­å›½', 'è¯´', 'å›½å®¶', 'æ¯›', 'å¾®', 'è¯­å½•', 'ç²¾é€‰', 'å›¾', 'è¯´è¯', 'ä¸­å…±', 'æ—¥', 'æ”¿åºœ', 'å¹´', 'çˆ±å›½', 'ç¾å›½', 'å¤©', 'é’±', 'èŸèƒ', 'æ®µå­', 'é‡Œ', 'æƒ³']
'''
# éurlçš„é•¿è¯è¯­
print([w for w in fdist.keys() if len(w) > 12 and not w.startswith("http")])
'''
['@jianshenbiao', '@Jackstraw_PRC', '@Andrew19751110', '@boattractor_cj', '@_markhortonæå¾—åè€…ä¸å¾—ä¸', '@Weaponmagazine-è‚–å®ï¼‰', '@YE5MQ5Vtp2jlWX7', '@Menghuanlangqi2', '@szstupidcool', '@zhifangnvren', 'HappyBirthday', '@freedomandlaw', '@_mackhortonç»“æœæ”»å‡»äº†ä¸€ä¸ªå­—æ¯ä¹‹å·®çš„æ— è¾œé¬¼ä½¬', '@å’Œèœå¤´ï¼‰â€”â€”ä¸­å›½äººèƒ½æ¥å—ä¹ˆï¼Ÿä¸æ¯«æ²¡æœ‰å¯¹ä»–å›½çš„å°Šé‡', '@BattlerHenry', '@c338ki_selina', '@shangguanluan', '@zhanghui8964', '@fedsneighbor']
'''
</pre>

ç›¸ä¿¡ä½ è‚¯å®šå¬è¿‡äºŒå…«åŸåˆ™ï¼Œå¦‚æœæŠŠæ‰€æœ‰çš„å•è¯ï¼ˆå­—ï¼‰æ”¾åœ¨ä¸€èµ·çœ‹å‘¢ï¼Ÿä¼šä¸ä¼š20%çš„è¯ï¼ˆå­—ï¼‰å äº†80%çš„å‡ºç°æ¬¡æ•°ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚

æ—©åœ¨ä¸Šä¸ªä¸–çºª30å¹´ä»£ï¼Œå°±æœ‰äººï¼ˆZipfï¼‰å¯¹æ­¤ä½œå‡ºäº†ç ”ç©¶ï¼Œå¹¶ç»™å‡ºäº†é‡åŒ–çš„è¡¨è¾¾â€”â€”é½æ™®å¤«å®šå¾‹ï¼ˆZipfâ€™s Lawï¼‰ï¼šä¸€ä¸ªè¯åœ¨ä¸€ä¸ªæœ‰ç›¸å½“é•¿åº¦çš„è¯­ç¯‡ä¸­çš„ç­‰çº§åºå·ï¼ˆè¯¥è¯åœ¨æŒ‰å‡ºç°æ¬¡æ•°æ’åˆ—çš„è¯è¡¨ä¸­çš„ä½ç½®ï¼Œä»–ç§°ä¹‹ä¸ºrankï¼Œç®€ç§°rï¼‰ä¸è¯¥è¯çš„å‡ºç°æ¬¡æ•°ï¼ˆä»–ç§°ä¸ºfrequencyï¼Œç®€ç§°fï¼‰çš„ä¹˜ç§¯å‡ ä¹æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼ˆconstantï¼Œç®€ç§°Cï¼‰ã€‚ç”¨å…¬å¼è¡¨ç¤ºï¼Œå°±æ˜¯ r Ã— f = C ã€‚ï¼ˆæ­¤å¤„çš„Cä¸€èˆ¬è®¤ä¸ºå–0.1ï¼‰ã€‚Zipfå®šå¾‹æ˜¯æ–‡çŒ®è®¡é‡å­¦çš„é‡è¦å®šå¾‹ä¹‹ä¸€ï¼Œå®ƒå’Œæ´›ç‰¹å¡å®šå¾‹ã€å¸ƒæ‹‰å¾·ç¦å®šå¾‹ä¸€èµ·è¢«å¹¶ç§°ä¸ºæ–‡çŒ®è®¡é‡å­¦çš„ä¸‰å¤§å®šå¾‹ã€‚

æˆ‘ä»¬ç›´è§‚åœ°éªŒè¯ä¸‹ï¼Œ100ä¸ªçƒ­è¯é¢‘åº¦å’Œæ’åçš„è§„å¾‹ï¼š

<pre>
#å‰100çƒ­è¯ç»Ÿè®¡
comm=list(zip(*fdist.most_common(400)))
top=[(w,comm[1][i]) for i,w in enumerate(comm[0]) \
if w not in nltk.corpus.stopwords.words('china')]
dd=list(zip(*top[:100]))
plt.plot(range(1,101),dd[1],'-',linewidth=5,alpha=0.6)
plt.xticks(arange(1,101,2),dd[0][::2],rotation=90)
plt.xlabel('å‰100çƒ­è¯',fontsize='x-large')
plt.ylabel('é¢‘æ•°',fontsize='x-large')
plt.title('å‰100çƒ­è¯ç»Ÿè®¡',fontsize='x-large')
plt.show()

</pre>

![](https://i.imgur.com/TzqnyaM.png)

å¾ˆæ˜æ˜¾å¦‚æœå»æ‹Ÿåˆçš„è¯æ˜¯åæ¯”ä¾‹æ›²çº¿ï¼Œæœ‰å…´è¶£çš„ä½¿ç”¨æœ€å°äºŒä¹˜æ³•æ‹Ÿåˆä¸‹ï¼Œçœ‹ä¸‹cç­‰äºå¤šå°‘ã€‚åŒæ ·å¯ä»¥çœ‹åˆ°ï¼Œçƒ­è¯ä¸­æ¶‰åŠæ”¿æ²»è¯æ±‡æ¯”è¾ƒå¤šï¼Œå®é™…ä¸Šå¥½å¤šä¸­æ–‡è¯´è¯´éƒ½æ¶‰åŠæ•æ„Ÿè¯æ±‡ï¼Œè¿™å·²ç»æ˜¯æˆ‘æŒ‘çš„ä¸æ€ä¹ˆæ•æ„Ÿçš„äº†ï¼Œä¸‡æ¶è…æœ½çš„google+ï¼Œå¤©æœæ—©æ™šå–ç¼”ä½ ğŸ˜ã€‚
### 15.3.4 ç‰¹å¾è¯æå–
è¿™èŠ‚ä¸»è¦ä»‹ç»TFIDFï¼Œé«˜æ‰‹ç›´æ¥è·³è¿‡ã€‚

ç‰¹å¾è¯/å…³é”®è¯æå–æœ€ç®€å•æœ€åŸºç¡€çš„å°±æ˜¯TFIDFï¼Œè®°å¾—5å¹´å‰æˆ‘åŒå­¦è®©æˆ‘å¸®åšDI-TFIDFçš„è®ºæ–‡ï¼Œä¹Ÿå°±åªå¤šäº†ä¸ªç±»å†…ç¦»æ•£åº¦(DI)ï¼Œä»Šå¹´é˜¿é‡Œæ ¡æ‹›ç¬”è¯•é¢˜éƒ½æœ‰ï¼Œç”¨mapreduceå®ç°çš„ï¼Œå¾ˆæ˜¯å¹¿æ³›ã€‚å®é™…ä¸Štfidfç®—æ³•çš„å²æ•°ä¼°è®¡æ¯”æˆ‘è¿˜å¤§ï¼Œç›®å‰åº”ç”¨è¿˜æ˜¯å¾ˆå¹¿ã€‚å…¶ä»–ç‰¹å¾æå–æ–¹æ³•è¿˜æœ‰TFã€MIã€ECEã€QEMIã€IGã€ORã€GAã€SAã€PCAã€N-Gramç­‰ï¼Œå„æœ‰å¥½åï¼Œä¸ªäººå–œæ¬¢SAï¼ˆæ¨¡æ‹Ÿé€€ç«ç®—æ³•ï¼‰ã€‚

ç®€å•ä»‹ç»ä¸‹TFIDFï¼ŒTFIDFçš„ä¸»è¦æ€æƒ³æ˜¯ï¼šå¦‚æœæŸä¸ªè¯æˆ–çŸ­è¯­åœ¨ä¸€ç¯‡æ–‡ç« ä¸­å‡ºç°çš„é¢‘ç‡TFé«˜ï¼Œå¹¶ä¸”åœ¨å…¶ä»–æ–‡ç« ä¸­å¾ˆå°‘å‡ºç°ï¼Œåˆ™è®¤ä¸ºæ­¤è¯æˆ–è€…çŸ­è¯­å…·æœ‰å¾ˆå¥½çš„ç±»åˆ«åŒºåˆ†èƒ½åŠ›ï¼Œé€‚åˆç”¨æ¥åˆ†ç±»ã€‚TFIDFå®é™…ä¸Šæ˜¯ï¼šTF * IDFï¼ŒTFè¯é¢‘(Term Frequency)ï¼ŒIDFåæ–‡æ¡£é¢‘ç‡(Inverse Document Frequency)ã€‚TFè¯é¢‘(Term Frequency)æŒ‡çš„æ˜¯æŸä¸€ä¸ªç»™å®šçš„è¯è¯­åœ¨è¯¥æ–‡ä»¶ä¸­å‡ºç°çš„æ¬¡æ•°ï¼‰ã€‚IDFåæ–‡æ¡£é¢‘ç‡(Inverse Document Frequency)æ˜¯æŒ‡æœåŒ…å«è¯æ¡çš„æ–‡æ¡£è¶Šå°‘ï¼ŒIDFè¶Šå¤§ï¼Œåˆ™è¯´æ˜è¯æ¡å…·æœ‰å¾ˆå¥½çš„ç±»åˆ«åŒºåˆ†èƒ½åŠ›ã€‚å…¬å¼çœ‹çœ‹é˜®ä¸€å³°çš„æ–‡ç« 5å°±æ‡‚ã€‚

å…ˆç”¨æ³¢æ£®æ¥ç©ä¸€ä¸‹ã€‚
<pre>
#ç¬¬100åˆ°109æ¡è®°å½•å„å‰äº”ä¸ªå…³é”®å­—åˆ†æ
nlp.extract_keywords(all_content[100:110],top_k=5)
</pre>
ç»“æœï¼š

	[[[0.7099039005468386, â€˜æ—å¿—é¢–â€™], [0.6618791162771835, â€˜è¯´è¯â€™], [0.16548951440531323, â€˜å›¾â€™], [0.1391678971188951, â€˜çœŸâ€™], [0.08401698377794771, â€˜çœ‹â€™]],
	[[0.4023478548923522, â€˜é¢è¯•â€™], [0.37301990285926334, â€˜ç§‹æœˆâ€™], [0.3067035017321436, â€˜ç¨‹åºå‘˜â€™], [0.3039517495852464, â€˜æœˆé¥¼â€™], [0.30299584457854634, â€˜è¯­å½•â€™]],
	[[0.47362866866222336, â€˜æœé²œâ€™], [0.3352703984048265, â€˜å…¼å¬åˆ™æ˜â€™], [0.2612360542645001, â€˜å¿—æ„¿å†›â€™], [0.25878030672041646, â€˜æˆ˜äº‰â€™], [0.21926520954291415, â€˜è„¸çº¢â€™]],
	[[0.49721835098126743, â€˜æˆ˜äº‰â€™], [0.32820426275864795, â€˜å…±äº§å…šâ€™], [0.3033420749749608, â€˜æœé²œâ€™], [0.22718247058147462, â€˜äº²åæ´¾â€™], [0.21472859448533965, â€˜ä¿å®¶â€™]],
	[[0.2454776400796074, â€˜è€å¤´â€™], [0.2404142762073897, â€˜å¯¼æ¸¸â€™], [0.18403709160053647, â€˜å¹³å£¤â€™], [0.1753006540352852, â€˜é¦–éƒ½â€™], [0.1462342959779542, â€˜å¦å…‹â€™]],
	[[0.611209874316231, â€˜è¯­å½•â€™], [0.47971562974594106, â€˜ç²¾é€‰â€™], [0.3914587127344426, â€˜å¥³ç”Ÿâ€™], [0.32629224154255926, â€˜å¤æ‚â€™], [0.24636184499215347, â€˜åˆ°åº•â€™]],
	[[0.49698250604754796, â€˜å“å§â€™], [0.41302611057797883, â€˜è€ç™¾å§“â€™], [0.34093105823385067, â€˜å¤ªç›‘â€™], [0.3321228504052302, â€˜å¤§é™†â€™], [0.2893273489670021, â€˜ç¨è´Ÿâ€™]],
	[[0.40325177993397743, â€˜å¯¼æ¸¸â€™], [0.3096728358372618, â€˜éŸ©æˆ˜â€™], [0.2929205806460173, â€˜æ¸¸å®¢â€™], [0.2480119777270853, â€˜å¸¦åŠ²â€™], [0.22704285072733602, â€˜è‡ªä»¥ä¸ºæ˜¯â€™]],
	[[0.7242722832662252, â€˜å“¥ä»¬å„¿â€™], [0.5061338668467491, â€˜ç€æ€¥â€™], [0.4404639544540359, â€˜è¯´è¯â€™], [0.11012912198474084, â€˜å›¾â€™], [0.07352170001676955, â€˜å¤ªâ€™]],
	[[0.39101364028081176, â€˜é¸¦ç‰‡â€™], [0.27683827573410325, â€˜ç§æ¤â€™], [0.22542041392575338, â€˜zhuoâ€™], [0.22542041392575338, â€˜nanjunâ€™], [0.22461629498500293, â€˜ç¼©å¤´â€™]]]

ç”¨tfidfæ¥åšä¸€ä¸‹ï¼Œåˆ†å››æ­¥èµ°ï¼š

1. åˆ†è¯
1. å»åœè¯
1. è®¡ç®—tfidf
1. æ’åºï¼ŒtopK

<pre>
cts=[]
#1.åæ¡è®°å½•çš„åˆ†è¯
for c in nlp.tag(all_content[100:110]):
    cts.append(c['word'])
tfidfC=[]
#2.å»åœè¯
for ac in cts: 
    tfidfC.append([w for w in ac 
                   if w not in nltk.corpus.stopwords.words('china')])
tc = nltk.TextCollection(tfidfC)
tfidfR=[]
topK=5
#3.è®¡ç®—tfidf
for c in tfidfC:
    res=[]
    for sc in list(set(c)):
        val=tc.tf_idf(sc,c)
        res.append([val,sc])
    #4.topK
    sres=sorted(res, key=lambda p: p[0], reverse=True)[:topK]
    tfidfR.append(sres)
print(tfidfR)
</pre>

ç»“æœ:
	
	[[[0.4605170185988092, â€˜æ—å¿—é¢–â€™], [0.3218875824868201, â€˜è¯´è¯â€™], [0.3218875824868201, â€˜çœŸâ€™], [0.3218875824868201, â€˜0913â€™], [0.3218875824868201, â€˜å›¾â€™]],
	[[0.24237737820989955, â€˜é¢è¯•â€™], [0.24237737820989955, â€˜å®˜â€™], [0.12118868910494977, â€˜ä»å‰â€™], [0.12118868910494977, â€˜ç§‹æœˆâ€™], [0.12118868910494977, â€˜åŸå› â€™]],
	[[0.1485538769673578, â€˜ä¸­â€™], [0.11651349719283252, â€˜æœé²œâ€™], [0.07767566479522169, â€˜æˆ˜äº‰â€™], [0.0742769384836789, â€˜è´¡çŒ®â€™], [0.0742769384836789, â€˜è¯â€™]],
	[[0.15703993099903515, â€˜æˆ˜äº‰â€™], [0.10496334211526741, â€˜å…±äº§å…šâ€™], [0.1001123953475672, â€˜åœºâ€™], [0.07851996549951758, â€˜æœé²œâ€™], [0.0500561976737836, â€˜è¯¾æœ¬â€™]],
	[[0.03868841135658895, â€˜è¯´â€™], [0.033210361918183356, â€˜å¥åº·â€™], [0.033210361918183356, â€˜è€å¤´â€™], [0.033210361918183356, â€˜é¦–éƒ½â€™], [0.03095072908527116, â€˜æŠ¢â€™]],
	[[0.3837641821656743, â€˜å…³ç³»â€™], [0.3837641821656743, â€˜0912â€™], [0.3837641821656743, â€˜å¥³ç”Ÿâ€™], [0.26823965207235, â€˜å¾®â€™], [0.26823965207235, â€˜ç²¾é€‰â€™]], [[0.14631253749400913, â€˜å¤§é™†â€™], [0.14631253749400913, â€˜è€ç™¾å§“â€™], [0.10466295877245664, â€˜æ€»å¾—â€™], [0.10466295877245664, â€˜å€’æ•°â€™], [0.10466295877245664, â€˜æ¯›â€™]],
	[[0.10233711524417982, â€˜æƒ³â€™], [0.07153057388596001, â€˜å¯¼æ¸¸â€™], [0.07153057388596001, â€˜è¯´â€™], [0.07153057388596001, â€˜æ¸¸å®¢â€™], [0.07153057388596001, â€˜å¹´â€™]],
	[[0.3837641821656743, â€˜ç€æ€¥â€™], [0.3837641821656743, â€˜å“¥ä»¬å„¿â€™], [0.3837641821656743, â€˜0911â€™], [0.26823965207235, â€˜è¯´è¯â€™], [0.26823965207235, â€˜å›¾â€™]],
	[[0.1151292546497023, â€˜é¸¦ç‰‡â€™], [0.1151292546497023, â€˜ç§æ¤â€™], [0.05756462732485115, â€˜zhuoâ€™], [0.05756462732485115, â€˜è¡¥ä¹ â€™], [0.05756462732485115, â€˜å……å½“â€™]]]
ä¸¤è€…æ¯”è¾ƒä¸‹æ³¢æ£®è¦ç¨å¥½ä¸€äº›ï¼Œåº•å±‚ä¼°è®¡æ˜¯æ”¹è¿›çš„tfidfã€‚

### 15.3.5 æ–‡æœ¬ç›¸ä¼¼åº¦
æˆ‘ä»¬çœ‹ä»Šæ—¥å¤´æ¡æ–°é—»ï¼Œçœ‹å®Œåä¸‹é¢ä¼šæœ‰æ¨èç›¸ä¼¼çš„æ–‡ç« ï¼Œæä¾›ä½ æ›´å¤šé˜…è¯»çš„æœºä¼šã€‚ç›¸ä¼¼æ–‡æœ¬æ¨èæœ€åŸºæœ¬çš„æ–¹æ³•ç”¨åˆ°â€ä½™å¼¦ç›¸ä¼¼æ€§â€œï¼ˆcosine similiarityï¼‰ã€‚ä¸¾ä¸ªç®€å•ä¾‹å­ï¼š ä¸¤ä¸ªæ–‡æœ¬ï¼Œå…ˆåˆ†è¯ï¼š

	æ–‡æœ¬1ï¼šgoogle/å’Œ/ç™¾åº¦/ç›¸ä¼¼
	æ–‡æœ¬2ï¼šç™¾åº¦/æ¯”ä¸äº†/è°·æ­Œ

è®¡ç®—è¯é¢‘

	æ–‡æœ¬1ï¼šgoogle:1,å’Œ:1,ç™¾åº¦:1,ç›¸ä¼¼:1
	æ–‡æœ¬2ï¼šç™¾åº¦:1,æ¯”ä¸äº†:1,è°·æ­Œ:1

åˆ—å‡ºæ‰€æœ‰è¯ï¼ŒæŒ‰è¯é¢‘æ’åºï¼š

	æ–‡æœ¬1ï¼šgoogle:1,å’Œ:1,ç™¾åº¦:1,ç›¸ä¼¼:1,æ¯”ä¸äº†:0
	æ–‡æœ¬2ï¼šgoogle:1,å’Œ:0,ç™¾åº¦:1,ç›¸ä¼¼:0,æ¯”ä¸äº†:1

æå–è¯é¢‘å‘é‡ï¼š

	æ–‡æœ¬1ï¼š[1,1,1,1,0] æ–‡æœ¬2ï¼š[1,0,1,0,1]

æ¥ä¸‹æ¥è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦:
![](https://i.imgur.com/Cg5N9Oo.png)
è¿™ä¸ªå…¬å¼ä»£è¡¨ä¸¤ä¸ªå‘é‡çš„å¤¹è§’ï¼ŒäºŒç»´å‘é‡å¤¹è§’é«˜ä¸­ä¸å°±æ˜¯è¿™ä¸ªå…¬å¼ä¹ˆï¼Œæ¨å¹¿åˆ°ä¸‰ç»´ç”šè‡³å¤šç»´ä¹Ÿä¸€æ ·ã€‚

![](https://i.imgur.com/x0yD7Ug.png)

ä½™å¼¦å€¼è¶Šæ¥è¿‘1ï¼Œå°±è¡¨æ˜å¤¹è§’è¶Šæ¥è¿‘0åº¦ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå‘é‡è¶Šç›¸ä¼¼ï¼Œè¿™å°±å«â€ä½™å¼¦ç›¸ä¼¼æ€§â€ã€‚æ‰€ä»¥ä¸Šé¢ä¸¤æ–‡æœ¬ç›¸ä¼¼åº¦ä¸º:
![](https://i.imgur.com/Mr35bEc.png)

ä¸‹é¢æˆ‘ä»¬æ¥ç»Ÿè®¡ä¸‹å†…å®¹è¾ƒé•¿çš„è®°å½•ç›¸ä¼¼æ–‡æœ¬(å†…å®¹è¾ƒçŸ­ç›¸ä¼¼åº¦ä¸æ˜æ˜¾)ã€‚ ç¬¬ä¸€æ­¥ï¼šæ‰¾å‡ºå†…å®¹é•¿åº¦å¤§äº700çš„è®°å½•ï¼Œå¹¶åšå¥½åˆ†è¯å’Œåœè¯ã€‚

<pre>
#ç­›é€‰è¦æ¯”è¾ƒçš„æ–‡æœ¬æ•°æ®,å…±24æ¡è®°å½•
data=[]#ä¿å­˜object.contentå†…å®¹å¤§äº700çš„æ‰€æœ‰æ•°æ®
all_posts=[]#åªä¿ç•™å‘å¸ƒçš„å†…å®¹æ•°æ®
for ac in activity_results:
    if len(ac['object']['content'])>700:
        c=ac['object']['content']
        data.append(ac)
        #åˆ†è¯å’Œåœè¯
        all_posts.append([w for w in nlp.tag(c)[0]['word'] if w not in nltk.corpus.stopwords.words('china')])

</pre>
ç¬¬äºŒæ­¥ï¼šæ„é€ è¯æ¡æ–‡æ¡£çŸ©é˜µã€‚å½¢å¼å¦‚
![](https://i.imgur.com/frDqafp.png)

<pre>
tc = nltk.TextCollection(all_posts)
#æ„é€ è¯æ¡æ–‡æ¡£çŸ©é˜µ
td_matrix = {}
for idx in range(len(all_posts)):
    post = all_posts[idx]
    fdist = nltk.FreqDist(post)

    doc_title = data[idx]['title']
    url = data[idx]['url']
    td_matrix[(doc_title, url)] = {}

    for term in fdist.keys():
        td_matrix[(doc_title, url)][term] = tc.tf_idf(term, post)
</pre>


ç¬¬ä¸‰æ­¥:è®¡ç®—ç›¸ä¼¼åº¦

è¿™é‡Œç”¨åˆ°nltk.cluster.util.cosine_distanceï¼Œè¿™ä¸ªå‡½æ•°è¯´æ˜å¦‚ä¸‹ï¼š nltk.cluster.util.cosine_distance(u, v)[source] Returns 1 minus the cosine of the angle between vectors v and u. This is equal to 1 - (u.v / |u||v|). å¯ä»¥çœ‹åˆ°è¿”å›çš„æ˜¯1-ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œè¡¨ç¤ºçš„æ˜¯ä½™å¼¦è·ç¦»ï¼Œä¹Ÿå°±æ˜¯è¯´ä½™å¼¦è·ç¦»è¶Šå°ç›¸ä¼¼åº¦è¶Šé«˜ã€‚

<pre>
distances = {}
for (title1, url1) in td_matrix.keys():

    distances[(title1, url1)] = {}
    (min_dist, most_similar) = (1.0, ('', ''))

    for (title2, url2) in td_matrix.keys():

        terms1 = td_matrix[(title1, url1)].copy()
        terms2 = td_matrix[(title2, url2)].copy()

        # å¡«å……0ä½¿ä¸¤å‘é‡é•¿åº¦ç›¸åŒ
        for term1 in terms1:
            if term1 not in terms2:
                terms2[term1] = 0

        for term2 in terms2:
            if term2 not in terms1:
                terms1[term2] = 0

        # äº§ç”Ÿv1,v2å‘é‡ï¼Œå‘é‡å…ƒç´ æ˜ å°„ä¸€è‡´
        v1 = [score for (term, score) in sorted(terms1.items())]
        v2 = [score for (term, score) in sorted(terms2.items())]

        # è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
        distances[(title1, url1)][(title2, url2)] = \
            nltk.cluster.util.cosine_distance(v1, v2)

        if url1 == url2:
            continue
        # æ ‡è®°ä½™å¼¦è·ç¦»æœ€å°çš„ï¼ˆç›¸ä¼¼åº¦æœ€å¤§ï¼‰
        if distances[(title1, url1)][(title2, url2)] < min_dist:
            (min_dist, most_similar) = (distances[(title1, url1)][(title2,
                                         url2)], (title2, url2))
    
    print ("%s\n(%s) \n æœ€ç›¸ä¼¼çš„æ˜¯:\n %s\n(%s) \n ç›¸ä¼¼åº¦: %f \n ------------------------------\n"
           % (title1, url1,most_similar[0], most_similar[1], 1-min_dist))
</pre>

æŸ¥çœ‹éƒ¨åˆ†ç»“æœï¼šä¸ºæŸ¥çœ‹æ–¹ä¾¿ï¼Œç»˜åˆ¶ç›¸ä¼¼åº¦çŸ©é˜µå›¾ï¼š
![](https://i.imgur.com/0M0j8MA.png)

